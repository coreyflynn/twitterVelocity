/*! barista Friday, May 8th, 2015, 6:14:04 PM */
function Tile(a){a=void 0!==a?a:{},this.div_target=void 0!==a.div_target?a.div_target:"body",this.div_id=void 0!==a.div_id?a.div_id:"Tile"+Math.floor(1e9*Math.random()),this.link=void 0!==a.link?a.link:"",this.style=void 0!==a.style?a.style:"",this.color=void 0!==a.color?a.color:"#bdbdbd",this.tile_type=void 0!==a.tile_type?a.tile_type:"medium",this.display=void 0!==a.display?a.display:!0,this.init_state=!1,this.display&&this.init()}function ImageTile(a){this.image=void 0!==a.image?a.image:"../Bellhop/img/CMap_Logo_gray.png",Tile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw()}function AnimatedImageTile(a){this.image=void 0!==a.image?a.image:"../Bellhop/img/CMap_Logo_gray.png",Tile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.start_animation()}function ImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw()}function AnimatedImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.TextIsAnimatingIn=!1,this.TextIsAnimatingOut=!1}function FullAnimatedImageTextTile(a){this.title=void 0!==a.title?a.title:"Title",ImageTile.apply(this,arguments);var b=this;$(window).resize(function(){b.draw()}),this.draw(),this.start_animation(),this.TextIsAnimatingIn=!1,this.TextIsAnimatingOut=!1}this.BaristaTemplates=this.BaristaTemplates||{},this.BaristaTemplates.CMapBaseGrid=Handlebars.template(function(a,b,c,d,e){function f(){return"\n	"}function g(a,b){var d,e="";return e+='\n		<p class="pull-left" style="cursor: pointer" id="',(d=c.div_string)?d=d.call(a,{hash:{},data:b}):(d=a.div_string,d=typeof d===p?d.apply(a):d),e+=q(d)+'_download">\n			<font color="#0072B2"><i class="icon-download"></i> download table</font>\n		</p>\n	'}function h(a,b){var d,e="";return e+='\n		<p class="pull-left" style="padding-left: 8px; cursor: pointer" id="',(d=c.div_string)?d=d.call(a,{hash:{},data:b}):(d=a.div_string,d=typeof d===p?d.apply(a):d),e+=q(d)+'_edit">\n			<font color="#e51c23"><i class="fa fa-times-circle"></i> edit </font>\n		</p>\n	'}function i(a,b){var d,e="";return e+='\n		<p class="pull-left" style="padding-left: 8px; cursor: pointer" id="',(d=c.div_string)?d=d.call(a,{hash:{},data:b}):(d=a.div_string,d=typeof d===p?d.apply(a):d),e+=q(d)+'_slice">\n			<font color="#0072B2"><i class="icon-cogs"></i> slice all data</font>\n		</p>\n	'}function j(){return'\n		<div class="col-lg-8"></div>\n	'}function k(a,b){var d,e="";return e+="\n		",d=c["if"].call(a,a.legend,{hash:{},inverse:r.program(14,m,b),fn:r.program(12,l,b),data:b}),(d||0===d)&&(e+=d),e+="\n	"}function l(a,b){var d,e="";return e+="\n			",(d=c.legend)?d=d.call(a,{hash:{},data:b}):(d=a.legend,d=typeof d===p?d.apply(a):d),e+=q(d)+"\n		"}function m(){return'\n			<span class="col-lg-8">\n				<p class="pull-right" style="padding-right: 8px"><span class="label" style="background-color: #E69F00">SMC</span> Small Molecule Compound </p>\n				<p class="pull-right" style="padding-right: 8px"><span class="label" style="background-color: #56B4E9">KD</span> Knock Down </p>\n				<p class="pull-right" style="padding-right: 8px"><span class="label" style="background-color: #D55E00">OE</span> Over Expression </p>\n			</span>\n		'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var n,o="",p="function",q=this.escapeExpression,r=this;return o+='<div id="',(n=c.div_string)?n=n.call(b,{hash:{},data:e}):(n=b.div_string,n=typeof n===p?n.apply(b):n),o+=q(n)+'" class="',(n=c.span_class)?n=n.call(b,{hash:{},data:e}):(n=b.span_class,n=typeof n===p?n.apply(b):n),o+=q(n)+' backgrid-container" height="300">\n</div>\n<div class="row">\n	<span class="col-lg-4">\n	',n=c["if"].call(b,b.no_download,{hash:{},inverse:r.program(3,g,e),fn:r.program(1,f,e),data:e}),(n||0===n)&&(o+=n),o+="\n	",n=c["if"].call(b,b.edit,{hash:{},inverse:r.noop,fn:r.program(5,h,e),data:e}),(n||0===n)&&(o+=n),o+="\n	",n=c["if"].call(b,b.no_slice,{hash:{},inverse:r.program(7,i,e),fn:r.program(1,f,e),data:e}),(n||0===n)&&(o+=n),o+="\n	</span>\n	",n=c["if"].call(b,b.no_legend,{hash:{},inverse:r.program(11,k,e),fn:r.program(9,j,e),data:e}),(n||0===n)&&(o+=n),o+="\n</div>\n"}),this.BaristaTemplates.CMapCard=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div id="',(f=c.div_string)?f=f.call(b,{hash:{},data:e}):(f=b.div_string,f=typeof f===h?f.apply(b):f),g+=i(f)+'" class="cmap-card-wrapper ',(f=c.span_class)?f=f.call(b,{hash:{},data:e}):(f=b.span_class,f=typeof f===h?f.apply(b):f),g+=i(f)+'">\n    <div class="cmap-card">\n        <a href="',(f=c.url)?f=f.call(b,{hash:{},data:e}):(f=b.url,f=typeof f===h?f.apply(b):f),g+=i(f)+"\">\n            <div class='cmap-card-title'>",(f=c.title)?f=f.call(b,{hash:{},data:e}):(f=b.title,f=typeof f===h?f.apply(b):f),g+=i(f)+'</div>\n            <p class="cmap-card-subtitle">',(f=c.subtitle)?f=f.call(b,{hash:{},data:e}):(f=b.subtitle,f=typeof f===h?f.apply(b):f),g+=i(f)+"</p>\n        </a>\n    </div>\n</div>\n"}),this.BaristaTemplates.CMapFooter=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n		<a href="',(d=c.url)?d=d.call(a,{hash:{},data:b}):(d=a.url,d=typeof d===j?d.apply(a):d),e+=k(d)+'"><img class="pull-right cmap-footer-image" src="',(d=c.logo)?d=d.call(a,{hash:{},data:b}):(d=a.logo,d=typeof d===j?d.apply(a):d),e+=k(d)+'"></a>\n	'}function g(a,b){var d,e="";return e+='\n		<a href="',(d=c.url)?d=d.call(a,{hash:{},data:b}):(d=a.url,d=typeof d===j?d.apply(a):d),e+=k(d)+'"><img class="cmap-footer-image" src="',(d=c.logo)?d=d.call(a,{hash:{},data:b}):(d=a.logo,d=typeof d===j?d.apply(a):d),e+=k(d)+'"></a>\n	'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="",j="function",k=this.escapeExpression,l=this;return i+='<hr>\n<div class="row hidden-xs">\n	<div class="col-sm-offset-1 col-sm-5 pull-left">\n		<p>&copy ',(h=c.year)?h=h.call(b,{hash:{},data:e}):(h=b.year,h=typeof h===j?h.apply(b):h),i+=k(h)+" ",(h=c.organization)?h=h.call(b,{hash:{},data:e}):(h=b.organization,h=typeof h===j?h.apply(b):h),i+=k(h)+' all rights reserved</p>\n		<p><a href="',(h=c.terms_url)?h=h.call(b,{hash:{},data:e}):(h=b.terms_url,h=typeof h===j?h.apply(b):h),i+=k(h)+'">terms and conditions</a></p>\n	</div>\n	<div class="col-sm-5">\n	',h=c.each.call(b,b.logo_objects,{hash:{},inverse:l.noop,fn:l.program(1,f,e),data:e}),(h||0===h)&&(i+=h),i+='\n	</div>\n</div>\n\n<div class="row visible-xs">\n	<div class="col-xs-12">\n		<p class="cmap-center-text">&copy ',(h=c.year)?h=h.call(b,{hash:{},data:e}):(h=b.year,h=typeof h===j?h.apply(b):h),i+=k(h)+" ",(h=c.organization)?h=h.call(b,{hash:{},data:e}):(h=b.organization,h=typeof h===j?h.apply(b):h),i+=k(h)+' all rights reserved</p>\n		<p class="cmap-center-text"><a href="',(h=c.terms_url)?h=h.call(b,{hash:{},data:e}):(h=b.terms_url,h=typeof h===j?h.apply(b):h),i+=k(h)+'">terms and conditions</a></p>\n	</div>\n	<div class="col-xs-12 cmap-center-text">\n	',h=c.each.call(b,b.logo_objects,{hash:{},inverse:l.noop,fn:l.program(3,g,e),data:e}),(h||0===h)&&(i+=h),i+='\n	</div>\n</div>\n<div class="cmap-spacer-medium"></div>\n'}),this.BaristaTemplates.CMapHeader=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n						<p id="cmapHeaderMenuAppName" title="app name" class="cmap-header-app-name pull-left">',(d=c.title)?d=d.call(a,{hash:{},data:b}):(d=a.title,d=typeof d===m?d.apply(a):d),e+=n(d)+"</p>\n					"}function g(a,b){var d,e="";return e+='\n						<div class="dropdown pull-right">\n							<p id="username" title="profile" class="cmap-header-username data-toggle" data-toggle="dropdown">',(d=c.user)?d=d.call(a,{hash:{},data:b}):(d=a.user,d=typeof d===m?d.apply(a):d),e+=n(d)+'<span class="caret cmap-header-caret"></span></p>\n							<ul class="dropdown-menu" role="menu" aria-labelledby="username">\n						    <li role="presentation"><a id="logout" role="menuitem" tabindex="-1" href="/signout">Logout</a></li>\n							<li role="presentation"><a id="settings" role="menuitem" tabindex="-1" href="/settings">Account settings</a></li>\n							<li role="presentation"><a id="about" role="menuitem" tabindex="-1" href="/about">About CLUE</a></li>\n						  </ul>\n						</div>\n					'}function h(){return'\n						<p title="login" class="cmap-header-link-left-border pull-right" onclick="window.location.href = \'/start\';">login</p>\n					'}function i(){return'\n						<p title="tour" class="cmap-header-link-no-border pull-right" onclick="tour();">Tour</p>\n					'}function j(){return'\n						<div class="dropdown pull-right">\n							<p id="username" title="profile" class="cmap-header-username data-toggle" data-toggle="dropdown"><i class="fa fa-user cmap-header-mobile-user-icon"></i><span class="caret cmap-header-caret"></span></p>\n							<ul class="dropdown-menu" role="menu" aria-labelledby="username">\n								<li role="presentation"><a id="logout" role="menuitem" tabindex="-1" href="/signout">Logout</a></li>\n							<li role="presentation"><a id="settings" role="menuitem" tabindex="-1" href="/settings">Account settings</a></li>\n							<li role="presentation"><a id="about" role="menuitem" tabindex="-1" href="/about">About CLUE</a></li>\n							</ul>\n						</div>\n					'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var k,l="",m="function",n=this.escapeExpression,o=this;return l+='<div class="cmap-header">\n\n	<!-- large screens -->\n	<div class="row hidden-xs">\n		<div class="row">\n			<div class="col-sm-12 cmap-header-toolbar">\n				<div class="col-xs-8">\n					<p id="cmapHeaderMenuButtonXL" title="menu" class="cmap-header-link-no-border pull-left cmapHeaderMenuButton"><i class="fa fa-bars"></i> Menu</p>\n					<!-- <a href="/"> -->\n						<img class="cmap-header-image pull-left" src="//cmap.github.io/cdn/img/logos/linscloud_logo_RGB_small-cloud-web.png">\n					<!-- </a> -->\n					',k=c["if"].call(b,b.title,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n					<p id="cmapHeaderMenuAppDescription" title="description" class="cmap-header-subtitle pull-left">',(k=c.subtitle)?k=k.call(b,{hash:{},data:e}):(k=b.subtitle,k=typeof k===m?k.apply(b):k),l+=n(k)+'</p>\n				</div>\n\n				<div class="col-xs-4">\n					',k=c["if"].call(b,b.user,{hash:{},inverse:o.program(5,h,e),fn:o.program(3,g,e),data:e}),(k||0===k)&&(l+=k),l+='\n					<p class="cmap-header-splitter pull-right"> </p>\n					',k=c["if"].call(b,b.tour,{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(k||0===k)&&(l+=k),l+='\n				</div>\n			</div>\n		</div>\n	</div>\n\n\n\n	<!-- small screens -->\n	<div class="row visible-xs">\n\n		<div class="row">\n			<div class="col-sm-12 cmap-header-toolbar">\n				<div class="col-xs-8">\n					<p id="cmapHeaderMenuButtonXS" title="menu" class="cmap-header-link-no-border pull-left cmapHeaderMenuButton"><i class="fa fa-bars"></i> Menu</p>\n					',k=c["if"].call(b,b.title,{hash:{},inverse:o.noop,fn:o.program(1,f,e),data:e}),(k||0===k)&&(l+=k),l+='\n				</div>\n\n				<div class="col-xs-4">\n					',k=c["if"].call(b,b.user,{hash:{},inverse:o.program(5,h,e),fn:o.program(9,j,e),data:e}),(k||0===k)&&(l+=k),l+='\n					<p class="cmap-header-splitter pull-right"> </p>\n					',k=c["if"].call(b,b.tour,{hash:{},inverse:o.noop,fn:o.program(7,i,e),data:e}),(k||0===k)&&(l+=k),l+="\n				</div>\n			</div>\n		</div>\n\n	</div>\n\n</div>\n"}),this.BaristaTemplates.CMapPertSearchBar=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<input class="typeahead form-control col-lg-12" autocomplete="off" type="text" placeholder="',(f=c.placeholder)?f=f.call(b,{hash:{},data:e}):(f=b.placeholder,f=typeof f===h?f.apply(b):f),g+=i(f)+'" data-provide="typeahead" id="search">'}),this.BaristaTemplates.CMapUserCard=Handlebars.template(function(a,b,c,d,e){function f(a){var b="";return b+='\n                    <img src="'+j(typeof a===i?a.apply(a):a)+'" alt="" class="cmap-user-badge pull-right" />\n                '}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var g,h="",i="function",j=this.escapeExpression,k=this;return h+='<div id="',(g=c.div_string)?g=g.call(b,{hash:{},data:e}):(g=b.div_string,g=typeof g===i?g.apply(b):g),h+=j(g)+'" class="cmap-card-wrapper ',(g=c.span_class)?g=g.call(b,{hash:{},data:e}):(g=b.span_class,g=typeof g===i?g.apply(b):g),h+=j(g)+'">\n    <div class="cmap-user-card row">\n        <div class="col-xs-6">\n            <h1 class="cmap-user-name">',(g=c.name)?g=g.call(b,{hash:{},data:e}):(g=b.name,g=typeof g===i?g.apply(b):g),h+=j(g)+'</h1>\n            <p class="cmap-user-username">',(g=c.username)?g=g.call(b,{hash:{},data:e}):(g=b.username,g=typeof g===i?g.apply(b):g),h+=j(g)+'</p>\n            <p class="cmap-user-email">',(g=c.email)?g=g.call(b,{hash:{},data:e}):(g=b.email,g=typeof g===i?g.apply(b):g),h+=j(g)+'</p>\n        </div>\n        <div class="col-xs-6">\n            <div class="cmap-user-image-container">\n                ',g=c.each.call(b,b.badges,{hash:{},inverse:k.noop,fn:k.program(1,f,e),data:e}),(g||0===g)&&(h+=g),h+="\n            </div>\n        </div>\n    </div>\n</div>\n"}),this.BaristaTemplates.TypeaheadItem=Handlebars.template(function(a,b,c,d,e){this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var f,g="",h="function",i=this.escapeExpression;return g+='<div class="tt-suggestion"><span class="label" style="background-color: ',(f=c.color)?f=f.call(b,{hash:{},data:e}):(f=b.color,f=typeof f===h?f.apply(b):f),g+=i(f)+'">',(f=c.type)?f=f.call(b,{hash:{},data:e}):(f=b.type,f=typeof f===h?f.apply(b):f),g+=i(f)+"</span> ",(f=c.value)?f=f.call(b,{hash:{},data:e}):(f=b.value,f=typeof f===h?f.apply(b):f),g+=i(f)+"</div>"}),this.BaristaTemplates.d3_target=Handlebars.template(function(a,b,c,d,e){function f(a,b){var d,e="";return e+='\n<div id="',(d=c.div_string)?d=d.call(a,{hash:{},data:b}):(d=a.div_string,d=typeof d===i?d.apply(a):d),e+=j(d)+'" class="',(d=c.span_class)?d=d.call(a,{hash:{},data:b}):(d=a.span_class,d=typeof d===i?d.apply(a):d),e+=j(d)+'" style="height:',(d=c.height)?d=d.call(a,{hash:{},data:b}):(d=a.height,d=typeof d===i?d.apply(a):d),e+=j(d)+'px"></div>\n'}function g(a,b){var d,e="";return e+='\n<div id="',(d=c.div_string)?d=d.call(a,{hash:{},data:b}):(d=a.div_string,d=typeof d===i?d.apply(a):d),e+=j(d)+'" class="',(d=c.span_class)?d=d.call(a,{hash:{},data:b}):(d=a.span_class,d=typeof d===i?d.apply(a):d),e+=j(d)+'" style="height:120px"></div>\n'}this.compilerInfo=[4,">= 1.0.0"],c=this.merge(c,a.helpers),e=e||{};var h,i="function",j=this.escapeExpression,k=this;return h=c["if"].call(b,b.height,{hash:{},inverse:k.program(3,g,e),fn:k.program(1,f,e),data:e}),h||0===h?h:""});var Barista={};Barista.VERSION="0.2.0",Barista.Models={},Barista.Collections={},Barista.Views={},Barista.Datasets={},Barista.APIURL="//api.lincscloud.org",Barista.Utils={cookie:$.cookie},Barista.Datasets=_.extend(Barista.Datasets,{CellHistology:{limit:6,name:"CellHistology",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/cellinfo?",'q={"lincs_status":{"$in":["core_cline","core_pline","DIVR"]},"cell_histology":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"cell_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.cell_histology),d[a.cell_histology]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Cell Histology",search_column:"cell_histology",color:"#BB4D8A"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{CellID:{limit:6,name:"CellID",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/cellinfo?",'q={"lincs_status":{"$in":["core_cline","core_pline","DIVR"]},"cell_id":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"cell_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.cell_id),d[a.cell_id]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Cell ID",search_column:"cell_id",color:"#CC79A7"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{CellLineage:{limit:6,name:"CellLineage",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/cellinfo?",'q={"lincs_status":{"$in":["core_cline","core_pline","DIVR"]},"cell_lineage":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"cell_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.cell_lineage),d[a.cell_lineage]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Cell Lineage",search_column:"cell_lineage",color:"#DDA6C4"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{CellMutation:{limit:6,name:"CellMutation",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/cellinfo?",'q={"lincs_status":{"$in":["core_cline","core_pline","DIVR"]}}',"&d=mutations"].join("")},dataType:"jsonp",filter:function(a){var b=[],c=a,d=new RegExp($(".typeahead",self.div_string).val(),"i");return c=_.filter(c,function(a){return d.test(a)}),c.forEach(function(a){var c={value:a,tokens:[a],data:a};_.extend(c,{type:"Cell Mutation",search_column:"mutations",color:"#999999"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{CompoundPertIName:{limit:6,name:"CompoundPertIName",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/pertinfo?",'q={"pert_iname":{"$regex":"^'+b+'", "$options":"i"}, "pert_type":"trt_cp"}','&f={"pert_iname":1,"pert_type":1}',"&l=100",'&s={"pert_iname":1}'].join("")},dataType:"jsonp",filter:function(a){var b=["trt_sh","trt_oe","trt_sh.cgs"],c=[],d=[],e={};return a.forEach(function(a){d.push(a.pert_iname),e[a.pert_iname]=a}),d=_.uniq(d),d.forEach(function(a){var d={value:a,tokens:[a],data:e[a]};return-1!=b.indexOf(e[a].pert_type)?(_.extend(d,{type:"Genetic Reagent",color:"#0072B2"}),c.push(d),c):"trt_cp"===e[a].pert_type?(_.extend(d,{type:"Chemical Reagent",color:"#E69F00"}),c.push(d),c):"trt_sh.css"===e[a].pert_type?(_.extend(d,{type:"Seed Sequence",color:"#009E73"}),c.push(d),c):(_.extend(d,{type:e[a].pert_type,color:"#999"}),c.push(d),c)}),c}}}}),Barista.Datasets=_.extend(Barista.Datasets,{GeneticPertIName:{limit:6,name:"GeneticPertIName",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/pertinfo?",'q={"pert_iname":{"$regex":"^'+b+'", "$options":"i"}, "pert_type":{"$in":["trt_sh","trt_oe","trt_oe.mut"]}}','&f={"pert_iname":1,"pert_type":1}',"&l=100",'&s={"pert_iname":1}'].join("")},dataType:"jsonp",filter:function(a){var b=["trt_sh","trt_oe","trt_sh.cgs"],c=[],d=[],e={};return a.forEach(function(a){d.push(a.pert_iname),e[a.pert_iname]=a}),d=_.uniq(d),d.forEach(function(a){var d={value:a,tokens:[a],data:e[a]};return-1!=b.indexOf(e[a].pert_type)?(_.extend(d,{type:"Genetic Reagent",color:"#0072B2"}),c.push(d),c):"trt_cp"===e[a].pert_type?(_.extend(d,{type:"Chemical Reagent",color:"#E69F00"}),c.push(d),c):"trt_sh.css"===e[a].pert_type?(_.extend(d,{type:"Seed Sequence",color:"#009E73"}),c.push(d),c):(_.extend(d,{type:e[a].pert_type,color:"#999"}),c.push(d),c)}),c}}}}),Barista.Datasets=_.extend(Barista.Datasets,{JobID:{limit:6,name:"JobID",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/compute_status?",'q={"job_id":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"job_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.job_id),d[a.job_id]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Job",search_column:"job_id",color:"#BDBDBD"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{JobName:{limit:6,name:"JobName",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",remote:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/compute_status?",'q={"params.rpt":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"job_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.params.rpt),d[a.params.rpt]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Job Name",search_column:"params.rpt",color:"#77A2A6"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{JobStatus:{limit:6,name:"JobStatus",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/compute_status?",'q={"status":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"status":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.status),d[a.status]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Status",search_column:"status",color:"#B14A4E"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{P100PertIName:{limit:6,name:"P100PertIName",template:'<span class="label" style="background-color: #7bd9e4">P100</span><span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,["//prefix:8080/p100/v1/profileinfo?",'q={"pert_iname":{"$regex":"^'+b+'", "$options":"i"}}','&f={"pert_iname":1}',"&l=100",'&s={"pert_iname":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.pert_iname),d[a.pert_iname]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};return _.extend(c,{type:"Chemical Reagent",color:"#E69F00"}),b.push(c),b}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{PRISMPertIName:{limit:6,name:"PRISMPertIName",template:'<span class="label" style="background-color: #8387e6">PRISM</span><span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/prism/v1/profileinfo?",'q={"pert_iname":{"$regex":"^'+b+'", "$options":"i"}}','&f={"pert_iname":1}',"&l=100",'&s={"pert_iname":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.pert_iname),d[a.pert_iname]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};return _.extend(c,{type:"Chemical Reagent",color:"#E69F00"}),b.push(c),b}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{PertIName:{limit:6,name:"PertIName",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/a2/pertinfo?",'q={"pert_iname":{"$regex":"^'+b+'", "$options":"i"}, "pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}','&f={"pert_iname":1,"pert_type":1}',"&l=100",'&s={"pert_iname":1}'].join("")},dataType:"jsonp",filter:function(a){var b=["trt_sh","trt_oe","trt_sh.cgs"],c=[],d=[],e={};return a.forEach(function(a){d.push(a.pert_iname),e[a.pert_iname]=a}),d=_.uniq(d),d.forEach(function(a){var d={value:a,tokens:[a],data:e[a]};return-1!=b.indexOf(e[a].pert_type)?(_.extend(d,{type:"Genetic Reagent",color:"#0072B2"}),c.push(d),c):"trt_cp"===e[a].pert_type?(_.extend(d,{type:"Chemical Reagent",color:"#E69F00"}),c.push(d),c):"trt_sh.css"===e[a].pert_type?(_.extend(d,{type:"Seed Sequence",color:"#009E73"}),c.push(d),c):(_.extend(d,{type:e[a].pert_type,color:"#999"}),c.push(d),c)}),c}}}}),Barista.Datasets=_.extend(Barista.Datasets,{ToolID:{limit:6,name:"ToolID",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/compute_status?",'q={"tool_id":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"tool_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.tool_id),d[a.tool_id]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Tool",search_column:"tool_id",color:"#005CF2"}),b.push(c)}),b}}}}),Barista.Datasets=_.extend(Barista.Datasets,{UserID:{limit:6,name:"UserID",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:"",replace:function(a,b){return b="*"===b[0]?b.replace("*",".*"):b,[Barista.APIURL+"/compute_status?",'q={"user_id":{"$regex":"^'+b+'", "$options":"i"}}',"&l=10",'&s={"user_id":1}'].join("")},dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.user_id),d[a.user_id]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};_.extend(c,{type:"Username",search_column:"user_id",color:"#B348DA"}),b.push(c)}),b}}}}),Barista.CMapPertTypeAlias=function(a){switch(a){case"trt_cp":return{name:"small molecule compound",acronym:"SMC"};case"trt_sh":return{name:"knock down",acronym:"KD"};case"trt_oe":return{name:"over expression",acronym:"OE"};case"trt_oe.mut":return{name:"variant",acronym:"VAR"};case"DOS":return{name:"tool compounds",acronym:"DOS"};case"BIOA":return{name:"drugs and bioactives",acronym:"BIOA"};default:return{name:a,acronym:a}}},Barista.NumbersToSubscript=function(a){if(!a)return a;var b="₀₁₂₃₄₅₆₇₈₉",c=new RegExp("^[0-9]$"),d="";return a.split("").forEach(function(a){d+=c.test(a)?b[a]:a}),d},Barista.arrayAverage=function(a){return _.reduce(a,function(a,b){return a+b},0)/a.length},Barista.getEmSizeInPixels=function(){var a=document.body;return Number(getComputedStyle(a,"").fontSize.match(/(\d+)px/)[1])},Barista.getQueryVariable=function(a){for(var b=window.location.search.substring(1),c=b.split("&"),d=0;d<c.length;d++){var e=c[d].split("=");if(e[0]==a)return e[1]}return!1},Barista.numberWithCommas=function(a){return a?0==a?"0":a.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},Barista.setAPIPrefilter=function(a){a=void 0!==a?a:"api.lincscloud.org",$.ajaxPrefilter(function(b,c){var d=new RegExp(a),e=new RegExp("api.lincscloud.org");(d.test(b.url)||e.test(b.url))&&(b.data=$.param($.extend(c.data,{user_key:Barista.user_key})))})},Barista.setAPIURL=function(a){a=void 0!==a?a:"//api.lincscloud.org",a.replace("https://","//"),a.replace("http://","//"),"//"!==a[0].slice(0,2)&&(a="//"+a),Barista.APIURL=a,Barista.setAPIPrefilter(a)},Barista.setUserKey=function(a){Barista.setAPIPrefilter();var b=$.ajax(a,{dataType:"json",async:!1});b.done(function(a){return Barista.user_key=a.user_key,Barista.user_key}),b.fail(function(){return console.log("could not find a file at "+a+"; setting Barista.user_key to "+a),Barista.user_key=a,null})},Barista.Models.AnalysisHistoryModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("_id"),this.set("date",new Date(1e3*parseInt(this.cid.substring(0,8),16))),this.set("rpt",this.get("params").rpt),this.set("completed"===this.get("status")?{view_result_link:'<a href="'+this.get("standard_result")+'"><i class="fa fa-eye"></i></a>'}:{view_result_link:""}),this.set({edit:"<i class=\"fa fa-times-circle cmap-grid-delete-button\" onclick=\"Backbone.trigger('AnalysisHistoryModel:delete','"+this.get("job_id")+"')\"></i>"})}}),Barista.Models.BarPlotModel=Backbone.Model.extend({defaults:{title:"",axis_title:"",data:[],data_labels:[],meta_data:{}}}),Barista.Models.CellCountModel=Backbone.Model.extend({defaults:{count:0,pert_types:[{}],g:"cell_type",last_update:(new Date).getTime()},fetch:function(a,b){var c=Barista.APIURL+"/a2/siginfo?callback=?",d=Barista.APIURL+"/a2/pertinfo?callback=?",e=Barista.APIURL+"/a2/cellinfo?callback=?";"multi"===b&&(a='["'+a.split(/[:, ]/).join('","')+'"]',pert_params={q:'{"pert_iname":{"$in":'+a+'},"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}',d:"cell_id"}),("single"===b||void 0===b)&&(pert_params={q:'{"pert_iname":{"$regex":"^'+a+'","$options":"i"},"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}',d:"cell_id"}),"cell"===b&&(pert_params={q:'{"cell_id":"'+a+'"}',f:'{"cell_id":1}',l:1});var f,g=this,h=(new Date).getTime();"cell"===b?$.getJSON(c,pert_params,function(b){if(0===b)f=0,g.set({count:f,pert_types:[{}],last_update:h});else{f=b.length;var c=('["'+b.join('","')+'"]',{q:'{"cell_id":"'+a+'"}',g:"cell_type"});$.getJSON(e,c,function(a){g.set({count:f,pert_types:a,last_update:h})})}}):$.getJSON(d,pert_params,function(a){if(0===a)f=0,g.set({count:f,pert_types:[{}],last_update:h});else{f=a.length;var b='["'+a.join('","')+'"]',c={q:'{"cell_id":{"$in":'+b+"}}",g:g.get("g")};$.getJSON(e,c,function(a){g.set({count:f,pert_types:a,last_update:h})})}})}}),Barista.Models.CellModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("cell_id")}}),Barista.Models.CompoundDetailModel=Backbone.Model.extend({defaults:{pert_id:"",pert_iname:"",pert_summary:null,pubchem_cid:null,wiki_url:null,molecular_formula:null,molecular_wt:null,pert_vendor:null,num_gold:0,num_sig:0,cell_id:[],inchi_key:"",structure_url:""},fetch:function(a){var b=$.Deferred(),c=Barista.APIURL+"/a2/pertinfo?callback=?",d=d={q:'{"pert_type":"trt_cp","pert_iname":{"$regex":"^'+a+'", "$options":"i"}}',l:1},e=this;return $.getJSON(c,d,function(c){if(0==c||""==a)e.set({pert_id:"",pert_iname:"",pert_summary:null,pubchem_cid:null,wiki_url:null,molecular_formula:null,molecular_wt:null,pert_vendor:null,num_gold:0,num_sig:0,cell_id:[],inchi_key:"",structure_url:""}),e.trigger("CompoundDetailModel:ModelIsNull");else{e.set(c[0]);var d=null;if(c[0].pert_url){var f=c[0].pert_url.split(","),g=/wikipedia/;f.forEach(function(a){g.exec(a)&&(d=a)})}var h=null;c[0].pubchem_cid&&(h=c[0].pubchem_cid);var i=null;c[0].pert_summary&&(i=c[0].pert_summary);var j=null;c[0].structure_url&&h&&(j=c[0].structure_url),e.set({pert_id:c[0].pert_id,pert_iname:c[0].pert_iname,pert_summary:i,pubchem_cid:h,wiki_url:d,molecular_formula:c[0].molecular_formula,molecular_wt:c[0].molecular_wt,pert_vendor:c[0].pert_vendor,num_gold:c[0].num_gold,num_sig:c[0].num_sig,cell_id:c[0].cell_id,inchi_key:c[0].inchi_key,structure_url:j,last_update:(new Date).getTime()}),e.trigger("CompoundDetailModel:ModelIsNotNull")}b.resolve(e.attributes)}),b}}),Barista.Models.GeneDetailModel=Backbone.Model.extend({defaults:{cell_id:[],clone_name:null,has_kd:!1,has_oe:!1,num_gold:null,num_inst:null,num_sig:null,oligo_seq:null,pert_id:null,pert_iname:null,pert_summary:null,seed_seq6:null,seed_seq7:null,sig_id:[],sig_id_gold:[],target_region:null,target_seq:null,vector_id:null},kd_fields:["clone_name","oligo_seq","seed_seq6","seed_seq7","target_region","target_seq","vector_id"],array_fields:["cell_id","sig_id","sig_id_gold"],fetch:function(a){var b=$.Deferred(),c=Barista.APIURL+"/a2/pertinfo?callback=?",d=d={q:'{"pert_type":{"$in":["trt_sh","trt_oe"]},"pert_iname":{"$regex":"^'+a+'", "$options":"i"}}',f:'{"pert_iname":1}',l:1},e=this;
return $.getJSON(c,d,function(a){if(0==a||""==c)e.set(e.defaults),e.trigger("GeneDetailModel:ModelIsNull");else{var c=a[0].pert_iname;KD_deferred=e.fetch_pert_type(c,"trt_sh"),OE_deferred=e.fetch_pert_type(c,"trt_oe"),$.when(KD_deferred,OE_deferred).done(function(a,c){if(null===a&&null===c)e.set(e.defaults),e.trigger("GeneDetailModel:ModelIsNull");else{var d={pert_type:"gene"};null===a?(d.has_kd=!1,d.has_oe=!0,e.set(_.extend(c.unprefixed,c.prefixed,d))):null===c?(d.has_kd=!0,d.has_oe=!1,e.set(_.extend(a.unprefixed,a.prefixed,d))):(d.has_kd=!0,d.has_oe=!0,e.set(_.extend(a.unprefixed,a.prefixed,c.prefixed,d))),e.trigger("GeneDetailModel:ModelIsNotNull")}b.resolve(e.attributes)})}}),b},fetch_pert_type:function(a,b){var c=$.Deferred(),d=Barista.APIURL+"/a2/pertinfo?callback=?",e=e={q:'{"pert_type":"'+b+'","pert_iname":"'+a+'"}',l:1};return $.getJSON(d,e,function(d){if(0==d||""==a)c.resolve(null);else{var e={};for(field in d[0])e[b+"_"+field]=d[0][field];c.resolve({prefixed:e,unprefixed:d[0]})}}),c}}),Barista.Models.GenericCountModel=Backbone.Model.extend({defaults:{count:0},initialize:function(){this.setListeners()},setListeners:function(){var a=this.get("source");a&&this.listenTo(a,"update",function(){attrs.source.getCount(attrs.key)?this.set("count",attrs.source.getCount(attrs.key)):this.set("count",0)})}}),Barista.Models.GenericSourceModel=Backbone.Model.extend({initialize:function(){this.setKey()},setKey:function(){var a=this.get("key");this.url="http://10.125.171.42:8080/"+a},getCount:function(a){return this.data[a.group][a.name]},update:function(){var a=this;$.getJSON(this.url,function(b){a.data=b,a.trigger("update")})}}),Barista.Models.GenericMongoModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("_id"),this.set("date",new Date(1e3*parseInt(this.cid.substring(0,8),16)))}}),Barista.Models.HeatmapModel=Backbone.Model.extend({defaults:{data:[[1,2],[3,4]],rid:["1","2"],cid:["1","2"],annots:void 0,title:"",last_update:(new Date).getTime()}}),Barista.Models.PertCellBreakdownModel=Backbone.Model.extend({defaults:{filter:"",tree_object:{children:[]}},fetch:function(a,b){var c=Barista.APIURL+"/a2/pertinfo?callback=?",d={};"multi"===b&&(a='["'+a.split(/[:, ]/).join('","')+'"]',d={q:"{"+this.get("filter")+'"pert_iname":{"$in":'+a+"}}",g:"cell_id"}),("single"===b||void 0===b)&&(d={q:"{"+this.get("filter")+'"pert_iname":{"$regex":"^'+a+'","$options":"i"}}',g:"cell_id"}),"cell"===b&&(d={q:"{"+this.get("filter")+'"pert_iname":{"$regex":""}}',g:"cell_id"});var e=this;$.getJSON(c,d,function(c){children=0===c?[]:c,"cell"===b&&(children=_.filter(children,function(b){return b._id==a}));var d=(new Date).getTime();e.set({tree_object:{name:"root",children:children},last_update:d})})}}),Barista.Models.PertCountModel=Backbone.Model.extend({defaults:{type_string:'["trt_cp"]',count:0,pert_types:[{}],pert_type_field:"pert_icollection",last_update:(new Date).getTime()},fetch:function(a,b){var c=Barista.APIURL+"/a2/pertinfo?callback=?",d={};"multi"===b&&(a='["'+a.split(/[:, ]/).join('","')+'"]',d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$in":'+a+"}}",c:!0}),("single"===b||void 0===b)&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"^'+a+'","$options":"i"}}',c:!0}),"cell"===b&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"","$options":"i"},"cell_id":"'+a+'"}',c:!0});var e,f=this;$.getJSON(c,d,function(a){e=0===a?0:a.count;var b=(new Date).getTime();d=_.omit(d,"c"),d=_.extend(d,{g:f.get("pert_type_field")}),$.getJSON(c,d,function(a){f.set({count:e,pert_types:a,last_update:b})})})}}),Barista.Models.PertDetailModel=Backbone.Model.extend({defaults:{cell_id:[],num_gold:null,num_inst:null,num_sig:null,pert_id:null,pert_iname:null,pert_type:null,sig_id:[],sig_id_gold:[]},compound_sub_model:new Barista.Models.CompoundDetailModel,gene_sub_model:new Barista.Models.GeneDetailModel,fetch:function(a,b){var c=this,d=$.Deferred();switch(b){case"compound":this.compound_sub_model.fetch(a).then(function(a){c.clear().set(a),d.resolve()});break;case"gene":this.gene_sub_model.fetch(a).then(function(a){c.clear().set(a),d.resolve()})}return d}}),Barista.Models.PertModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("pert_id");var a=this.get("pert_type");switch(a){case"trt_cp":this.set({pert_type_label:'<span class="label" style="background-color: #E69F00">SMC</span>'});break;case"trt_oe":this.set({pert_type_label:'<span class="label" style="background-color: #D55E00">OE</span>'});break;case"trt_sh":this.set({pert_type_label:'<span class="label" style="background-color: #56B4E9">KD</span>'});break;default:this.set({pert_type_label:'<span class="label" style="background-color: #BDBDBD">'+a+"</span>"})}}}),Barista.Models.ScatterPlotModel=Backbone.Model.extend({defaults:{title:"",x_axis_title:"",y_axis_title:"",x_data:[],y_data:[],meta_data:{}}}),Barista.Models.SigCountModel=Backbone.Model.extend({defaults:{type_string:'["trt_sh","trt_oe","trt_oe.mut"]',count:0,pert_types:[{}],pert_type_field:"pert_icollection",last_update:(new Date).getTime()},fetch:function(a,b){var c=Barista.APIURL+"/a2/siginfo?callback=?",d={};"multi"===b&&(a='["'+a.split(/[:, ]/).join('","')+'"]',d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$in":'+a+"}}",c:!0}),("single"===b||void 0===b)&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"^'+a+'","$options":"i"}}',c:!0}),"cell"===b&&(d={q:'{"pert_type":{"$in":'+this.get("type_string")+'},"pert_iname":{"$regex":"","$options":"i"},"cell_id":"'+a+'"}',c:!0});var e,f=this;$.getJSON(c,d,function(a){e=0===a?0:a.count;var b=(new Date).getTime();d=_.omit(d,"c"),d=_.extend(d,{g:f.get("pert_type_field")}),$.getJSON(c,d,function(a){f.set({count:e,pert_types:a,last_update:b})})})}}),Barista.Models.SignatureModel=Backbone.Model.extend({initialize:function(){this.cid=this.get("sig_id");var a=this.get("pert_type");switch(a){case"trt_cp":this.set({pert_type_label:'<span class="label" style="background-color: #E69F00">SMC</span>'});break;case"trt_oe":this.set({pert_type_label:'<span class="label" style="background-color: #D55E00">OE</span>'});break;case"trt_sh":this.set({pert_type_label:'<span class="label" style="background-color: #56B4E9">KD</span>'})}var b=this.get("is_gold");this.set(b?{is_gold_label:'<span class="label" style="background-color: #F0E442; color:gray">Gold</span>'}:{is_gold_label:'<span class="label">Not Gold</span>'})}}),Barista.Models.SummlyResultModel=Backbone.Model.extend({defaults:{query:"",target:"",summly_score:-666,summly_rank:-666,specificity:-666,cell_line_scores:{}},initialize:function(){this.cid=this.get("target");var a=this.get("pert_type");switch(a){case"trt_cp":this.set({pert_type_label:'<span class="label" style="background-color: #E69F00">SMC</span>'});break;case"trt_oe":this.set({pert_type_label:'<span class="label" style="background-color: #D55E00">OE</span>'});break;case"trt_sh":this.set({pert_type_label:'<span class="label" style="background-color: #56B4E9">KD</span>'});break;default:this.set({pert_type_label:'<span class="label">'+a+"</span>"})}}}),Barista.Models.TickModel=Backbone.Model.extend({defaults:{title:"",data_object:{}}}),Barista.Models.SequenceModel=Backbone.Model.extend({defaults:{sequence:"",displaySequence:"",modifications:new Backbone.Collection},initialize:function(){this.listenTo(this,"change:sequence",this.parseSequence)},parseSequence:function(){var a=this.get("sequence"),b=this.get("modifications"),c=[],d=0;modObjects=[],b.reset(),a=a.replace(/_/g,"");for(var e=0;e<a.length;e++)"("===a[e]&&c.push(e);c.forEach(function(b){var c;b-=4*d,c=a.slice(b+1,b+3),a=[a.slice(0,b),a.slice(b+4,a.length)].join(""),modObjects.push({index:b,modification:c}),d+=1}),b.add(modObjects),this.set({modifications:b,displaySequence:a})}}),Barista.Collections.AnalysisHistoryCollection=Backbone.Collection.extend({initialize:function(){this.url=Barista.APIURL+"/compute_status?callback=?"},model:Barista.Models.AnalysisHistoryModel,skip:0,isLoading:!1,maxCount:1/0,user:void 0,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=void 0!==a?a:"",this.search_type=void 0!==b?b:"",this.limit=void 0!==c?c:30;var e="";switch(d.user&&(e='"user_id":"'+d.user+'",'),b){case"job_id":this.q_param="{"+e+'"job_id":{"$regex":"'+a+'", "$options":"i"},"status":{"$ne":"deleted"}}';break;case"status":this.q_param="{"+e+'"status":{"$regex":"'+a+'", "$options":"i"},"status":{"$ne":"deleted"}}';break;case"tool_id":this.q_param="{"+e+'"tool_id":{"$regex":"'+a+'", "$options":"i"},"status":{"$ne":"deleted"}}';break;case"job_name":this.q_param="{"+e+'"params.rpt":"'+a+'","status":{"$ne":"deleted"}}';break;case"user_id":this.q_param="{"+e+'"user_id":{"$regex":"'+a+'", "$options":"i"},"status":{"$ne":"deleted"}}';break;default:this.q_param="{"+e+'"job_id":{"$regex":"'+a+'", "$options":"i"},"status":{"$ne":"deleted"}}'}var f={q:this.q_param,l:this.limit,sk:this.skip,s:'{"_id":-1}'},g=$.Deferred();return $.getJSON(this.url,f,function(a){d.set(a,{remove:!1}),d.isLoading=!1,g.resolve()}),1/0==this.maxCount&&(f=_.omit(f,["l","sk","s"]),f=_.extend(f,{c:!0}),$.getJSON(this.url,f,function(a){d.maxCount=a.count})),g}}),Barista.Collections.CellCollection=Backbone.Collection.extend({initialize:function(){this.url=Barista.APIURL+"/a2/cellinfo?callback=?"},model:Barista.Models.CellModel,skip:0,isLoading:!1,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=void 0!==a?a:"",this.search_column=void 0!==b?b:"cell_id","single"==this.search_column&&(this.search_column="cell_id"),this.limit=void 0!==c?c:30,this.q_param="mutations"==this.search_column?'{"lincs_status":{"$in":["core_cline","core_pline","DIVR"]},"mutations":"'+this.search_string+'"}':'{"lincs_status":{"$in":["core_cline","core_pline","DIVR"]},"'+this.search_column+'":{"$regex":"^'+this.search_string+'","$options":"i"}}';var e={q:this.q_param,l:this.limit,sk:this.skip};$.getJSON(this.url,e,function(a){d.set(a,{remove:!1}),d.isLoading=!1,d.trigger("fetch")})}}),Barista.Collections.GenericJSONCollection=Backbone.Collection.extend({model:Barista.Models.PertModel,url:"data.json",skip:0,isLoading:!1,maxCount:1/0,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=void 0!==a?a:"",this.search_type=void 0!==b?b:"",this.limit=void 0!==c?c:30,"object"==typeof this.url?(this.url.forEach(function(a){d.add(new Barista.Models.PertModel(a))}),this.maxCount=this.models.length):$.getJSON(this.url,function(a){a.forEach(function(a){d.add(new PertModel(a))}),this.maxCount=this.models.length})}}),Barista.Collections.PertCollection=Backbone.Collection.extend({initialize:function(){this.url=Barista.APIURL+"/a2/pertinfo?callback=?"},model:Barista.Models.PertModel,skip:0,isLoading:!1,maxCount:1/0,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=void 0!==a?a:"",this.search_type=void 0!==b?b:"",this.limit=void 0!==c?c:30,("single"===b||void 0===b)&&(this.q_param='{"pert_iname":{"$regex":"^'+a+'","$options":"i"},"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}'),"multi"===b&&(a='["'+a.split(":").join('","')+'"]',this.q_param='{"pert_iname":{"$in":"'+a+'"},"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}'),"cell"===b&&(this.q_param='{"cell_id":"'+a+'"}'),this.s_param='{"pert_iname":1}',this.f_param='{"pert_iname":1,"pert_type":1,"pert_id":1,"num_sig":1}';var e={q:this.q_param,l:this.limit,s:this.s_param,f:this.f_param,sk:this.skip};$.getJSON(this.url,e,function(a){d.set(a,{remove:!1}),d.isLoading=!1}),1/0==this.maxCount&&(e=_.omit(e,["l","s","f","sk"]),e=_.extend(e,{c:!0}),$.getJSON(this.url,e,function(a){d.maxCount=a.count}))}}),Barista.Collections.SignatureCollection=Backbone.Collection.extend({initialize:function(){this.url=Barista.APIURL+"/a2/siginfo?callback=?"},model:Barista.Models.SignatureModel,skip:0,isLoading:!1,maxCount:1/0,gold_only:!0,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=void 0!==a?a:"",this.search_type=void 0!==b?b:"",this.limit=void 0!==c?c:30,("single"===b||""===b)&&(this.q_param=this.gold_only?'{"pert_id":"'+a+'","is_gold":1}':'{"pert_id":"'+a+'"}'),"multi"===b&&(a='["'+a.split(":").join('","')+'"]',this.q_param=this.gold_only?'{"pert_id":{"$in":"'+a+'"},"is_gold":1,"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}':'{"pert_id":{"$in":"'+a+'"},"pert_type":{"$regex":"^(?!.*c[a-z]s$).*$"}}'),"cell"===b&&(this.q_param=this.gold_only?'{"cell_id":"'+a+'","is_gold":1}':'{"cell_id":"'+a+'"}'),this.s_param='{"pert_id":1}',this.f_param='{"pert_id":1,"pert_type":1,"pert_iname":1,"pert_itime":1,"pert_idose":1,"cell_id":1,"sig_id":1,"is_gold":1,"distil_ss":1,"distil_cc_q75":1,"ngenes_modulated_dn_lm":1,"ngenes_modulated_up_lm":1}';var e={q:this.q_param,l:this.limit,s:this.s_param,f:this.f_param,sk:this.skip},f=$.getJSON(this.url,e,function(a){d.set(a,{remove:!1}),d.isLoading=!1});return 1/0==this.maxCount&&(e=_.omit(e,["l","s","f","sk"]),e=_.extend(e,{c:!0}),$.getJSON(this.url,e,function(a){d.maxCount=a.count})),f}}),Barista.Collections.SummlyResultCollection=Backbone.Collection.extend({initialize:function(){this.url=Barista.APIURL+"/a2/pertinfo?callback=?"},model:Barista.Models.SummlyResultModel,skip:0,isLoading:!1,maxCount:1/0,getData:function(a,b,c){var d=this;this.isLoading=!0,this.search_string=a,this.search_type=b,this.limit=void 0!==c?c:30,("single"===b||void 0===b)&&(this.q_param='{"pert_iname":{"$regex":"","$options":"i"}}'),"multi"===b&&(a='["'+a.split(":").join('","')+'"]',this.q_param='{"pert_iname":{"$in":"'+a+'"}}');var e={q:this.q_param,l:this.limit,s:'{"num_gold":1}',sk:Math.round(39970*Math.random())};$.getJSON(this.url,e,function(b){var c=[],e=["ASC","HA1E","HCC515","NEU","NPC","PHH","SKL","MCF7","HEPG2","VCAP","A549","A375","HT29","PC3"];b.forEach(function(b){var d=e.slice(0,Math.round(14*Math.random())+1),f={};d.forEach(function(a){f[a]=[2*Math.random()-1]}),c.push({query:a,target:b.pert_iname,pert_type:b.pert_type,summly_score:Math.random(),summly_rank:Math.random(),specificity:Math.random(),cell_line_scores:f})}),d.add(c),d.isLoading=!1}),this.maxCount<1/0&&(e=_.omit(e,["l","s","f","sk"]),e=_.extend(e,{c:!0}),$.getJSON(this.url,e,function(a){d.maxCount=a.count}))}}),Barista.Views.BaristaBaseView=Backbone.View.extend({initialize:function(){this.base_initialize()},name:"BaristaBaseView",model:new Backbone.Model,base_initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:120,this.span_class=void 0!==this.options.span_class?this.options.span_class:"col-lg-12",this.png=void 0!==this.options.png?this.options.png:!0,this.listenTo(this.model,"change",this.update),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),$("#"+this.div_string).css("overflow","hidden"),this.render();var a=this;return $(window).resize(function(){a.render()}),this},compile_template:function(){this.div_string="barista_view"+(new Date).getTime(),this.compiled_template=BaristaTemplates.d3_target,this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},render:function(){return this.base_render(),this},base_render:function(){var a=this;return this.$el.is(":hidden")&&(this.$el.animate({opacity:0},1),this.$el.show()),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.vis.selectAll(".controls_layer").data([]).exit().remove(),this.controls_layer=this.vis.append("g").attr("class","controls_layer"),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().attr("width",this.width),this.vis.transition().attr("height",this.height),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.png&&(this.controls_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})),this},update:function(){return this},save_png:function(){this.save_png_pre();var a=$("#"+this.div_string);a.addClass("barista-base-view"),a.toggleClass("exporting"),setTimeout(function(){a.toggleClass("exporting")},500);var b=this.width,c=this.height,d='<canvas id="tmpCanvas" width="'+b+'px" height="'+c+'px"></canvas>';$("body").append(d);var e=this.vis.selectAll(".no_png_export"),f=e.attr("opacity");e.attr("opacity",0);var g=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+g+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var h=$("#tmpCanvas")[0],i=this.name+(new Date).getTime()+".png";h.toBlob&&h.toBlob(function(a){saveAs(a,i)}),$("#tmpCanvas").remove(),e.attr("opacity",f),this.save_png_post()},save_png_pre:function(){},save_png_post:function(){},hide:function(a){a=void 0!==a?a:1;var b=this;this.$el.animate({opacity:0},a),setTimeout(function(){b.$el.hide()},a)},show:function(a){a=void 0!==a?a:1,this.$el.show(),this.$el.animate({opacity:1},a)}}),Barista.Views.BarPlotView=Barista.Views.BaristaBaseView.extend({model:new Barista.Models.BarPlotModel,initialize:function(){this.range=void 0!==this.options.range?this.options.x_range:void 0,this.dynamic_range=void 0===this.range?!0:!1,this.min_lock=void 0!==this.options.min_lock?this.options.min_lock:void 0,this.max_lock=void 0!==this.options.max_lock?this.options.max_lock:void 0,this.min_expand=void 0!==this.options.min_expand?this.options.min_expand:void 0,this.max_expand=void 0!==this.options.max_expand?this.options.max_expand:void 0,this.log=void 0!==this.options.log?this.options.log:!1,this.margin=void 0!==this.options.margin?this.options.margin:50,this.orientation=void 0!==this.options.orientation?this.options.orientation:"vertical",this.set_ranges(),this.set_scales(),this.base_initialize(),this.build_axes()},render:function(){this.base_render(),this.init_plot(),this.update()},init_plot:function(){this.set_ranges(),this.set_scales(),this.build_axes(),this.style_axes(),"horizontal"===this.orientation?this.render_horizontal_bars():this.render_vertical_bars(),this.bg_layer.selectAll(".title").data([]).exit().remove(),this.bg_layer.selectAll(".title").data([1]).enter().append("text").attr("class","title title").attr("x",this.width/2).attr("y",this.margin/2).style("text-anchor","middle").text(this.model.get("title"))},update:function(){this.data=this.model.get("data"),this.set_ranges(),this.set_scales(),this.build_axes(),"horizontal"===this.orientation?this.update_horizontal_bars():this.update_vertical_bars()},set_ranges:function(){var a,b,c;this.dynamic_range===!0&&(a=this.model.get("data"),a.length>0?(void 0===this.min_lock?b=_.min(a):this.min_expand?(data_min=_.min(a),b=this.min_lock>data_min?data_min:this.min_lock):b=this.min_lock,void 0===this.max_lock?c=_.max(a):this.max_expand?(data_max=_.max(a),c=this.max_lock<data_max?data_max:this.max_lock):c=this.max_lock,this.range=[b,c]):this.range=[0,0])},set_scales:function(){this.x_scale=this.log?d3.scale.log().domain([this.range[0],this.range[1]]).range([this.margin,this.width-this.margin]):d3.scale.linear().domain([this.range[0],this.range[1]]).range([this.margin,this.width-this.margin]),this.y_scale=this.log?d3.scale.log().domain([this.range[1],this.range[0]]).range([this.margin,this.height-this.margin]):d3.scale.linear().domain([this.range[1],this.range[0]]).range([this.margin,this.height-this.margin])},build_axes:function(){var a=this;this.xAxis=d3.svg.axis().scale(this.x_scale).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.y_scale).orient("left"),this.bg_layer.selectAll(".axis").data([]).exit().remove(),"horizontal"===this.orientation?a.bg_layer.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+(a.height-a.margin)+")").call(a.xAxis):a.bg_layer.append("g").attr("class","axis y-axis").attr("transform","translate("+a.margin+",0)").call(a.yAxis)},style_axes:function(){this.vis.selectAll(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px")},render_vertical_bars:function(){var a=this;this.data=this.model.get("data"),this.x_domain=this.x_scale.range(),this.bar_width=(this.x_domain[1]-this.x_domain[0])/this.data.length,this.bg_layer.selectAll(".data_bar").data([]).exit().remove(),this.bg_layer.selectAll(".data_bar").data(this.data).enter().append("rect").attr("class","data_bar").attr("x",function(b,c){return a.bar_width*c+a.margin}).attr("y",this.y_scale(this.range[0])).attr("width",this.bar_width).attr("height",0).attr("opacity",0).attr("stroke","white").attr("fill",this.fg_color),this.bg_layer.selectAll(".x_axis_label").data([]).exit().remove(),this.bg_layer.selectAll(".x_axis_label").data([1]).enter().append("text").attr("class","x_axis_label axis_label").attr("x",this.width/2).attr("y",this.height-10).style("text-anchor","middle").text(this.model.get("axis_title"));var b=this.model.get("data_labels");b.length>0&&(this.bg_layer.selectAll(".bar_label").data([]).exit().remove(),this.bg_layer.selectAll(".bar_label").data(b).enter().append("text").attr("class","bar_label").attr("x",function(b,c){return a.bar_width*c+a.margin+a.bar_width/2}).attr("y",this.height-this.margin).attr("dy","1em").attr("opacity",0).style("text-anchor","middle").text(function(a){return a})),this.style_axes()},render_horizontal_bars:function(){var a=this;this.data=this.model.get("data"),this.y_domain=this.y_scale.range(),this.bar_height=(this.y_domain[1]-this.y_domain[0])/this.data.length,this.bg_layer.selectAll(".data_bar").data([]).exit().remove(),this.bg_layer.selectAll(".data_bar").data(this.data).enter().append("rect").attr("class","data_bar").attr("y",function(b,c){return a.bar_height*c}).attr("x",this.margin+2).attr("height",this.bar_height).attr("width",0).attr("opacity",0).attr("stroke","white").attr("fill",this.fg_color),this.bg_layer.selectAll(".x_axis_label").data([]).exit().remove(),this.bg_layer.selectAll(".x_axis_label").data([1]).enter().append("text").attr("class","x_axis_label axis_label").attr("x",this.width/2).attr("y",this.height-10).style("text-anchor","middle").text(this.model.get("axis_title"))},update_vertical_bars:function(){var a=this;this.build_axes(),this.x_domain=this.x_scale.range(),this.bar_width=(this.x_domain[1]-this.x_domain[0])/this.data.length;var b=this.bg_layer.selectAll(".data_bar").data(this.data);b.enter().append("rect").attr("class","data_bar").attr("x",function(b,c){return a.bar_width*c+a.margin}).attr("y",this.y_scale(this.range[0])).attr("width",this.bar_width).attr("height",0).attr("opacity",0).attr("stroke","white").attr("fill",this.fg_color),b.transition().duration(500).attr("x",function(b,c){return a.bar_width*c+a.margin}).attr("y",this.y_scale).attr("width",this.bar_width).attr("height",function(b){return a.y_scale(a.range[0])-a.y_scale(b)}).attr("opacity",1),b.exit().remove();var c=this.model.get("data_labels");if(c.length>0){var d=this.bg_layer.selectAll(".bar_label").data(c);d.enter().append("text").attr("class","bar_label").attr("x",function(b,c){return a.bar_width*c+a.margin+a.bar_width/2}).attr("y",this.height-this.margin).attr("dy","1em").attr("opacity",0).style("text-anchor","middle").text(function(a){return a}),d.transition().duration(500).attr("x",function(b,c){return a.bar_width*c+a.margin+a.bar_width/2}).attr("y",this.height-this.margin).attr("dy","1em").attr("opacity",1),d.exit().remove()}else this.bg_layer.selectAll(".bar_label").data([]).exit().remove();this.vis.selectAll(".y-axis").transition().duration(500).call(this.yAxis),this.style_axes()},update_horizontal_bars:function(){var a=this;this.y_domain=this.y_scale.range(),this.bar_height=(this.y_domain[1]-this.y_domain[0])/this.data.length;var b=this.bg_layer.selectAll(".data_bar").data(this.data);b.enter().append("rect").attr("class","data_bar").attr("y",function(b,c){return a.bar_height*c}).attr("x",this.margin+2).attr("height",this.bar_height).attr("width",0).attr("opacity",0).attr("stroke","white").attr("fill",this.fg_color),b.transition().duration(500).attr("width",this.x_scale).attr("opacity",1),b.exit().remove(),this.vis.selectAll(".x-axis").transition().duration(500).call(this.xAxis),this.style_axes()}}),Barista.Views.BaristaCardView=Backbone.View.extend({name:"BaristaCardView",model:new Backbone.Model,initialize:function(){this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"col-lg-12",this.url=void 0!==this.options.url?this.options.url:"",this.title=void 0!==this.options.title?this.options.title:"Title",this.subtitle=void 0!==this.options.subtitle?this.options.subtitle:"subtitle",this.image=void 0!==this.options.image?this.options.image:"",this.listenTo(this.model,"change",this.update),this.compile_template()},compile_template:function(){this.div_string="barista_view"+(new Date).getTime(),this.$el.append(BaristaTemplates.CMapCard({div_string:this.div_string,span_class:this.span_class,url:this.url,title:this.title,subtitle:this.subtitle,image:this.image,fg_color:this.fg_color}))}}),Barista.Views.BaristaUserCardView=Backbone.View.extend({name:"BaristaUserCardView",initialize:function(){this.realName=void 0!==this.options.realName?this.options.realName:"Name",this.username=void 0!==this.options.username?this.options.username:"UserName",this.email=void 0!==this.options.email?this.options.email:"user@email.com",this.badges=void 0!==this.options.badges?this.options.badges:[],this.map_badges(),this.compile_template()},compile_template:function(){this.div_string="barista_view"+(new Date).getTime(),this.$el.append(BaristaTemplates.CMapUserCard({div_string:this.div_string,name:this.realName,username:this.username,email:this.email,badges:this.badge_urls}))},map_badges:function(){var a=this;this.badge_urls=[],this.badges.forEach(function(b){switch(b){case"active":a.badge_urls.push("https://coreyflynn.github.io/Bellhop/ai/badges/active.svg");break;case"developer":a.badge_urls.push("https://coreyflynn.github.io/Bellhop/ai/badges/developer.svg");break;case"explorer":a.badge_urls.push("https://coreyflynn.github.io/Bellhop/ai/badges/explorer.svg")}})}}),Barista.Views.BubbleView=Backbone.View.extend({name:"BubbleView",model:new Barista.Models.PertCellBreakdownModel,initialize:function(){this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span4",this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:120,this.min_val=void 0!==this.options.min_val?this.options.min_val:void 0,this.max_val=void 0!==this.options.max_val?this.options.max_val:void 0,this.v_split=void 0!==this.options.v_split?this.options.v_split:void 0,this.h_split=void 0!==this.options.h_split?this.options.h_split:void 0,this.category_centers=void 0!==this.options.category_centers?this.options.category_centers:{up:{x:0,y:-10},dn:{x:0,y:10}},this.category_colors=void 0!==this.options.category_colors?this.options.category_colors:{up:"#D55E00",dn:"#56B4E9"},this.listenTo(this.model,"change",this.update),this.compile_template(),this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.render();var a=this;$(window).resize(function(){a.render()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},render:function(){function a(a){b.vertical_split(a.alpha),b.nodes.attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y})}var b=this;this.width=$("#"+this.div_string).outerWidth(),this.height=$("#"+this.div_string).outerHeight(),this.v_center=this.height/2,this.h_center=this.width/2,this.vis.transition().duration(1).attr("width",this.width),this.data=this.model.get("tree_object").children;var c,d;c=void 0!==this.max_val?this.max_val:_.max(_.pluck(this.data,"count")),d=void 0!==this.min_val?this.min_val:_.min(_.pluck(this.data,"count")),this.data_scale=d3.scale.linear().domain([d,c]).range([5,30]),this.force=d3.layout.force().nodes(this.data).gravity(.1).friction(.9).size([this.width,this.height]).on("tick",function(b){a(b)}).charge(function(a){return-Math.pow(b.data_scale(a.count),2)/6}).start(),this.vis.selectAll("circle").data(this.force.nodes()).exit().remove(),this.vis.selectAll("circle").data(this.force.nodes()).enter().append("circle").attr("class",this.div_string+"_circle").attr("fill",function(a){return void 0!==b.category_colors[a[b.v_split]]?b.category_colors[a[b.v_split]]:b.fg_color}).attr("v_category",function(a){return void 0!==b.v_split?a[b.v_split]:null}).attr("cx",300*Math.random()).attr("cy",300*Math.random()).attr("stroke","white").attr("_id",function(a){return a._id}).attr("r",function(a){return Math.sqrt(b.data_scale(a.count)/Math.PI)}),this.nodes=this.vis.selectAll("circle"),this.nodes.call(this.force.drag()),this.damp=.1},vertical_split:function(a){var b=this;bubble_selection=this.vis.selectAll("circle"),bubble_selection.attr("cy",function(c){if(void 0===b.category_centers[c[b.v_split]])return c.y;var d=b.category_centers[c[b.v_split]].y;return 0===d?c.y:(c.y=c.y+(b.v_center+d-c.y)*(b.damp+.03)*a*1.1,c.y)}).attr("cx",function(c){if(void 0===b.category_centers[c[b.v_split]])return c.x;var d=b.category_centers[c[b.v_split]].x;return 0===d?c.x:(c.x=c.x+(b.h_center-d-c.x)*(b.damp+.03)*a*1.1,c.x)})},update:function(){var a=this,b=this.model.get("tree_object").children,c=this.force.nodes();this.force.nodes().length<=b.length?(this.force.nodes().forEach(function(a,d){_.extend(a,b[d]),_.extend(a,{x:c[d].x,y:c[d].y})}),this.force.nodes().length<b.length&&this.force.nodes(this.force.nodes().concat(b.slice(this.force.nodes().length,b.length)))):(this.force.nodes(this.force.nodes().slice(0,b.length)),this.force.nodes().forEach(function(a,d){_.extend(a,b[d]),_.extend(a,{x:c[d].x,y:c[d].y})})),bubble_selection=this.vis.selectAll("circle").data(this.force.nodes()),bubble_selection.enter().append("circle").attr("class",this.div_string+"_circle").attr("fill",function(b){return void 0!==a.category_colors[b[a.v_split]]?a.category_colors[b[a.v_split]]:a.fg_color}).attr("cx",function(a){return a.x}).attr("cy",function(a){return a.y}).attr("stroke","white").attr("_id",function(a){return a._id}).attr("r",0),bubble_selection.transition().duration(500).attr("r",function(b){return a.data_scale(b.count)}),bubble_selection.exit().remove(),this.force.start(),this.nodes=this.vis.selectAll("circle"),this.nodes.call(this.force.drag())}}),Barista.Views.CMapFooterView=Backbone.View.extend({name:"CMapFooterView",initialize:function(){this.organization=void 0!==this.options.organization?this.options.organization:"Broad Institute",this.terms_url=void 0!==this.options.terms_url?this.options.terms_url:"/terms",this.logo=void 0!==this.options.logo?this.options.logo:["//coreyflynn.github.io/Bellhop/img/broad_logo_small_text.png","//coreyflynn.github.io/Bellhop/img/CMap-logox.png","//coreyflynn.github.io/Bellhop/img/skunkworks-logo.png","//hometestingblog.testcountry.com/wp-content/uploads/2013/07/roche-logo.png"],this.logo=void 0!==this.options.logo?this.options.logo:["//coreyflynn.github.io/Bellhop/img/broad_logo_small_text.png","//coreyflynn.github.io/Bellhop/img/CMap-logox.png","//coreyflynn.github.io/Bellhop/img/skunkworks-logo.png","//hometestingblog.testcountry.com/wp-content/uploads/2013/07/roche-logo.png"],this.logo_url=void 0!==this.options.logo_url?this.options.logo_url:["//www.broadinstitute.org/","//clue.io/","//www.broadinstitute.org/vis","//www.roche.com"],this.template=void 0!==this.options.template?this.options.template:"templates/CMapFooter.handlebars",this.compile_template(),this.render()
},compile_template:function(){this.compiled_template=BaristaTemplates.CMapFooter;for(var a=[],b=0;b<this.logo.length;b++)a.push({logo:this.logo[b],url:this.logo_url[b]});this.$el.append(this.compiled_template({organization:this.organization,terms_url:this.terms_url,logo_objects:a,year:(new Date).getFullYear()}))}}),Barista.Views.CMapHeaderView=Backbone.View.extend({name:"CMapHeaderView",initialize:function(){var a=this;this.title=void 0!==this.options.title?this.options.title:void 0,this.subtitle=void 0!==this.options.subtitle?this.options.subtitle:"",this.user=void 0!==this.options.user?this.options.user:Barista.Utils.cookie("user_id"),this.support_link=void 0!==this.options.support_link?this.options.support_link:"//support.lincscloud.org",this.app_color=void 0!==this.options.app_color?this.options.app_color:void 0,this.tour=void 0!==this.options.tour?this.options.tour:!0,this.compile_template(),$(".cmapHeaderMenuButton",this.$el).on("click",function(){a.trigger("cmapHeaderMenuButton:DidClick"),$(".cmap-navigation-wrapper").toggleClass("show-nav")}),this.app_color&&$("#cmapHeaderMenuAppName").css("border-bottom","5px solid "+this.app_color)},compile_template:function(){this.compiled_template=BaristaTemplates.CMapHeader,this.$el.append(this.compiled_template({title:this.title,subtitle:this.subtitle,user:this.user,support_link:this.support_link,tour:this.tour}))}}),Barista.Views.CMapNavigationView=Backbone.View.extend({name:"CMapNavigationView",initialize:function(){this.items=void 0!==this.options.items?this.options.items:["all apps","data synopsis","query","compound digest","gene digest","PCL","Concordance","history"],this.links=void 0!==this.options.links?this.options.links:["/app_list","/data_synopsis","/query","/compound_digest","/gene_digest","/pcl","/concordance","/history"],this.wrap_content(),this.build_navigation(),$("html").css("height","100%"),$("body").css("height","100%")},wrap_content:function(){$("body").children().wrapAll('<div class="cmap-navigation-content"/>'),$(".cmap-navigation-content").wrapAll('<div class="cmap-navigation-wrapper"/>')},build_navigation:function(){var a=this;$(".cmap-navigation-wrapper").prepend('<div class="cmap-navigation-menu"></div>');var b=$(".cmap-navigation-menu");this.items.forEach(function(c,d){b.append('<a href="'+a.links[d]+'" class="col-xs-12 cmap-navigation-menu-item">'+c+"</a>")}),b.prepend("<div class='cmap-spacer-large'></div>"),b.prepend("<p id='cmap-navigation-menu-close' title='close' class='cmap-navigation-menu-item cmap-header-link-no-border class=col-xs-12'>X</p>"),$(".cmap-navigation-menu-item",b).on("click",function(){$(".cmap-navigation-wrapper").toggleClass("show-nav")})},addLink:function(a,b){var c=$(".cmap-navigation-menu");c.append('<a href="'+b+'" class="col-xs-12 cmap-navigation-menu-item">'+a+"</a>")}}),Barista.Views.CellSearchBar=Backbone.View.extend({name:"CellSearchBar",initialize:function(){var a=this;this.match_cell_lines=void 0!==this.options.match_cell_lines?this.options.match_cell_lines:!0,this.placeholder=void 0!==this.options.placeholder?this.options.placeholder:"search cell lines";var b=Barista.APIURL+"/a2/cellinfo?callback=?",c={q:'{"cell_id":{"$regex":""}}',d:"cell_id"};$.getJSON(b,c,function(b){a.cell_lines=b,a.render();var c=function(){var b=$("#search",a.el).val(),c="";-1!=a.cell_lines.indexOf(b)&&a.match_cell_lines&&(c="cell"),a.trigger("search:DidType",{val:b,search_column:void 0})};$("#search",a.el).bind("input propertychange change",_.throttle(c,500)),$(".typeahead",a.el).bind("typeahead:selected typeahead:autocompleted",function(b,c){var d=c.value,e=c.search_column;a.trigger("search:DidType",{val:d,search_column:e})})})},get_val:function(){return $("#search",this.el).val()},random_val:function(){var a=this,b=Barista.APIURL+"/a2/cellinfo?callback=?",c=Math.round(40*Math.random()),d={q:'{"lincs_status":{"$in":["core_cline","core_pline","DIVR"]}}',l:1,sk:c};$.getJSON(b,d,function(b){var c=b[0].cell_id;$("#search",this.el).val(c),a.trigger("search:DidType",{val:c,search_column:"cell_id"})})},set_val:function(a){$("#search",this.el).val(a),this.trigger("search:DidType",{val:a,search_column:void 0})},render:function(){this.$el.append(BaristaTemplates.CMapPertSearchBar({placeholder:this.placeholder})),$("#search",this.$el).typeahead([Barista.Datasets.CellID,Barista.Datasets.CellLineage,Barista.Datasets.CellHistology,Barista.Datasets.CellMutation])}}),Barista.Views.CompoundDetailView=Barista.Views.BaristaBaseView.extend({name:"CompoundDetailView",model:new Barista.Models.CompoundDetailModel,initialize:function(){this.options.plot_height=260,this.open_height=this.options.plot_height,this.closed_height=this.options.plot_height,this.panel_open=!1,this.base_initialize()},render:function(){var a=this;return this.base_render(),this.model.get("structure_url")&&(this.fg_layer.selectAll(".index_text_icon").data([]).exit().remove(),this.fg_layer.selectAll(".index_text_icon").data([1]).enter().append("svg:image").attr("class","index_text_icon").attr("xlink:href",this.model.get("structure_url")).attr("x",10).attr("y",100).attr("height",150).attr("width",300).style("cursor","pointer").on("click",function(){window.location=a.model.get("structure_url")})),this.fg_layer.selectAll(".index_text").data([]).exit().remove(),this.fg_layer.selectAll(".index_text").data([1]).enter().append("text").attr("class","index_text").attr("x",10).attr("y",30).attr("fill","#E69F00").attr("font-family","Helvetica Neue").attr("font-size","20pt").text("Small Molecule Compound"),this.fg_layer.selectAll(".pert_iname_text").data([]).exit().remove(),this.fg_layer.selectAll(".pert_iname_text").data([1]).enter().append("text").attr("class","pert_iname_text").attr("x",10).attr("y",75).attr("font-family","Helvetica Neue").attr("font-weight","bold").attr("font-size","36pt").text(this.model.get("pert_iname")),this.fg_layer.selectAll(".pert_id_text").data([]).exit().remove(),this.fg_layer.selectAll(".pert_id_text").data([1]).enter().append("text").attr("class","pert_id_text").attr("x",10).attr("y",100).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(this.model.get("pert_id")),this.label_y_position=100,this.render_label_and_value("collection","Collection","pert_icollection",!1,320),this.render_label_and_value("num_sig","Signatures","num_sig",!1,320),this.render_label_and_value("gold_sig","Gold Signatures","num_gold",!1,320),this.render_label_and_value("num_inst","Experiments","num_inst",!1,320),this.render_label_and_value("summly","In Summly","in_summly",!1,320),this.label_y_position=260,this.render_label_and_value("weight","Weight","molecular_wt"),this.render_label_and_value("formula","Formula",Barista.NumbersToSubscript(this.model.get("molecular_formula")),!0),this.render_label_and_value("logp","LogP","logp"),this.render_label_and_value("vendor","Vendor","pert_vendor"),this.render_label_and_value("pubchem_cid","PubChem CID","pubchem_cid",!1,10,"//pubchem.ncbi.nlm.nih.gov/summary/summary.cgi?cid="+a.model.get("pubchem_cid")),this.render_label_and_value("inchi_key","InChIKey",this.model.get("inchi_key").split("InChIKey=")[1],!0),this.render_label_and_value("smiles","SMILES","canonical_smiles"),this.label_y_position+=20,this.model.get("alt_name")&&(this.render_label_and_value("alt_name_label","Alternate Names","",!0),this.label_y_position+=5,this.draw_tags("alt_name","Alternate Names",this.model.get("alt_name"),"white","#BDBDBD")),this.model.get("cell_id")&&(this.render_label_and_value("cell_id_label","Cell Lines","",!0),this.label_y_position+=5,this.draw_tags("cell_id","Cell Lines",this.model.get("cell_id"),"white","#CC79A7")),this.model.get("sig_id")&&(this.render_label_and_value("sig_id_label","Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("sig_id","Signature IDs",this.model.get("sig_id"),"white","#BDBDBD")),this.model.get("sig_id_gold")&&(this.render_label_and_value("gold_sig_id_label","Gold Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("gold_sig_id","Gold Signature IDs",this.model.get("sig_id_gold"),"white","#BDBDBD")),this.model.get("pert_summary")?this.render_summary({summary_string:this.model.get("pert_summary"),top:45,bottom:100,left:this.fg_layer.selectAll(".pert_iname_text").node().getComputedTextLength()+30}):this.clear_summary(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-20).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()}),this.controls_layer.selectAll("."+this.div_string+"pubchem_link").data([]).exit().remove(),this.model.get("pubchem_cid")&&this.controls_layer.selectAll("."+this.div_string+"pubchem_link").data([1]).enter().append("text").attr("class",this.div_string+"pubchem_link no_png_export").attr("x",this.width-10).attr("y",this.height-20).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("PubChem").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){window.location="//pubchem.ncbi.nlm.nih.gov/summary/summary.cgi?cid="+a.model.get("pubchem_cid")}),this.controls_layer.selectAll("."+this.div_string+"wiki_link").data([]).exit().remove(),this.model.get("wiki_url")&&this.controls_layer.selectAll("."+this.div_string+"wiki_link").data([1]).enter().append("text").attr("class",this.div_string+"wiki_link no_png_export").attr("x",this.width-80).attr("y",this.height-20).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("Wiki").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){window.location=a.model.get("wiki_url")}),this.cevron_image_link=this.panel_open?"//coreyflynn.github.io/Bellhop/img/up_arrow_select.png":"//coreyflynn.github.io/Bellhop/img/down_arrow_select.png",this.controls_layer.selectAll(".cevron_icon").data([]).exit().remove(),this.controls_layer.selectAll(".cevron_icon").data([1]).enter().append("svg:image").attr("class","cevron_icon").attr("xlink:href",this.cevron_image_link).attr("x",this.width/2-9).attr("y",function(){return a.panel_open?a.height-15:a.height-20}).attr("height",20).attr("width",18).attr("transform","rotate(0)").style("cursor","pointer").on("click",function(){a.toggle_panel_state()}),this.controls_layer.selectAll("."+this.div_string+"more_button").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"more_button").data([1]).enter().append("rect").attr("x",0).attr("y",this.height-15).attr("class",this.div_string+"more_button").attr("height",15).attr("width",this.width).attr("opacity",0).style("cursor","pointer").attr("fill","#BDBDBD").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",.25)}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",0)}).on("click",function(){a.toggle_panel_state()}),this},update:function(){return this.render(),this},render_label_and_value:function(a,b,c,d,e,f){this.label_y_position=void 0!==this.label_y_position?this.label_y_position:100,this.label_y_position+=25;var e=void 0!==e?e:10;this.open_height=this.options.plot_height>this.label_y_position+40?this.options.plot_height:this.label_y_position+40,this.fg_layer.selectAll("."+a+"_label_text").data([]).exit().remove(),this.fg_layer.selectAll("."+a+"_label_text").data([1]).enter().append("text").attr("class",a+"_label_text").attr("x",e).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(b+":"),this.fg_layer.selectAll("."+a+"_text").data([]).exit().remove();var g="";g=d?c:this.model.get(c);var h=e+this.fg_layer.selectAll("."+a+"_label_text").node().getComputedTextLength()+10;f?this.fg_layer.selectAll("."+a+"_text").data([1]).enter().append("text").attr("class",a+"_text").attr("x",h).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("fill","#BDBDBD").style("cursor","pointer").on("mouseover",function(){d3.select(this).transition().duration(500).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("fill","#BDBDBD")}).on("click",function(){window.location=f}).text(g):this.fg_layer.selectAll("."+a+"_text").data([1]).enter().append("text").attr("class",a+"_text").attr("x",h).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("fill","#BDBDBD").text(g)},render_summary:function(a){var b=this;summary_string=this.model.get("pert_summary"),top_edge=void 0!==a.top?a.top:0,bottom_edge=void 0!==a.bottom?a.bottom:100,right_edge=void 0!==a.right?a.right:this.width,left_edge=void 0!==a.left?a.left:this.width-500,this.clear_summary(),this.line_height=15,this.num_lines_allowed=Math.floor((bottom_edge-top_edge)/this.line_height),this.line_width=right_edge-left_edge,this.num_char=Math.floor(this.line_width/13/.75),this.num_char=this.num_char>60?60:this.num_char,this.num_lines=Math.ceil(summary_string.length/this.num_char),this.lines=[];for(var c=0;c<this.num_lines;c++){if(!(c<this.num_lines_allowed-1)){var d=summary_string.slice(c*this.num_char,(c+1)*this.num_char-3)+"...";this.lines.push(d);break}var d=" "!=summary_string.slice(c*this.num_char,(c+1)*this.num_char).slice(-1)&&""!=summary_string.slice(c*this.num_char,(c+1)*this.num_char).slice(this.num_char-1,this.num_char)?summary_string.slice(c*this.num_char,(c+1)*this.num_char)+"-":summary_string.slice(c*this.num_char,(c+1)*this.num_char);this.lines.push(d)}b.fg_layer.selectAll("."+b.div_string+"summary_text"+c).data(this.lines).enter().append("text").attr("class",b.div_string+"summary_text").attr("x",left_edge).attr("y",function(a,b){return top_edge+13+15*b}).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#BDBDBD").text(function(a){return a})},toggle_panel_state:function(){var a;this.panel_open?(a=this.options.plot_height,$("#"+this.div_string).animate({height:a},500),this.panel_open=!1,this.controls_layer.selectAll(".cevron_icon").attr("xlink:href","//coreyflynn.github.io/Bellhop/img/down_arrow_select.png"),this.controls_layer.selectAll(".cevron_icon").transition().duration(500).attr("y",a-20)):(a=this.open_height,$("#"+this.div_string).animate({height:a},500),this.panel_open=!0,this.controls_layer.selectAll(".cevron_icon").attr("xlink:href","//coreyflynn.github.io/Bellhop/img/up_arrow_select.png"),this.controls_layer.selectAll(".cevron_icon").transition().duration(500).attr("y",a-15)),this.controls_layer.selectAll("."+this.div_string+"more_button").transition().duration(500).attr("y",a-15),this.controls_layer.selectAll("."+this.div_string+"wiki_link").transition().duration(500).attr("y",a-20),this.controls_layer.selectAll("."+this.div_string+"pubchem_link").transition().duration(500).attr("y",a-20),this.controls_layer.selectAll("."+this.div_string+"png_export").transition().duration(500).attr("y",a-20),this.vis.transition().duration(500).attr("height",a)},draw_tags:function(a,b,c,d,e){var f=[10],g=0,h=[],i=[],j=this,k=Barista.getEmSizeInPixels(this.div_string);return this.fg_layer.selectAll("."+a+"tag_list_text").data([]).exit().remove(),this.fg_layer.selectAll("."+a+"tag_list_text").data(c).enter().append("text").attr("class",a+"tag_list_text").text(function(a){return a}).attr("x",function(a,b){i.push(this.getComputedTextLength()+15);var c=f[b];return c+i[b]>j.width?(f[b]=5,f.push(i[b]+f[b]),g+=1):f.push(i[b]+f[b]),h.push(1.5*g+1),f[b]}).attr("y",function(a,b){return j.label_y_position+h[b]*k}).attr("opacity",1).attr("fill",d),this.bg_layer.selectAll("."+a+"tag_list_rect").data([]).exit().remove(),this.bg_layer.selectAll("."+a+"tag_list_rect").data(c).enter().append("rect").attr("class",a+"tag_list_rect").attr("x",function(a,b){return f[b]-5}).attr("y",function(a,b){return j.label_y_position+(h[b]-1)*k}).attr("rx",4).attr("ry",4).attr("width",function(a,b){return i[b]-4}).attr("height","1.2em").attr("opacity",1).attr("fill",e),this.label_y_position+=10+h.slice(-1)[0]*k,this.open_height=this.options.plot_height>this.label_y_position+40?this.options.plot_height:this.label_y_position+40,this},clear_summary:function(){this.fg_layer.selectAll(".summary_text").data([]).exit().remove()},save_png_pre:function(){this.fg_layer.selectAll(".index_text_icon").data([]).exit().remove(),this.fg_layer.selectAll(".index_text").attr("x",10)},save_png_post:function(){this.fg_layer.selectAll(".index_text_icon").data([]).exit().remove(),this.fg_layer.selectAll(".index_text_icon").data([1]).enter().append("svg:image").attr("class","index_text_icon").attr("xlink:href","//coreyflynn.github.io/Bellhop/img/CP.png").attr("x",10).attr("y",0).attr("height",40).attr("width",40),this.fg_layer.selectAll(".index_text").attr("x",60)}}),Barista.Views.CompoundSearchBar=Backbone.View.extend({name:"CompoundSearchBar",initialize:function(){var a=this;this.render();var b=function(){var b=$("#search",a.el).val(),c="";a.trigger("search:DidType",{val:b,type:c})};$("#search",a.el).bind("input propertychange change",_.throttle(b,500)),$(".typeahead",a.el).bind("typeahead:selected typeahead:autocompleted",function(b,c){var d=c.value,e="single";a.trigger("search:DidType",{val:d,type:e})})},get_val:function(){return $("#search",this.el).val()},random_val:function(){var a=this;skip=Math.round(4e4*Math.random());var b=Barista.APIURL+"/a2/pertinfo?callback=?";params={q:'{"pert_type":"trt_cp"}',f:'{"pert_iname":1}',l:1,sk:skip},$.getJSON(b,params,function(b){var c=b[0].pert_iname;$("#search",this.el).val(c),a.trigger("search:DidType",{val:c,type:"single"})})},set_val:function(a){$("#search",this.el).val(a),this.trigger("search:DidType",{val:a,type:"single"})},render:function(){this.$el.append(BaristaTemplates.CMapPertSearchBar()),$("#search",this.$el).typeahead([{limit:2,name:"Reagents",template:'<span class="label" style="background-color: {{ color }}">{{ type }}</span> {{ value }}',engine:Hogan,remote:{url:[Barista.APIURL+"/a2/pertinfo?",'q={"pert_iname":{"$regex":"%QUERY", "$options":"i"}, "pert_type":"trt_cp"}','&f={"pert_iname":1,"pert_type":1}',"&l=100",'&s={"pert_iname":1}'].join(""),dataType:"jsonp",filter:function(a){var b=[],c=[],d={};return a.forEach(function(a){c.push(a.pert_iname),d[a.pert_iname]=a}),c=_.uniq(c),c.forEach(function(a){var c={value:a,tokens:[a],data:d[a]};return"trt_cp"===d[a].pert_type?(_.extend(c,{type:"Chemical Reagent",color:"#E69F00"}),b.push(c),b):(_.extend(c,{type:d[a].pert_type,color:"#999"}),b.push(c),b)}),b}}}])}}),Barista.Views.FlatTreeMapView=Backbone.View.extend({name:"FlatTreeMapView",model:new Barista.Models.PertCellBreakdownModel,initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#d9d9d9",this.well_color=void 0!==this.options.well_color?this.options.well_color:"#bdbdbd",this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"span4",this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:300,this.category_html=void 0!==this.options.category_html?this.options.category_html:null,this.shadow_el=void 0!==this.options.shadow_el?this.options.shadow_el:null,this.shadow_root=void 0!==this.options.shadow_root?this.options.shadow_root:null,this.listenTo(this.model,"change",this.update_vis),this.compile_template(),this.$div=this.shadow_el&&this.shadow_root?$(this.shadow_root).children(this.shadow_el).children("#"+this.div_string):$("#"+this.div_string),this.width=this.$div.width(),this.height=this.$div.outerHeight(),this.top_svg=d3.select(this.$div[0]).append("svg").attr("width",this.width).attr("height",this.height),this.vis=this.top_svg.append("g"),this.render();var a=this;$(window).resize(function(){a.render()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},render:function(){var a=this;this.width=this.$div.width(),this.height=this.$div.outerHeight(),this.top_svg.transition().duration(1).attr("width",this.width),this.treemap=d3.layout.treemap().size([this.width,this.height]).sticky(!1).round(!0).sort(function(a,b){return a.count-b.count}).value(function(a){return a.count}),this.data=this.model.get("tree_object"),_.isEmpty(this.data.children)?this.top_svg.transition().duration(1).attr("opacity",0):this.top_svg.transition().duration(500).attr("opacity",1),this.min_count=_.min(_.pluck(this.data.children,"count")),this.max_count=_.max(_.pluck(this.data.children,"count")),this.opacity_map=d3.scale.linear().domain([this.min_count,this.max_count,this.max_count+1]).range([1,1,0]),this.vis.data([this.data]).selectAll("rect").data([]).exit().remove(),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",function(b){return a.opacity_map(b.value)}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("_id",function(a){return a._id}).attr("count",function(a){return a.count}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("stroke","white").attr("stroke-width",2),this.category_html?a.draw_foreignObject():(a.draw_text(),a.add_tooltips()),this.top_svg.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.top_svg.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1)}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25)}).on("click",function(){a.savePng()})},update_vis:function(){var a=this;this.data=this.model.get("tree_object"),_.isEmpty(this.data.children)?this.top_svg.transition().duration(1).attr("opacity",0):this.top_svg.transition().duration(500).attr("opacity",1),this.min_count=_.min(_.pluck(this.data.children,"count")),this.max_count=_.max(_.pluck(this.data.children,"count")),this.opacity_map=d3.scale.linear().domain([this.min_count,this.max_count,this.max_count+1]).range([1,1,0]),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).enter().append("rect").attr("class",this.div_string+"_cell").attr("fill",this.fg_color).attr("opacity",function(b){return a.opacity_map(b.value)}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("_id",function(a){return a._id}).attr("count",function(a){return a.count}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}).attr("stroke","white").attr("stroke-width",2),this.vis.data([this.data]).selectAll("rect").transition().ease("cubic out").duration(500).attr("opacity",function(b){return a.opacity_map(b.value)}).attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("_id",function(a){return a._id}).attr("count",function(a){return a.count}).attr("width",function(a){return a.dx}).attr("height",function(a){return a.dy}),this.vis.data([this.data]).selectAll("rect").data(this.treemap.nodes).exit().remove(),this.clear_text(),this.category_html?setTimeout(function(){a.draw_foreignObject()},500):setTimeout(function(){a.draw_text(),a.add_tooltips()},500)},add_tooltips:function(){var a=$("."+this.div_string+"_cell");a.each(function(){$(this).tooltip("destroy")}),a.length>1&&a.each(function(){$(this).tooltip({placement:"top",container:"body",trigger:"hover focus",title:$(this).attr("_id")+" : "+Math.round($(this).attr("count"))})})},clear_text:function(){this.vis.data([this.data]).selectAll("text.name").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.count").data([]).exit().remove(),this.vis.data([this.data]).selectAll(".foreign").data([]).exit().remove()},draw_foreignObject:function(){var a=this;this.vis.data([this.data]).selectAll(".foreign").data([]).exit().remove(),this.vis.data([this.data]).selectAll(".foreign").data(this.treemap.nodes).enter().append("foreignObject").attr("class","foreign").attr("x",function(a){return a.x}).attr("y",function(a){return a.y}).attr("height",function(a){return a.dy}).attr("width",function(a){return a.dx}).attr("opacity",function(a){return a.dy<50||a.dx<50?0:1}).append("xhtml:body").style("background-color","rgba(0,0,0,0)").style("height","100%").style("width","100%").style("display","flex").style("display","-webkit-box").style("display","-webkit-flex").style("display","-ms-flexbox").html(function(b){return void 0===b.children?a.category_html[b._id]:""})},draw_text:function(){this.vis.data([this.data]).selectAll("text.name").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.name").data(this.treemap.nodes).enter().append("text").attr("class","name").text(function(a){return a.dy<20||a.dx<80?null:a.children?null:a._id}).attr("text-anchor","middle").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("fill","white").attr("opacity",0).style("pointer-events","none").transition().duration(500).attr("opacity",1),this.vis.data([this.data]).selectAll("text.count").data([]).exit().remove(),this.vis.data([this.data]).selectAll("text.count").data(this.treemap.nodes).enter().append("text").attr("class","name").text(function(a){return a.dy<40||a.dx<80?null:a.children?null:Barista.numberWithCommas(a.count)}).attr("text-anchor","middle").attr("x",function(a){return a.x+a.dx/2}).attr("y",function(a){return a.y+a.dy/2+20}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("fill","black").attr("opacity",0).style("pointer-events","none").transition().duration(500).attr("opacity",1)},savePng:function(){var a=this.$div;a.addClass("barista-base-view"),a.toggleClass("exporting"),setTimeout(function(){a.toggleClass("exporting")},500);var b=this.top_svg.attr("width"),c=this.top_svg.attr("height"),d='<canvas id="tmpCanvas" width="'+b+'px" height="'+c+'px"></canvas>';$("body").append(d);var e=this.top_svg.selectAll("."+this.div_string+"png_export").data([1]),f=e.attr("opacity");e.attr("opacity",0);var g=this.top_svg.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+g+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var h=$("#tmpCanvas")[0],i="cmapTreeMap"+(new Date).getTime()+".png";h.toBlob&&h.toBlob(function(a){saveAs(a,i)}),$("#tmpCanvas").remove(),e.attr("opacity",f)}}),Barista.Views.GenericCountView=Barista.Views.BaristaBaseView.extend({name:"GenericCountView",model:new Barista.Models.PertCountModel,initialize:function(){this.label=void 0!==this.options.label?this.options.label:"Signatures",this.duration=void 0!=this.options.duration?this.options.duration:500,this.top_bar_color=void 0!==this.options.top_bar_color?this.options.top_bar_color:"white",this.base_initialize();var a=this;return $(window).resize(function(){a.update()}),this},render:function(){return this.base_render().renderTopBar().renderLabel().renderCount(),this},update:function(){this.updateCount()},renderTopBar:function(){return this.fg_layer.selectAll(".genericCountViewTopBar").data([]).exit().remove(),this.fg_layer.selectAll(".genericCountViewTopBar").data([1]).enter().append("rect").attr("class","genericCountViewTopBar").attr("height","2px").attr("width",this.width).attr("fill",this.top_bar_color),this},renderLabel:function(){return this.fg_layer.selectAll(".genericCountViewLabel").data([]).exit().remove(),this.fg_layer.selectAll(".genericCountViewLabel").data([1]).enter().append("text").attr("class","genericCountViewLabel").attr("y",25).attr("font-family","'Open Sans").attr("font-weight","300").attr("font-size","16px").attr("fill","#444444").text(this.label),this},renderCount:function(){var a=this.model.get("count");return"number"!=typeof a&&(a=0),this.fg_layer.selectAll(".genericCountViewCount").data([]).exit().remove(),this.fg_layer.selectAll(".genericCountViewCount").data([1]).enter().append("text").attr("class","genericCountViewCount").attr("y",60).attr("font-family","'Open Sans").attr("font-weight","500").attr("font-size","37px").attr("fill",this.fg_color).text(Barista.numberWithCommas(a)),this},updateCount:function(){var a=this.model.get("count");return"number"!=typeof a&&(a=0),this.fg_layer.selectAll(".genericCountViewCount").data([1]).transition().duration(this.duration).tween("text",function(){var b=d3.interpolate(this.textContent.replace(",",""),a);return function(a){this.textContent=Barista.numberWithCommas(Math.round(b(a)))}}),this}}),Barista.Views.GridView=Backbone.View.extend({name:"GridView",initialize:function(){var a=this;this.search_val="",this.search_type="single",this.span_class=void 0!==this.options.span_class?this.options.span_class:"col_lg_12",this.legend=void 0!==this.options.legend?this.options.legend:null,this.no_download=void 0!==this.options.no_download?this.options.no_download:null,this.no_slice=void 0!==this.options.no_slice?this.options.no_slice:null,this.no_legend=void 0!==this.options.no_legend?this.options.no_legend:null,this.edit=void 0!==this.options.edit?this.options.edit:!1,this.limit=void 0!==this.options.limit?this.options.limit:30,this.collection=void 0!==this.options.collection?this.options.collection:new Barista.Collections.PertCollection,this.columns=void 0!==this.options.columns?this.options.columns:[{name:"pert_iname",label:"Reagent Name",cell:"string",editable:!1},{name:"pert_type_label",label:"Pert Type",cell:Barista.HTMLCell,editable:!1},{name:"num_inst",label:"Experiments",cell:"integer",editable:!1}],this.compile_template();var b=Backgrid.Row.extend({events:{click:"onClick"},onClick:function(){a.trigger("grid:RowClick",this.model)},render:function(){this.$el.empty();for(var a=document.createDocumentFragment(),b=0;b<this.cells.length;b++)a.appendChild(this.cells[b].render().el);return this.el.appendChild(a),this.delegateEvents(),this.$el.css("opacity",0),this.$el.animate({opacity:1},1e3),this},remove:function(){this.$el.addClass("cmap-active-grid-row"),this.$el.animate({opacity:0},1e3);var a=this;setTimeout(function(){for(var b=0;b<a.cells.length;b++){var c=a.cells[b];c.remove.apply(c,arguments)}return Backbone.View.prototype.remove.apply(a,arguments)},1e3)}});this.grid=new Backgrid.Grid({row:b,columns:this.columns,collection:this.collection}),$("#"+this.div_string).append(this.grid.render().$el),this.add_scroll_to_top_button(),$("#"+this.div_string,this.el).scroll(function(){a.checkscroll()}),$("#"+this.div_string+"_download",this.el).click(function(){a.download_table()}),$("#"+this.div_string+"_edit",this.el).click(function(){a.open_edit_table()}),a.change_slice_button_state("slice")},checkscroll:_.debounce(function(){$("#"+this.div_string).scrollTop()>30?this.show_scroll_to_top_button():this.hide_scroll_to_top_button();var a=100,b=$("#"+this.div_string).scrollTop()+$("#"+this.div_string).height()+a;!this.collection.isLoading&&b>$("#"+this.div_string)[0].scrollHeight&&(this.collection.skip+=this.limit,this.update_collection(this.search_val,this.search_type,this.limit))},100),add_scroll_to_top_button:function(){var a=this;this.scroll_to_top_button_id=this.div_string+"scroll_button",this.$el.append('<button id="'+this.scroll_to_top_button_id+'" class="cmap_grid_to_top_button">Scroll to Top</button>'),$("#"+this.scroll_to_top_button_id).click(function(){a.scroll_to_top()
}),this.hide_scroll_to_top_button()},scroll_to_top:function(a){a=void 0!==a?a:500,$("#"+this.div_string).animate({scrollTop:0},a),this.hide_scroll_to_top_button()},show_scroll_to_top_button:function(a){a=void 0!==a?a:500,$("#"+this.scroll_to_top_button_id).clearQueue(),$("#"+this.scroll_to_top_button_id).animate({opacity:1},a)},hide_scroll_to_top_button:function(a){a=void 0!==a?a:500,$("#"+this.scroll_to_top_button_id).clearQueue(),$("#"+this.scroll_to_top_button_id).animate({opacity:0},a)},replace_collection:function(a,b,c){var d,e=this;return this.search_val=void 0!==a?a:this.search_val,this.search_type=void 0!==b?b:this.search_type,this.limit=void 0!==c?c:this.limit,$("#"+this.div_string).show(),$("#"+this.div_string).animate({opacity:1},500),this.collection.reset(),this.collection.skip=0,e.collection.maxCount=1/0,d=this.collection.getData(this.search_val,this.search_type,this.limit),this.listenToOnce(this.collection,"add",function(){this.trigger("grid:ReplaceCollection"),this.trigger("grid:Add"),this.resize_div(),e.change_slice_button_state("slice"),e.slice_defer&&e.slice_defer.reject()}),d},update_collection:function(a,b,c){var d;if(this.collection.models.length<this.collection.maxCount){return this.search_val=void 0!==a?a:this.search_val,this.search_type=void 0!==b?b:this.search_type,this.limit=void 0!==c?c:this.limit,$("#"+this.div_string).show(),$("#"+this.div_string).animate({opacity:1},500),d=this.collection.getData(this.search_val,this.search_type,this.limit),this.resize_div(),this.listenToOnce(this.collection,"add",function(){this.trigger("grid:UpdateCollection"),this.trigger("grid:Add")}),d}},clear_collection:function(){var a=this;this.collection.skip=0,$("#"+this.div_string).animate({opacity:0},500),window.setTimeout(function(){a.collection.reset(),a.collection.maxCount=1/0,$("#"+this.div_string).hide(),a.change_slice_button_state("slice"),a.slice_defer&&a.slice_defer.reject()},500)},resize_div:function(){{var a=this;$("#"+this.div_string).height()}setTimeout(function(){var b=30*a.collection.length+40,c=b>300?300:b;$("#"+a.div_string).stop(),$("#"+a.div_string).animate({height:c},500)},500)},compile_template:function(){this.div_string="backgrid_target"+(new Date).getTime(),this.$el.append(BaristaTemplates.CMapBaseGrid({div_string:this.div_string,span_class:this.span_class,legend:this.legend,no_download:this.no_download,no_slice:this.no_slice,no_legend:this.no_legend,edit:this.edit}))},slice_all_table_data:function(){var a=this;this.change_slice_button_state("progress"),this.slice_defer=$.Deferred(),this.slice_defer.fail(function(){a.change_slice_button_state("slice")}),sig_slice="//prefix:8080/a2/sigslice?callback=?",$.ajax({dataType:"json",url:sig_slice,data:{q:a.collection.q_param,l:1e3},success:function(b){b.file_url?a.change_slice_button_state("link",b.file_url):a.change_slice_button_state("fail")},error:function(){a.change_slice_button_state("fail")}}),this.slice_timeout=setTimeout(function(){a.change_slice_button_state("fail")},6e4)},change_slice_button_state:function(a,b){var c=this;switch($("#"+c.div_string+"_slice",c.el).unbind(),a){case"slice":$("#"+c.div_string+"_slice",c.el).html('<font color="#0072B2"><i class="icon-cogs"></i> slice all data</font>'),$("#"+this.div_string+"_slice",this.el).click(function(){c.slice_all_table_data()}),clearTimeout(c.slice_timeout);break;case"progress":$("#"+this.div_string+"_slice",this.el).html('<font color="#0072B2"><i class="icon-cog icon-spin"></i> slicing</font>'),$("#"+this.div_string+"_slice",this.el).unbind();break;case"link":var d=['<a href="',b,'" class="cmap-link">','<font color="#0072B2"><i class="icon-download"></i> download slice</font></a>'].join("");$("#"+c.div_string+"_slice",c.el).html(d),c.slice_defer.resolve(),clearTimeout(c.slice_timeout);break;case"fail":$("#"+c.div_string+"_slice",c.el).html('<font color="#D55E00"><i class="icon-exclamation"></i> slice failed. try again?</font>'),$("#"+c.div_string+"_slice",c.el).click(function(){c.slice_all_table_data()}),c.slice_defer.resolve(),clearTimeout(c.slice_timeout)}},download_table:function(){var a=this;$("#"+this.div_string+"_download",this.el).html('<font color="#0072B2"><i class="icon-refresh icon-spin"></i> exporting</font>');var b=this.collection.url,c={q:this.collection.q_param,l:0,s:this.collection.s_param},d=_.pluck(this.columns,"label").join("	"),e=_.pluck(this.columns,"name");$.getJSON(b,c,function(b){var c=[d];b.forEach(function(a){var b=[];e.forEach(function(c){switch(c){case"pert_type_label":b.push(Barista.CMapPertTypeAlias(a.pert_type).acronym);break;case"view_result_link":b.push(a.standard_result);break;case"rpt":b.push(a.params.rpt);break;case"tool_id":b.push(a.params.tool_id);break;case"date":b.push(String(new Date(1e3*parseInt(a._id.substring(0,8),16))));break;default:b.push(String(a[c]))}}),line_string=b.join("	"),c.push(line_string)});var f=c.join("\n"),g=new Blob([f],{type:"text/plain;charset=utf-8"}),h=(new Date).getTime();saveAs(g,"CMapTable"+h+".txt"),$("#"+a.div_string+"_download",a.el).html('<font color="#0072B2"><i class="icon-share"></i> export table</font>')})},open_edit_table:function(){var a=this;console.log("opening edit"),this.grid.columns.unshift({name:"edit",label:"Edit",cell:Barista.HTMLCell,editable:!1}),$("#"+this.div_string+"_edit",this.el).html('<font color="#e51c23"><i class="fa fa-times-circle"></i> done editing </font>'),$("#"+this.div_string+"_edit",this.el).unbind(),$("#"+this.div_string+"_edit",this.el).click(function(){a.close_edit_table()})},close_edit_table:function(){var a=this,b=this.grid.columns.where({name:"edit"});this.grid.removeColumn(b),$("#"+this.div_string+"_edit",this.el).html('<font color="#e51c23"><i class="fa fa-times-circle"></i> edit </font>'),$("#"+this.div_string+"_edit",this.el).unbind(),$("#"+this.div_string+"_edit",this.el).click(function(){a.open_edit_table()})},hide:function(a){var b=this;this.$el.animate({opacity:0},a),setTimeout(function(){b.$el.hide()},a)},show:function(a){this.$el.show(),this.$el.animate({opacity:1},a)}}),Barista.HTMLFormatter=Backgrid.HTMLFormatter=function(){},Barista.HTMLFormatter.prototype=new Backgrid.CellFormatter,_.extend(Barista.HTMLFormatter.prototype,{fromRaw:function(a){return _.isUndefined(a)||_.isNull(a)?"":a}}),Barista.HTMLCell=Backgrid.HTMLCell=Backgrid.Cell.extend({className:"html-cell",formatter:new Barista.HTMLFormatter,render:function(){return this.$el.html(this.formatter.fromRaw(this.model.get(this.column.get("name")))),this}}),Barista.Views.HeatmapView=Backbone.View.extend({name:"HeatMapView",model:new Barista.Models.HeatmapModel,initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.low_color=void 0!==this.options.low_color?this.options.low_color:"#0000ff",this.high_color=void 0!==this.options.high_color?this.options.high_color:"#ff0000",this.color_scale=void 0!==this.options.color_scale?this.options.color_scale:void 0,this.annot_color_scale=void 0!==this.options.annot_color_scale?this.options.annot_color_scale:void 0,this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:300,this.template=void 0!==this.options.template?this.options.template:BaristaTemplates.d3_target,this.span_class=void 0!==this.options.span_class?this.options.span_class:"#span12",this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(this.template({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},redraw:function(){this.init_panel(),this.render()},init_panel:function(){var a=this;if(this.$el.is(":hidden")&&(this.$el.animate({opacity:0},1),this.$el.show()),this.margin=50,this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().attr("width",this.width),this.vis.transition().attr("height",this.height),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.height<this.width?(this.cell_height=(this.height-2*this.margin)/this.model.get("data").length,this.cell_width=(this.height-2*this.margin)/this.model.get("data")[0].length):(this.cell_height=(this.width-2*this.margin)/this.model.get("data").length,this.cell_width=(this.width-2*this.margin)/this.model.get("data")[0].length),this.x_center=this.width/2,this.x_offset=this.x_center-this.cell_width*this.model.get("data")[0].length/2,this.unraveled_data=this.unravel_data(this.model.get("data")),void 0===this.color_scale){var b=_.pluck(this.unraveled_data,"value");data_min=_.min(b),data_max=_.max(b),this.color=d3.scale.linear().domain([data_min,data_max]).range([this.low_color,this.high_color])}else this.color=this.color_scale;if(void 0===this.annot_color_scale){var b=_.uniq(this.model.get("annots"));this.annot_color=d3.scale.category10().domain(b)}else this.annot_color=this.annot_color_scale;this.fg_layer.selectAll(".heatmap_cell").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_cell").data(this.unraveled_data).enter().append("rect").attr("class","heatmap_cell").attr("x",function(b){return a.cell_width*b.i+a.x_offset}).attr("y",function(b){return a.cell_height*b.j+a.margin}).attr("width",this.cell_width).attr("height",this.cell_height).attr("value",function(a){return a.value}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.color(b.value)}),this.fg_layer.selectAll(".heatmap_rid").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_rid").data(this.model.get("rid")).enter().append("text").attr("class","heatmap_rid").attr("x",this.x_offset).attr("y",function(b,c){return a.cell_height*c+a.cell_height/2+a.margin}).attr("text-anchor","end").attr("dx","-.2em").text(function(a){return a}),this.fg_layer.selectAll(".heatmap_cid").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_cid").data(this.model.get("cid")).enter().append("text").attr("class","heatmap_cid").attr("y",this.margin).attr("x",function(b,c){return a.cell_width*c+a.cell_width/2+a.x_offset}).attr("text-anchor","middle").attr("dy","-.2em").text(function(a){return a}),void 0!==this.model.get("annots")&&(this.fg_layer.selectAll(".heatmap_annots").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_annots").data(this.model.get("annots")).enter().append("rect").attr("class","heatmap_annots").attr("x",function(b,c){return a.cell_width*c+a.x_offset}).attr("y",function(){return a.cell_height*a.model.get("data").length+a.cell_height/4+a.margin}).attr("width",this.cell_width).attr("height",this.cell_height/4).attr("value",function(a){return a}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.annot_color(b)}),void 0!==this.model.get("annots_label")&&(this.fg_layer.selectAll(".heatmap_annots_label").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_annots_label").data([this.model.get("annots_label")]).append("text").attr("class","heatmap_annots_label").attr("x",this.x_offset).attr("y",function(){return a.cell_height*a.model.get("data").length+a.cell_height/2+a.margin}).attr("opacity",1).attr("text-anchor","end").attr("dx","-.2em").text(function(a){return a}))),this.set_scale(),this.build_axis(),this.fg_layer.append("g").attr("class","axis y-axis").attr("transform","translate("+(this.width-this.margin/2)+",0)").call(this.yAxis),this.style_axes(),this.add_lookup_table(),this.fg_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.fg_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",this.x_offset).attr("y",this.height-10).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},add_lookup_table:function(){var a,b,c,d,e,f;a=this,b=d3.range(50),c=this.y_scale.range(),d=this.y_scale.domain(),e=(c[1]-c[0])/b.length,f=(d[0]-d[1])/b.length,this.fg_layer.selectAll(".lut_cell").data(b).enter().append("rect").attr("class","lut_cell").attr("x",a.width-a.margin/2-10).attr("y",function(b,c){return c*e+a.margin}).attr("width",10).attr("height",e).attr("fill",function(b,c){return a.color(d[0]-c*f)})},set_scale:function(){var a,b,c,d;a=this.color.domain(),b=this.margin,c=this.height-this.margin,d=[b,c],this.y_scale=d3.scale.linear().domain([a[a.length-1],a[0]]).range(d)},build_axis:function(){this.yAxis=d3.svg.axis().scale(this.y_scale).orient("right")},style_axes:function(){this.vis.selectAll(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px")},render:function(){var a=this;if(this.height<this.width?(this.cell_height=(this.height-2*this.margin)/this.model.get("data").length,this.cell_width=(this.height-2*this.margin)/this.model.get("data")[0].length):(this.cell_height=(this.width-2*this.margin)/this.model.get("data").length,this.cell_width=(this.width-2*this.margin)/this.model.get("data")[0].length),this.x_center=this.width/2,this.x_offset=this.x_center-this.cell_width*this.model.get("data")[0].length/2,this.unraveled_data=this.unravel_data(this.model.get("data")),void 0===this.color_scale){var b=_.pluck(this.unraveled_data,"value");data_min=_.min(b),data_max=_.max(b),this.color=d3.scale.linear().domain([data_min,data_max]).range([this.low_color,this.high_color])}else this.color=this.color_scale;if(void 0===this.annot_color_scale){var b=_.uniq(this.model.get("annots"));this.annot_color=d3.scale.category10().domain(b)}else this.annot_color=this.annot_color_scale;var c=this.fg_layer.selectAll(".heatmap_cell").data(this.unraveled_data);if(c.enter().append("rect").attr("class","heatmap_cell").attr("x",this.x_center).attr("y",(this.height-this.margin)/2).attr("width",0).attr("height",0).attr("opacity",0).attr("value",function(a){return a.value}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.color(b.value)}),c.transition().duration(500).attr("x",function(b){return a.cell_width*b.i+a.x_offset}).attr("y",function(b){return a.cell_height*b.j+a.margin}).attr("width",this.cell_width).attr("height",this.cell_height).attr("opacity",1).attr("fill",function(b){return a.color(b.value)}),c.exit().remove(),rid_selection=this.fg_layer.selectAll(".heatmap_rid").data(this.model.get("rid")),rid_selection.enter().append("text").attr("class","heatmap_rid").attr("x",this.x_offset).attr("y",(this.height-this.margin)/2).attr("opacity",0).attr("text-anchor","end").attr("dx","-.2em").text(function(a){return a}),rid_selection.transition().duration(500).attr("opacity",1).attr("y",function(b,c){return a.cell_height*c+a.cell_height/2+a.margin}).text(function(a){return a}),rid_selection.exit().remove(),cid_selection=this.fg_layer.selectAll(".heatmap_cid").data(this.model.get("cid")),cid_selection.enter().append("text").attr("class","heatmap_cid").attr("y",this.margin).attr("x",this.x_center).attr("opacity",0).attr("text-anchor","middle").attr("dy","-.2em").text(function(a){return a}),cid_selection.transition().duration(500).attr("opacity",1).attr("x",function(b,c){return a.cell_width*c+a.cell_width/2+a.x_offset}).text(function(a){return a}),cid_selection.exit().remove(),void 0!==this.model.get("annots")){var d=this.fg_layer.selectAll(".heatmap_annots").data(this.model.get("annots"));d.enter().append("rect").attr("class","heatmap_annots").attr("x",this.x_center).attr("y",(this.height-this.margin)/2).attr("width",0).attr("height",0).attr("opacity",0).attr("value",function(a){return a}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.annot_color(b)}),d.transition().duration(500).attr("x",function(b,c){return a.cell_width*c+a.x_offset}).attr("y",function(){return a.cell_height*a.model.get("data").length+a.cell_height/4+a.margin}).attr("width",this.cell_width).attr("height",this.cell_height/4).attr("opacity",1).attr("fill",function(b){return a.annot_color(b)}),d.exit().remove(),void 0!==this.model.get("annots_label")&&(label_text_selection=this.fg_layer.selectAll(".heatmap_annots_label").data([this.model.get("annots_label")]),label_text_selection.enter().append("text").attr("class","heatmap_annots_label").attr("x",this.x_offset).attr("y",(this.height-this.margin)/2).attr("opacity",0).attr("text-anchor","end").attr("dx","-.2em").text(function(a){return a}),label_text_selection.transition().duration(500).attr("opacity",1).attr("y",function(){return a.cell_height*a.model.get("data").length+a.cell_height/2+a.margin}).text(function(a){return a}),label_text_selection.exit().remove())}},unravel_data:function(a){return unraveled_data=[],a.forEach(function(a,b){a.forEach(function(a,c){unraveled_data.push({i:c,j:b,value:a})})}),unraveled_data},save_png:function(){var a=this.width,b=this.height,c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0);var f=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapHeatmapView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),Barista.Views.LDMapView=Backbone.View.extend({name:"LDMapView",model:new Barista.Models.HeatmapModel,initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.low_color=void 0!==this.options.low_color?this.options.low_color:"#0000ff",this.high_color=void 0!==this.options.high_color?this.options.high_color:"#ff0000",this.color_scale=void 0!==this.options.color_scale?this.options.color_scale:void 0,this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:300,this.template=void 0!==this.options.template?this.options.template:BaristaTemplates.d3_target,this.span_class=void 0!==this.options.span_class?this.options.span_class:"#span12",this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(this.template({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},redraw:function(){this.init_panel(),this.render()},init_panel:function(){var a=this;if(this.$el.is(":hidden")&&(this.$el.animate({opacity:0},1),this.$el.show()),this.margin=50,this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".ld_cell_layer").data([]).exit().remove(),this.ld_cell_layer=this.vis.append("g").attr("class","ld_cell_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().attr("width",this.width),this.vis.transition().attr("height",this.height),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.height<this.width?(this.cell_height=(this.height-this.margin)/this.model.get("data").length,this.cell_width=(this.height-this.margin)/this.model.get("data")[0].length):(this.cell_height=(this.width-this.margin)/this.model.get("data").length,this.cell_width=(this.width-this.margin)/this.model.get("data")[0].length),this.x_center=this.width/2,this.x_offset=this.x_center-this.cell_width*this.model.get("data")[0].length/2,this.unraveled_data=this.unravel_data(this.model.get("data")),void 0===this.color_scale){var b=_.pluck(this.unraveled_data,"value");data_min=_.min(b),data_max=_.max(b),this.color=d3.scale.linear().domain([data_min,data_max]).range([this.low_color,this.high_color])}else this.color=this.color_scale;this.ld_cell_layer.selectAll(".heatmap_cell").data([]).exit().remove(),this.ld_cell_layer.selectAll(".heatmap_cell").data(this.unraveled_data).enter().append("rect").attr("class","heatmap_cell").attr("x",function(b){return a.cell_width*b.i+a.x_offset}).attr("y",function(b){return a.cell_height*b.j+a.margin}).attr("transform",function(){var b=a.cell_width+a.x_offset,c=a.cell_height+a.margin;return"rotate(45,"+b+","+c+")"}).attr("width",this.cell_width).attr("height",this.cell_height).attr("value",function(a){return a.value}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.color(b.value)}),this.fg_layer.selectAll(".heatmap_rid").data([]).exit().remove(),this.fg_layer.selectAll(".heatmap_rid").data(this.model.get("rid")).enter().append("text").attr("class","heatmap_rid").attr("x",this.x_offset).attr("y",function(b,c){return a.diamond_height*c+a.diamond_height/2+a.margin}).attr("text-anchor","end").attr("dx","-.2em").text(function(a){return a}),this.fg_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.fg_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",this.x_offset).attr("y",this.height-10).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},render:function(){var a=this,b=this.height-this.margin;if(this.diamond_height=b/this.model.get("data").length,this.cell_height=this.cell_width=Math.sqrt(Math.pow(this.diamond_height,2)/2),this.x_center=this.width/2,this.x_offset=this.x_center-this.cell_width*this.model.get("data")[0].length/2,this.unraveled_data=this.unravel_data(this.model.get("data")),void 0===this.color_scale){var c=_.pluck(this.unraveled_data,"value");data_min=_.min(c),data_max=_.max(c),this.color=d3.scale.linear().domain([data_min,data_max]).range([this.low_color,this.high_color])}else this.color=this.color_scale;var d=this.ld_cell_layer.selectAll(".heatmap_cell").data(this.unraveled_data);d.enter().append("rect").attr("class","heatmap_cell").attr("x",this.x_center).attr("y",(this.height-this.margin)/2).attr("width",0).attr("height",0).attr("opacity",0).attr("value",function(a){return a.value}).attr("stroke","white").attr("stroke-width",1).attr("fill",function(b){return a.color(b.value)}),d.transition().duration(500).attr("x",function(b){return a.cell_width*b.i+a.x_offset}).attr("y",function(b){return a.cell_height*b.j+a.margin}).attr("transform",function(){var b=a.cell_width+a.x_offset,c=a.cell_height+a.margin;return"rotate(45,"+b+","+c+")"}).attr("width",this.cell_width).attr("height",this.cell_height).attr("opacity",1).attr("fill",function(b){return a.color(b.value)}),d.exit().remove(),rid_selection=this.fg_layer.selectAll(".heatmap_rid").data(this.model.get("rid")),rid_selection.enter().append("text").attr("class","heatmap_rid").attr("x",this.x_offset).attr("y",(this.height-this.margin)/2).attr("opacity",0).attr("text-anchor","end").attr("dy","-.5em").text(function(a){return a}),rid_selection.transition().duration(500).attr("opacity",1).attr("x",this.cell_width+this.x_offset).attr("y",function(b,c){return a.diamond_height*c+a.diamond_height/2+a.margin}).text(function(a){return a}),rid_selection.exit().remove()},unravel_data:function(a){return unraveled_data=[],a.forEach(function(a,b){a.forEach(function(a,c){c>b&&unraveled_data.push({i:c,j:b,value:a})})}),unraveled_data},save_png:function(){var a=this.width,b=this.height,c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0);var f=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapHeatmapView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),Barista.Views.PertCountView=Backbone.View.extend({name:"PertCountView",model:new Barista.Models.PertCountModel,initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#ffffff",this.well_color=void 0!==this.options.well_color?this.options.well_color:"#bdbdbd",this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:"#1b9e77",this.span_class=void 0!==this.options.span_class?this.options.span_class:"col-lg-4",this.static_text=void 0!==this.options.static_text?this.options.static_text:"Reagents",this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:120,this.shadow_el=void 0!==this.options.shadow_el?this.options.shadow_el:null,this.shadow_root=void 0!==this.options.shadow_root?this.options.shadow_root:null,this.categories=void 0!==this.options.categories?this.options.categories:[],this.category_ids=_.pluck(this.categories,"_id"),this.max_category_count=_.max(_.pluck(this.categories,"count")),this.listenTo(this.model,"change",this.render),this.compile_template(),this.$div=this.shadow_el&&this.shadow_root?$(this.shadow_root).children(this.shadow_el).children("#"+this.div_string):$("#"+this.div_string),this.width=this.$div.width(),this.height=this.$div.outerHeight(),this.vis=d3.select(this.$div[0]).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},redraw:function(){this.init_panel(),this.render()},init_panel:function(){var a=this;this.width=this.$div.width(),this.height=this.$div.outerHeight(),this.vis.transition().duration(1).attr("width",this.width),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.vis.selectAll(".controls_layer").data([]).exit().remove(),this.controls_layer=this.vis.append("g").attr("class","controls_layer"),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.fg_layer.selectAll(".static_text").data([]).exit().remove(),this.fg_layer.selectAll(".static_text").data([1]).enter().append("text").attr("class","static_text").attr("x",10).attr("y",14).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","bold").attr("font-size","13pt").attr("fill",this.fg_color).text(this.static_text.toUpperCase());var b=this.model.get("count");"number"!=typeof b&&(b=0);var c=this.fg_layer.selectAll(".count").data([]).exit().remove();c=this.fg_layer.selectAll(".count").data([1]).enter().append("text").attr("class","count").attr("x",10).attr("y",55).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","bold").attr("font-size","36pt").text(b),this.category_rect_selection=this.fg_layer.selectAll(".category_rect_well"),this.category_rect_selection.data([]).exit().remove(),this.category_rect_selection.data(this.categories).enter().append("rect").attr("class","category_rect_well").attr("x",10).attr("y",function(a,b){return 35*b+80}).attr("height",10).attr("width",function(){return a.width-20}).attr("fill",this.well_color),this.category_rect_selection=this.fg_layer.selectAll(".category_rect"),this.category_rect_selection.data([]).exit().remove(),this.category_rect_selection.data(this.categories).enter().append("rect").attr("class","category_rect").attr("x",10).attr("y",function(a,b){return 35*b+80}).attr("height",10).attr("width",function(b){return(a.width-20)*(b.count/a.max_category_count)}).attr("fill",this.fg_color),this.fg_layer.selectAll(".category_name").data([]).exit().remove(),this.fg_layer.selectAll(".category_name").data(this.categories).enter().append("text").attr("class","category_name").attr("x",10).attr("y",function(a,b){return 35*b+105}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").text(function(a){return Barista.CMapPertTypeAlias(a._id).name}),this.fg_layer.selectAll(".category_value").data([]).exit().remove(),this.fg_layer.selectAll(".category_value").data(this.categories).enter().append("text").attr("class","category_value").attr("x",this.width-10).attr("y",function(a,b){return 35*b+105}).attr("font-family","'Helvetica Neue',Helvetica,Arial,sans-serif").attr("font-weight","normal").attr("font-size","12pt").attr("text-anchor","end").text("xhtml:div").text(function(a){return a.count.toFixed(0)}),this.controls_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},render:function(){var a=this;this.width=this.$div.width(),this.height=this.$div.outerHeight();var b=this.model.get("count");"number"!=typeof b&&(b=0),this.vis.selectAll(".count").data([1]).transition().duration(500).tween("text",function(){var a=d3.interpolate(this.textContent.replace(",",""),b);return function(b){this.textContent=Barista.numberWithCommas(Math.round(a(b)))}}),b=this.model.get("count"),this.pert_types=this.model.get("pert_types"),this.pert_types=_.filter(this.pert_types,function(b){return-1!=a.category_ids.indexOf(b._id)});var c=_.pluck(this.pert_types,"count"),d=_.reduce(c,function(a,b){return a+b},0);this.pert_types.push({_id:"other",count:b-d}),this.categories.forEach(function(b,c){var d=_.pluck(a.pert_types,"_id"),e=d.indexOf(b._id);a.categories[c].count=-1!=e?a.pert_types[e].count:1e-5}),this.max_category_count=_.max(_.pluck(this.categories,"count")),this.max_category_count=this.max_category_count<1?1:this.max_category_count;var e=this.fg_layer.selectAll(".category_rect").data(this.categories);e.transition().duration(500).attr("width",function(b){return(a.width-20)*(b.count/a.max_category_count)
}),this.fg_layer.selectAll(".category_value").data(this.categories).transition().duration(500).tween("text",function(a,b){var c=a.count.toFixed(0),b=d3.interpolate(this.textContent.replace(",",""),c);return function(a){this.textContent=Barista.numberWithCommas(Math.round(b(a)))}})},save_png:function(){var a=this.$div;a.addClass("barista-base-view"),a.toggleClass("exporting"),setTimeout(function(){a.toggleClass("exporting")},500);var b=this.width,c=this.height,d='<canvas id="tmpCanvas" width="'+b+'px" height="'+c+'px"></canvas>';$("body").append(d);var e=this.vis.selectAll(".no_png_export"),f=e.attr("opacity");e.attr("opacity",0);var g=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+g+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var h=$("#tmpCanvas")[0],i="BaristaPertCountView"+(new Date).getTime()+".png";h.toBlob&&h.toBlob(function(a){saveAs(a,i)}),$("#tmpCanvas").remove(),e.attr("opacity",f)}}),Barista.Views.PertDetailView=Barista.Views.BaristaBaseView.extend({name:"PertDetailView",model:new Barista.Models.PertDetailModel,initialize:function(){var a=this;this.options.plot_height=260,this.open_height=this.options.plot_height,this.closed_height=this.options.plot_height,this.panel_open=!1,this.model.fetch("war","compound").then(function(){console.log(a.model.attibutes),a.base_initialize()})},render:function(){var a=this;switch(this.base_render(),this.fg_layer.selectAll(".pert_iname_text").data([]).exit().remove(),this.fg_layer.selectAll(".pert_iname_text").data([1]).enter().append("text").attr("class","pert_iname_text").attr("x",10).attr("y",75).attr("font-family","Helvetica Neue").attr("font-weight","bold").attr("font-size","36pt").text(this.model.get("pert_iname")),this.model.get("pert_summary")?this.render_summary({summary_string:this.model.get("pert_summary"),top:45,bottom:100,left:this.fg_layer.selectAll(".pert_iname_text").node().getComputedTextLength()+30}):this.clear_summary(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-20).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()}),this.cevron_image_link=this.panel_open?"//coreyflynn.github.io/Bellhop/img/up_arrow_select.png":"//coreyflynn.github.io/Bellhop/img/down_arrow_select.png",this.controls_layer.selectAll(".cevron_icon").data([]).exit().remove(),this.controls_layer.selectAll(".cevron_icon").data([1]).enter().append("svg:image").attr("class","cevron_icon").attr("xlink:href",this.cevron_image_link).attr("x",this.width/2-9).attr("y",function(){return a.panel_open?a.height-15:a.height-20}).attr("height",20).attr("width",18).attr("transform","rotate(0)").style("cursor","pointer").on("click",function(){a.toggle_panel_state()}),this.controls_layer.selectAll("."+this.div_string+"more_button").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"more_button").data([1]).enter().append("rect").attr("x",0).attr("y",this.height-15).attr("class",this.div_string+"more_button").attr("height",15).attr("width",this.width).attr("opacity",0).style("cursor","pointer").attr("fill","#BDBDBD").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",.25)}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",0)}).on("click",function(){a.toggle_panel_state()}),this.model.get("pert_type")){case"trt_cp":this.render_compound();break;case"gene":this.render_gene()}return this},render_compound:function(){this.clear_label_and_text();var a=this;this.fg_layer.selectAll(".pert_id_text").data([]).exit().remove(),this.fg_layer.selectAll(".pert_id_text").data([1]).enter().append("text").attr("class","pert_id_text").attr("x",10).attr("y",100).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(this.model.get("pert_id")),this.model.get("structure_url")&&(this.fg_layer.selectAll(".index_text_icon").data([]).exit().remove(),this.fg_layer.selectAll(".index_text_icon").data([1]).enter().append("svg:image").attr("class","index_text_icon").attr("xlink:href",this.model.get("structure_url")).attr("x",10).attr("y",100).attr("height",150).attr("width",300).style("cursor","pointer").on("click",function(){window.location=a.model.get("structure_url")})),this.fg_layer.selectAll(".index_text").data([]).exit().remove(),this.fg_layer.selectAll(".index_text").data([1]).enter().append("text").attr("class","index_text").attr("x",10).attr("y",30).attr("fill","#E69F00").attr("font-family","Helvetica Neue").attr("font-size","20pt").text("Small Molecule Compound"),this.label_y_position=100,this.render_label_and_value("collection","Collection","pert_icollection",!1,320),this.render_label_and_value("num_sig","Signatures","num_sig",!1,320),this.render_label_and_value("gold_sig","Gold Signatures","num_gold",!1,320),this.render_label_and_value("num_inst","Experiments","num_inst",!1,320),this.render_label_and_value("summly","In Summly","in_summly",!1,320),this.label_y_position=260,this.render_label_and_value("weight","Weight","molecular_wt"),this.render_label_and_value("formula","Formula",Barista.NumbersToSubscript(this.model.get("molecular_formula")),!0),this.render_label_and_value("logp","LogP","logp"),this.render_label_and_value("vendor","Vendor","pert_vendor"),this.render_label_and_value("pubchem_cid","PubChem CID","pubchem_cid",!1,10,"//pubchem.ncbi.nlm.nih.gov/summary/summary.cgi?cid="+a.model.get("pubchem_cid")),this.model.get("inchi_key")&&this.render_label_and_value("inchi_key","InChIKey",this.model.get("inchi_key").split("InChIKey=")[1],!0),this.render_label_and_value("smiles","SMILES","canonical_smiles"),this.label_y_position+=20,this.model.get("alt_name")&&(this.render_label_and_value("alt_name_label","Alternate Names","",!0),this.label_y_position+=5,this.draw_tags("alt_name","Alternate Names",this.model.get("alt_name"),"white","#BDBDBD")),this.model.get("cell_id")&&(this.render_label_and_value("cell_id_label","Cell Lines","",!0),this.label_y_position+=5,this.draw_tags("cell_id","Cell Lines",this.model.get("cell_id"),"white","#CC79A7")),this.model.get("sig_id")&&(this.render_label_and_value("sig_id_label","Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("sig_id","Signature IDs",this.model.get("sig_id"),"white","#BDBDBD")),this.model.get("sig_id_gold")&&(this.render_label_and_value("gold_sig_id_label","Gold Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("gold_sig_id","Gold Signature IDs",this.model.get("sig_id_gold"),"white","#BDBDBD")),this.controls_layer.selectAll("."+this.div_string+"pubchem_link").data([]).exit().remove(),this.model.get("pubchem_cid")&&this.controls_layer.selectAll("."+this.div_string+"pubchem_link").data([1]).enter().append("text").attr("class",this.div_string+"pubchem_link no_png_export").attr("x",this.width-10).attr("y",this.height-20).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("PubChem").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){window.location="//pubchem.ncbi.nlm.nih.gov/summary/summary.cgi?cid="+a.model.get("pubchem_cid")}),this.controls_layer.selectAll("."+this.div_string+"wiki_link").data([]).exit().remove(),this.model.get("wiki_url")&&this.controls_layer.selectAll("."+this.div_string+"wiki_link").data([1]).enter().append("text").attr("class",this.div_string+"wiki_link no_png_export").attr("x",this.width-80).attr("y",this.height-20).attr("opacity",.25).attr("text-anchor","end").style("cursor","pointer").text("Wiki").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){window.location=a.model.get("wiki_url")})},render_gene:function(){this.clear_label_and_text();this.fg_layer.selectAll(".index_text").data([]).exit().remove(),this.fg_layer.selectAll(".index_text").data([1]).enter().append("text").attr("class","index_text").attr("x",10).attr("y",30).attr("fill","#0072B2").attr("font-family","Helvetica Neue").attr("font-size","20pt").text("Gene"),this.fg_layer.selectAll(".pert_id_text").data([]).exit().remove();this.fg_layer.selectAll(".pert_id_text").data([1]).enter();return this.model.get("has_kd")&&(this.fg_layer.selectAll(".kd_pert_id_text").data([]).exit().remove(),this.fg_layer.selectAll(".kd_pert_id_text").data([1]).enter().append("text").attr("class","kd_pert_id_text pert_id_text").attr("x",10).attr("y",100).attr("fill","#56B4E8").attr("font-family","Helvetica Neue").attr("font-size","14pt").text("Knockdown")),this.model.get("has_oe")&&(this.fg_layer.selectAll(".oe_pert_id_text").data([]).exit().remove(),this.fg_layer.selectAll(".oe_pert_id_text").data([1]).enter().append("text").attr("class","oe_pert_id_text pert_id_text").attr("x",350).attr("y",100).attr("fill","#D55E00").attr("font-family","Helvetica Neue").attr("font-size","14pt").text("Over Expression")),this.label_y_position=100,this.render_label_and_value("trt_sh_pert_id","ID","trt_sh_pert_id"),this.render_label_and_value("trt_oe_pert_id","ID","trt_oe_pert_id",!1,350,null,!1),this.render_label_and_value("trt_sh_num_sig","Signatures","trt_sh_num_sig"),this.render_label_and_value("trt_oe_num_sig","Signatures","trt_oe_num_sig",!1,350,null,!1),this.render_label_and_value("trt_sh_num_gold","Gold Signatures","trt_sh_num_gold"),this.render_label_and_value("trt_oe_num_gold","Gold Signatures","trt_oe_num_gold",!1,350,null,!1),this.render_label_and_value("trt_sh_num_inst","Experiments","trt_sh_num_inst"),this.render_label_and_value("trt_oe_num_inst","Experiments","trt_oe_num_inst",!1,350,null,!1),this.label_y_position=260,this.render_label_and_value("trt_sh_vector_id","Knockdown Vector","trt_sh_vector_id"),this.render_label_and_value("trt_sh_target_region","Knockdown Target Region","trt_sh_target_region"),this.render_label_and_value("trt_sh_seed_seq6","Knockdown 6 Base Seed Sequence","trt_sh_seed_seq6"),this.render_label_and_value("trt_sh_seed_seq7","Knockdown 7 Base Seed Sequence","trt_sh_seed_seq7"),this.render_label_and_value("trt_sh_target_seq","Knockdown Target Sequence","trt_sh_target_seq"),this.render_label_and_value("trt_sh_oligo_seq","Knockdown Oligo Sequence","trt_sh_oligo_seq"),this.label_y_position+=20,this.model.get("trt_sh_cell_id")&&(this.render_label_and_value("trt_sh_cell_id_label","Knockdown Cell Lines","",!0),this.label_y_position+=5,this.draw_tags("trt_sh_cell_id","Cell Lines",this.model.get("trt_sh_cell_id"),"white","#CC79A7")),this.model.get("trt_sh_sig_id")&&(this.render_label_and_value("trt_sh_sig_id_label","Knockdown Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("trt_sh_sig_id","Signature IDs",this.model.get("trt_sh_sig_id"),"white","#BDBDBD")),this.model.get("trt_sh_sig_id_gold")&&(this.render_label_and_value("trt_sh_sig_id_gold_label","Gold Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("trt_sh_sig_id_gold","Knockdown Gold Signature IDs",this.model.get("trt_sh_sig_id_gold"),"white","#BDBDBD")),this.label_y_position+=20,this.model.get("trt_oe_cell_id")&&(this.render_label_and_value("trt_oe_cell_id_label","Over Expression Cell Lines","",!0),this.label_y_position+=5,this.draw_tags("trt_oe_cell_id","Cell Lines",this.model.get("trt_oe_cell_id"),"white","#CC79A7")),this.model.get("trt_oe_sig_id")&&(this.render_label_and_value("trt_oe_sig_id_label","Over Expression Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("trt_oe_sig_id","Signature IDs",this.model.get("trt_oe_sig_id"),"white","#BDBDBD")),this.model.get("trt_oe_sig_id_gold")&&(this.render_label_and_value("trt_oe_sig_id_gold_label","Gold Signature IDs","",!0),this.label_y_position+=5,this.draw_tags("trt_oe_sig_id_gold","Over Expression Gold Signature IDs",this.model.get("trt_oe_sig_id_gold"),"white","#BDBDBD")),this},update:function(){return this.render(),this},render_label_and_value:function(a,b,c,d,e,f,g){this.label_y_position=void 0!==this.label_y_position?this.label_y_position:100,void 0===g&&(g=!0),g&&(this.label_y_position+=25);var e=void 0!==e?e:10;this.open_height=this.options.plot_height>this.label_y_position+40?this.options.plot_height:this.label_y_position+40,this.fg_layer.selectAll("."+a+"_label_text").data([]).exit().remove(),this.fg_layer.selectAll("."+a+"_label_text").data([1]).enter().append("text").attr("class",a+"_label_text label_and_text").attr("x",e).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(b+":"),this.fg_layer.selectAll("."+a+"_text").data([]).exit().remove();var h="";h=d?c:this.model.get(c);var i=e+this.fg_layer.selectAll("."+a+"_label_text").node().getComputedTextLength()+10;f?this.fg_layer.selectAll("."+a+"_text").data([1]).enter().append("text").attr("class",a+"_text label_and_text").attr("x",i).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("fill","#BDBDBD").style("cursor","pointer").on("mouseover",function(){d3.select(this).transition().duration(500).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("fill","#BDBDBD")}).on("click",function(){window.location=f}).text(h):this.fg_layer.selectAll("."+a+"_text").data([1]).enter().append("text").attr("class",a+"_text label_and_text").attr("x",i).attr("y",this.label_y_position).attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("fill","#BDBDBD").text(h)},render_summary:function(a){var b=this;summary_string=this.model.get("pert_summary"),top_edge=void 0!==a.top?a.top:0,bottom_edge=void 0!==a.bottom?a.bottom:100,right_edge=void 0!==a.right?a.right:this.width,left_edge=void 0!==a.left?a.left:this.width-500,this.clear_summary(),this.line_height=15,this.num_lines_allowed=Math.floor((bottom_edge-top_edge)/this.line_height),this.line_width=right_edge-left_edge,this.num_char=Math.floor(this.line_width/13/.75),this.num_char=this.num_char>60?60:this.num_char,this.num_lines=Math.ceil(summary_string.length/this.num_char),this.lines=[];for(var c=0;c<this.num_lines;c++){if(!(c<this.num_lines_allowed-1)){var d=summary_string.slice(c*this.num_char,(c+1)*this.num_char-3)+"...";this.lines.push(d);break}var d=" "!=summary_string.slice(c*this.num_char,(c+1)*this.num_char).slice(-1)&&""!=summary_string.slice(c*this.num_char,(c+1)*this.num_char).slice(this.num_char-1,this.num_char)?summary_string.slice(c*this.num_char,(c+1)*this.num_char)+"-":summary_string.slice(c*this.num_char,(c+1)*this.num_char);this.lines.push(d)}b.fg_layer.selectAll("."+b.div_string+"summary_text"+c).data(this.lines).enter().append("text").attr("class",b.div_string+"summary_text").attr("x",left_edge).attr("y",function(a,b){return top_edge+13+15*b}).attr("font-family","Helvetica Neue").attr("font-size","13pt").attr("fill","#BDBDBD").text(function(a){return a})},toggle_panel_state:function(){var a;this.panel_open?(a=this.options.plot_height,$("#"+this.div_string).animate({height:a},500),this.panel_open=!1,this.controls_layer.selectAll(".cevron_icon").attr("xlink:href","//coreyflynn.github.io/Bellhop/img/down_arrow_select.png"),this.controls_layer.selectAll(".cevron_icon").transition().duration(500).attr("y",a-20)):(a=this.open_height,$("#"+this.div_string).animate({height:a},500),this.panel_open=!0,this.controls_layer.selectAll(".cevron_icon").attr("xlink:href","//coreyflynn.github.io/Bellhop/img/up_arrow_select.png"),this.controls_layer.selectAll(".cevron_icon").transition().duration(500).attr("y",a-15)),this.controls_layer.selectAll("."+this.div_string+"more_button").transition().duration(500).attr("y",a-15),this.controls_layer.selectAll("."+this.div_string+"wiki_link").transition().duration(500).attr("y",a-20),this.controls_layer.selectAll("."+this.div_string+"pubchem_link").transition().duration(500).attr("y",a-20),this.controls_layer.selectAll("."+this.div_string+"png_export").transition().duration(500).attr("y",a-20),this.vis.transition().duration(500).attr("height",a)},draw_tags:function(a,b,c,d,e){var f=[10],g=0,h=[],i=[],j=this,k=Barista.getEmSizeInPixels(this.div_string);return this.fg_layer.selectAll("."+a+"tag_list_text").data([]).exit().remove(),this.fg_layer.selectAll("."+a+"tag_list_text").data(c).enter().append("text").attr("class",a+"tag_list_text").text(function(a){return a}).attr("x",function(a,b){i.push(this.getComputedTextLength()+15);var c=f[b];return c+i[b]>j.width?(f[b]=5,f.push(i[b]+f[b]),g+=1):f.push(i[b]+f[b]),h.push(1.5*g+1),f[b]}).attr("y",function(a,b){return j.label_y_position+h[b]*k}).attr("opacity",1).attr("fill",d),this.bg_layer.selectAll("."+a+"tag_list_rect").data([]).exit().remove(),this.bg_layer.selectAll("."+a+"tag_list_rect").data(c).enter().append("rect").attr("class",a+"tag_list_rect").attr("x",function(a,b){return f[b]-5}).attr("y",function(a,b){return j.label_y_position+(h[b]-1)*k}).attr("rx",4).attr("ry",4).attr("width",function(a,b){return i[b]-4}).attr("height","1.2em").attr("opacity",1).attr("fill",e),this.label_y_position+=10+h.slice(-1)[0]*k,this.open_height=this.options.plot_height>this.label_y_position+40?this.options.plot_height:this.label_y_position+40,this},clear_summary:function(){this.fg_layer.selectAll(".summary_text").data([]).exit().remove()},clear_label_and_text:function(){this.fg_layer.selectAll(".label_and_text").data([]).exit().remove()}}),Barista.Views.PertSearchBar=Backbone.View.extend({name:"PertSearchBar",initialize:function(){var a=this;this.datasets=void 0!==this.options.datasets?this.options.datasets:[Barista.Datasets.CellID,Barista.Datasets.PertIName],this.match_cell_lines=void 0!==this.options.match_cell_lines?this.options.match_cell_lines:!0,this.placeholder=void 0!==this.options.placeholder?this.options.placeholder:"search gene, compound or cell type name";var b=Barista.APIURL+"/a2/cellinfo?callback=?",c={q:'{"cell_id":{"$regex":""}}',d:"cell_id"};$.getJSON(b,c,function(b){a.cell_lines=b,a.render();var c=function(){var b=$("#search",a.el).val();b="*"===b[0]?b.replace("*",".*"):b;var c="";-1!=a.cell_lines.indexOf(b)&&a.match_cell_lines&&(c="cell"),a.trigger("search:DidType",{val:b,type:c})};$("#search",a.el).bind("input propertychange change",_.throttle(c,250)),$(".typeahead",a.el).bind("typeahead:selected typeahead:autocompleted",function(b,c){var d=c.value;a.trigger("search:DidType",{val:d,type:c.type})})})},get_val:function(){return $("#search",this.el).val()},random_val:function(){var a=this;skip=Math.round(4e4*Math.random());var b=Barista.APIURL+"/a2/pertinfo?callback=?";params={q:'{"pert_type":{"$in":["trt_cp","trt_sh"]}}',f:'{"pert_iname":1}',l:1,sk:skip},$.getJSON(b,params,function(b){var c=b[0].pert_iname;$("#search",this.el).val(c),a.trigger("search:DidType",{val:c,type:"single"})})},set_val:function(a,b){b=void 0!==b?b:"single",$("#search",this.el).val(a),this.trigger("search:DidType",{val:a,type:b})},render:function(){var a=this;this.$el.append(BaristaTemplates.CMapPertSearchBar({placeholder:a.placeholder})),$("#search",this.$el).typeahead(a.datasets)}}),Barista.Views.PlatformSummaryView=Backbone.View.extend({name:"PlatformSummaryView",model:new Barista.Models.GenericCountModel,initialize:function(){this.white_color="#ffffff",this.black_color="#000000",this.orange_color="#e69f00",this.sky_blue_color="#56b4e9",this.bluish_green_color="#009e73",this.yellow_color="#f0e442",this.blue_color="#0072b2",this.vermillion_color="#d55e00",this.reddish_purple_color="#cc79a7",this.opaque_opacity=1,this.semi_opacity=.25,this.text_font_family="'Helvetica Neue',Helvetica,Arial,sans-serif",this.brand_font_family="'Memphis LT Std',Times,serif",this.navigation_font_family="Tahoma,Verdana,sans-serif",this.bold_font_weight="bold",this.medium_font_weight="medium",this.regular_font_weight="normal",this.lowercase_font_transform="lowercase",this.uppercase_font_transform="uppercase",this.sentence_font_transform="none",this.normal_letter_spacing="normal",this.wide_letter_spacing="2pt",this.fonts_default={brand:{family:this.brand_font_family,weight:this.bold_font_weight,size:"13pt",transform:this.uppercase_font_transform,spacing:this.wide_letter_spacing,color:this.black_color},control:{family:this.text_font_family,weight:this.regular_font_weight,size:"12pt",transform:this.lowercase_font_transform,spacing:this.normal_letter_spacing,color:this.sky_blue_color},count:{family:this.text_font_family,weight:this.bold_font_weight,size:"36pt",transform:this.sentence_font_transform,spacing:this.normal_letter_spacing,color:this.black_color},header:{family:this.text_font_family,weight:this.bold_font_weight,size:"13pt",transform:this.uppercase_font_transform,spacing:this.normal_letter_spacing,color:this.black_color},navigation:{family:this.navigation_font_family,weight:this.regular_font_weight,size:"9pt",transform:this.sentence_font_transform,spacing:this.normal_letter_spacing,color:this.black_color},paragraph:{family:this.text_font_family,weight:this.regular_font_weight,size:"12pt",transform:this.sentence_font_transform,spacing:this.normal_letter_spacing,color:this.black_color},subhead:{family:this.text_font_family,weight:this.medium_font_weight,size:"14pt",transform:this.sentence_font_transform,spacing:this.normal_letter_spacing,color:this.black_color},title:{family:this.text_font_family,weight:this.bold_font_weight,size:"36pt",transform:this.sentence_font_transform,spacing:this.normal_letter_spacing,color:this.black_color}},this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:this.white_color,this.fg_color=void 0!==this.options.fg_color?this.options.fg_color:this.orange_color,this.fonts=this.fonts_default,this.span_class=void 0!==this.options.span_class?this.options.span_class:"col-lg-4",this.banner_text=void 0!==this.options.banner_text?this.options.banner_text:"Platform",this.description_text=void 0!==this.options.description_text?this.options.description_text:"Platform description",this.experiments_text=void 0!==this.options.experiments_text?this.options.experiments_text:"Experiments",this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:305,this.platform_icon=void 0!==this.options.platform_icon?this.options.platform_icon:"//coreyflynn.github.io/Bellhop/img/cmap_logo_small.png",this.export_text=void 0!==this.options.export_text?this.options.export_text:"download table",this.exporting_text=void 0!==this.options.exporting_text?this.options.exporting_text:"Exporting",this.details_text=void 0!==this.options.details_text?this.options.details_text:"view details",this.details_url=void 0!==this.options.details_url?this.options.details_url:"//apps.lincscloud.org",this.details_target=void 0!==this.options.details_target?this.options.details_target:"_self",this.categories=void 0!==this.options.categories?this.options.categories:[],this.category_ids=_.pluck(this.categories,"_id"),this.max_category_count=_.max(_.pluck(this.categories,"count")),this.listenTo(this.model,"change",this.render),this.compile_template(),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.redraw();var a=this;$(window).resize(function(){a.redraw()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},redraw:function(){this.init_panel(),this.render()},apply_font:function(a,b){return b.attr("font-family",a.family).attr("font-weight",a.weight).attr("font-size",a.size).attr("style","text-transform: "+a.transform+";").attr("letter-spacing",a.spacing).attr("fill",a.color)},font_to_css_style:function(a){return"font:"+a.weight+" "+a.size+" "+a.family+"; color:"+a.color+"; text-transform:"+a.transform+"; letter-spacing:"+a.spacing+"; "},init_panel:function(){var a=this;this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.hrule0=60,this.hrule1=this.hrule0+30,this.hrule2=this.hrule1+30,this.hrule3=this.hrule2+120,this.hrule4=this.hrule3+30,this.hrule5=this.hrule4+25,this.vis.transition().duration(1).attr("width",this.width),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.vis.selectAll(".controls_layer").data([]).exit().remove(),this.controls_layer=this.vis.append("g").attr("class","controls_layer"),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color),this.fg_layer.selectAll(".banner").data([]).exit().remove();var b=this.fg_layer.append("g").attr("class","banner");b.selectAll(".banner_rect").data([]).exit().remove(),b.append("rect").attr("class","banner_rect").attr("width",this.width).attr("height",this.hrule1).attr("fill",this.fg_color),b.selectAll(".banner_text").data([]).exit().remove();var c=this.apply_font(this.fonts.title,b.selectAll(".banner_text").data([1]).enter().append("text").attr("class","banner_text").attr("y",this.hrule0).text(this.banner_text));c.each(function(){var b=this.getBBox().width,d=(a.width-b)/2;c.attr("x",d)}),this.render_description({description_string:this.description_text,left:150,top:this.hrule2,bottom:this.height,node_class:"description_text"});var d=this.model.get("count");void 0===d&&(d=0);var e=this.fg_layer.selectAll(".count").data([]).exit().remove();e=this.apply_font(this.fonts.count,this.fg_layer.selectAll(".count").data([1]).enter().append("text").attr("class","count").attr("x",40).attr("y",this.hrule3).text(d)),this.fg_layer.selectAll(".experiments_text").data([]).exit().remove(),this.apply_font(this.fonts.header,this.fg_layer.selectAll(".experiments_text").data([1]).enter().append("text").attr("class","experiments_text").attr("x",40).attr("y",this.hrule4).text(this.experiments_text)),this.fg_layer.selectAll(".platform_icon").data([]).exit().remove(),this.fg_layer.selectAll(".platform_icon").data([1]).enter().append("svg:image").attr("class","platform_icon").attr("xlink:href",this.platform_icon).attr("x",40).attr("y",this.hrule2).attr("height",60).attr("width",60),this.controls_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",40).attr("y",this.hrule5).attr("opacity",a.semi_opacity).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",a.opaque_opacity).attr("fill",a.sky_blue_color)}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",a.semi_opacity).attr("fill",a.black_color)}).on("click",function(){a.save_png()}),this.control_css_style="text-decoration:none; "+this.font_to_css_style(this.fonts.control),this.details_x=this.width-135,this.details_y=this.hrule4-15,this.export_x=this.width-270,this.export_y=this.details_y,this.export_x<180&&(this.export_x=this.details_x,this.export_y=this.details_y-30),this.render_export_control(this.export_text,"icon-download",function(){a.download_table()}),this.controls_layer.selectAll(".details_text").data([]).exit().remove(),this.controls_layer.selectAll(".details_text").data([1]).enter().append("foreignObject").attr("class","details_text").attr("width",110).attr("height",110).attr("x",this.details_x).attr("y",this.details_y).style("cursor","pointer").append("xhtml:body").style("background-color",this.bg_color).html("<a href='"+this.details_url+"' target='"+this.details_target+"' style=\""+this.control_css_style+"\"><i class='icon-chevron-sign-right'></i> "+this.details_text+"</a>")},render_export_control:function(a,b,c){return this.controls_layer.selectAll(".export_text").data([]).exit().remove(),this.controls_layer.selectAll(".export_text").data([1]).enter().append("foreignObject").attr("class","export_text").attr("width",130).attr("height",100).attr("x",this.export_x).attr("y",this.export_y).style("cursor","pointer").on("click",c).append("xhtml:body").style("background-color",this.bg_color).html('<span style="'+this.control_css_style+"\"><i class='"+b+"' style='margin-right:2px;'></i>"+a+"</span>")},download_table:function(){var a=this;this.render_export_control(this.exporting_text,"icon-refresh icon-spin",null);var b=this.model.get("url"),c={q:'{"'+this.model.get("search_field")+'":{"$regex":"'+this.model.get("search_string")+'","$options":"i"}}',l:0};$.getJSON(b,c,function(b){var c=_.keys(b[0]),d=[c.join("	")];b.forEach(function(a){var b=[];c.forEach(function(c){b.push(String(a[c]))}),line_string=b.join("	"),d.push(line_string)});var e=d.join("\n"),f=new Blob([e],{type:"text/plain;charset=utf-8"}),g=(new Date).getTime();saveAs(f,"CMapTable"+g+".txt"),a.render_export_control(a.export_text,"icon-download",function(){a.download_table()})})},render:function(){this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight();var a=this.model.get("count");void 0===a&&(a=0),this.vis.selectAll(".count").data([1]).transition().duration(500).tween("text",function(){var b=d3.interpolate(this.textContent.replace(",",""),a);return function(a){this.textContent=Barista.numberWithCommas(Math.round(b(a)))}})},render_description:function(a){var b=this;description_string=void 0!==a.description_string?a.description_string:"",top_edge=void 0!==a.top?a.top:0,bottom_edge=void 0!==a.bottom?a.bottom:100,right_edge=void 0!==a.right?a.right:this.width,left_edge=void 0!==a.left?a.left:this.width-500,node_class=void 0!=a.node_class?a.node_class:"",node_class_selector="."+node_class,this.fg_layer.selectAll(node_class_selector).data([]).exit().remove(),this.line_height=15,this.num_lines_allowed=Math.min(5,Math.floor((bottom_edge-top_edge)/this.line_height)),this.line_width=right_edge-left_edge,this.num_char=Math.floor(this.line_width/12/.65),this.num_lines=Math.ceil(description_string.length/this.num_char),this.lines=[];for(var c=0;c<this.num_lines;c++){if(!(c<this.num_lines_allowed-1)){var d=description_string.slice(c*this.num_char,(c+1)*this.num_char-3)+"...";this.lines.push(d);break}var d=" "!=description_string.slice(c*this.num_char,(c+1)*this.num_char).slice(-1)&&""!=description_string.slice(c*this.num_char,(c+1)*this.num_char).slice(this.num_char-1,this.num_char)?description_string.slice(c*this.num_char,(c+1)*this.num_char)+"-":description_string.slice(c*this.num_char,(c+1)*this.num_char);this.lines.push(d)}this.apply_font(this.fonts.paragraph,b.fg_layer.selectAll(node_class_selector).data(this.lines).enter().append("text").attr("class",node_class).attr("x",left_edge).attr("y",function(a,b){return top_edge+13+15*b}).text(function(a){return a}))},save_png:function(){var a=this.width,b=this.height,c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0),this.fg_layer.selectAll(".platform_icon").data([]).exit().remove(),this.render_description({description_string:this.description_text,left:40,top:this.hrule2,bottom:this.height,node_class:"description_text"});var f=this.vis.node().parentNode.innerHTML;this.fg_layer.selectAll(".platform_icon").data([1]).enter().append("svg:image").attr("class","platform_icon").attr("xlink:href",this.platform_icon).attr("x",40).attr("y",this.hrule2).attr("height",60).attr("width",60),this.render_description({description_string:this.description_text,left:150,top:this.hrule2,bottom:this.height,node_class:"description_text"}),canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});
var g=$("#tmpCanvas")[0],h="BaristaPlatformSummaryView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),Barista.Views.ScatterPlotView=Barista.Views.BaristaBaseView.extend({model:new Barista.Models.ScatterPlotModel,initialize:function(){this.x_range=void 0!==this.options.x_range?this.options.x_range:void 0,this.y_range=void 0!==this.options.y_range?this.options.y_range:void 0,this.dynamic_x_range=void 0===this.x_range?!0:!1,this.dynamic_y_range=void 0===this.y_range?!0:!1,this.x_min_lock=void 0!==this.options.x_min_lock?this.options.x_min_lock:void 0,this.y_min_lock=void 0!==this.options.y_min_lock?this.options.y_min_lock:void 0,this.x_max_lock=void 0!==this.options.x_max_lock?this.options.x_max_lock:void 0,this.y_max_lock=void 0!==this.options.y_max_lock?this.options.y_max_lock:void 0,this.x_min_expand=void 0!==this.options.x_min_expand?this.options.x_min_expand:void 0,this.y_min_expand=void 0!==this.options.y_min_expand?this.options.y_min_expand:void 0,this.x_max_expand=void 0!==this.options.x_max_expand?this.options.x_max_expand:void 0,this.y_max_expand=void 0!==this.options.y_max_expand?this.options.y_max_expand:void 0,this.x_log=void 0!==this.options.x_log?this.options.x_log:!1,this.y_log=void 0!==this.options.y_log?this.options.y_log:!1,this.scale_by=void 0!==this.options.scale_by?this.options.scale_by:void 0,this.margin=50,this.set_ranges(),this.set_scales(),this.build_axes(),this.base_initialize()},render:function(){this.base_render(),this.init_plot(),this.update()},init_plot:function(){this.set_ranges(),this.set_scales(),this.build_axes(),this.bg_layer.selectAll(".axis").data([]).exit().remove(),this.bg_layer.append("g").attr("class","axis x-axis").attr("transform","translate(0,"+(this.height-this.margin)+")").call(this.xAxis),this.bg_layer.append("g").attr("class","axis y-axis").attr("transform","translate("+this.margin+",0)").call(this.yAxis),this.vis.selectAll(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px").style("font","11px Open Sans"),this.set_scaling_function(),this.x_data=this.model.get("x_data"),this.y_data=this.model.get("y_data"),this.bg_layer.selectAll(".data_point").data([]).exit().remove(),this.bg_layer.selectAll(".data_point").data(this.x_data).enter().append("circle").attr("class","data_point").attr("cx",this.x_scale(0)).attr("cy",this.y_scale(0)).attr("opacity",.5).attr("r",0).attr("fill",this.fg_color),this.bg_layer.selectAll(".x_axis_label").data([]).exit().remove(),this.bg_layer.selectAll(".x_axis_label").data([1]).enter().append("text").attr("class","x_axis_label axis_label").attr("x",this.width/2).attr("y",this.height-10).attr("font-family","Open Sans").attr("font-weight","300").attr("font-size","14px").text(this.model.get("x_axis_title")),this.bg_layer.selectAll(".y_axis_label").data([]).exit().remove(),this.bg_layer.selectAll(".y_axis_label").data([1]).enter().append("text").attr("class","y_axis_label axis_label").attr("y",40).attr("x",this.margin+2).attr("dy","1em").attr("font-family","Open Sans").attr("font-weight","300").attr("font-size","14px").text(this.model.get("y_axis_title")),this.bg_layer.selectAll(".title").data([]).exit().remove(),this.bg_layer.selectAll(".title").data([1]).enter().append("text").attr("class","title").attr("x",0).attr("y",this.margin/2).attr("font-family","Open Sans").attr("font-weight","300").attr("font-size","16px").text(this.model.get("title"))},update:function(){var a=this;this.x_data=this.model.get("x_data"),this.y_data=this.model.get("y_data"),this.set_ranges(),this.set_scales(),this.build_axes(),this.set_scaling_function(),this.points_selection=this.bg_layer.selectAll(".data_point").data(this.x_data),this.points_selection.enter().append("circle").attr("class","data_point").attr("cx",this.x_scale(0)).attr("cy",this.y_scale(0)).attr("opacity",.5).attr("r",0).attr("fill",this.fg_color),this.points_selection.transition().duration(500).attr("cx",this.x_scale).attr("cy",function(b,c){return a.y_scale(a.y_data[c])}).attr("r",function(b,c){return void 0===a.scale_by?10:a.dot_scaler(a.scale_data[c])}),this.points_selection.exit().remove(),this.vis.selectAll(".x-axis").transition().duration(500).call(this.xAxis),this.vis.selectAll(".y-axis").transition().duration(500).call(this.yAxis),this.style_axes()},set_ranges:function(){var a,b,c,d;this.dynamic_x_range===!0&&(a=this.model.get("x_data"),a.length>0?(void 0===this.x_min_lock?c=_.min(a):this.x_min_expand?(data_min=_.min(a),c=this.x_min_lock>data_min?data_min:this.x_min_lock):c=this.x_min_lock,void 0===this.x_max_lock?d=_.max(a):this.x_max_expand?(data_max=_.max(a),d=this.x_max_lock<data_max?data_max:this.x_max_lock):d=this.x_max_lock,this.x_range=[c,d]):this.x_range=[0,0]),this.dynamic_y_range===!0&&(b=this.model.get("y_data"),b.length>0?(void 0===this.y_min_lock?c=_.min(b):this.y_min_expand?(data_min=_.min(b),c=this.y_min_lock>data_min?data_min:this.y_min_lock):c=this.y_min_lock,void 0===this.y_max_lock?d=_.max(b):this.y_max_expand?(data_max=_.max(b),d=this.y_max_lock<data_max?data_max:this.y_max_lock):d=this.y_max_lock,this.y_range=[c,d]):this.y_range=[0,0])},set_scales:function(){this.x_scale=this.x_log?d3.scale.log().domain([this.x_range[0],this.x_range[1]]).range([this.margin,this.width-this.margin]):d3.scale.linear().domain([this.x_range[0],this.x_range[1]]).range([this.margin,this.width-this.margin]),this.y_scale=this.y_log?d3.scale.log().domain([this.y_range[1],this.y_range[0]]).range([this.margin,this.height-this.margin]):d3.scale.linear().domain([this.y_range[1],this.y_range[0]]).range([this.margin,this.height-this.margin])},build_axes:function(){this.xAxis=d3.svg.axis().scale(this.x_scale).orient("bottom"),this.yAxis=d3.svg.axis().scale(this.y_scale).orient("left")},set_scaling_function:function(){var a=this;if(void 0!==this.scale_by){this.scale_data=this.model.get("meta_data")[this.scale_by];var b=Math.sqrt(_.min(this.scale_data)/Math.PI),c=Math.sqrt(_.max(this.scale_data)/Math.PI);this.size_scale=d3.scale.linear().domain([b,c]).range([5,20]),this.dot_scaler=function(b){return r=Math.sqrt(b/Math.PI),a.size_scale(r)}}},style_axes:function(){this.vis.selectAll(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("text").style("font-family","sans-serif").style("font","14px Open Sans")}}),Barista.Views.TagListView=Barista.Views.BaristaBaseView.extend({name:"TagListView",model:new Backbone.Model,collection:new Backbone.Collection,initialize:function(){this.base_initialize(),this.display_attribute=void 0!==this.options.display_attribute?this.options.display_attribute:"cid",this.tag_color=void 0!==this.options.tag_color?this.options.tag_color:"black",this.listener=void 0!==this.options.listener?this.options.listener:void 0,this.listener=void 0!==this.options.listener?this.options.listener:void 0,this.stopListening(),void 0!==this.listener?this.listenTo(this.collection,this.listener,this.update):(this.listenTo(this.collection,"add",this.update),this.listenTo(this.collection,"remove",this.update),this.listenTo(this.collection,"reset",this.update),this.listenTo(this.collection,"sort",this.update))},render:function(){var a=this;return this.base_render(),this.x_offsets=[5],this.row_number=0,this.y_offsets=[],this.lengths=[],this.tags=[],this.collection.models.forEach(function(b){a.tags.push(b.get(a.display_attribute))}),this.tags=_.unique(this.tags),this.draw_tags(),this},update:function(){var a=this;return this.base_render(),this.x_offsets=[5],this.row_number=0,this.y_offsets=[],this.lengths=[],this.tags=[],this.collection.models.forEach(function(b){a.tags.push(b.get(a.display_attribute))}),this.tags=_.unique(this.tags),this.draw_tags(),this},fit_height:function(){var a=Barista.getEmSizeInPixels(this.div_string);this.height=(1.5*this.row_number+3.5)*a,$("#"+this.div_string).animate({height:this.height},500),this.vis.transition().attr("height",this.height),this.controls_layer.selectAll("."+this.div_string+"png_export").data([1]).transition(500).attr("y",this.height-10)},draw_tags:function(){var a=this;return this.fg_layer.selectAll(".tag_list_text").data([]).exit().remove(),this.fg_layer.selectAll(".tag_list_text").data(this.tags).enter().append("text").attr("class","tag_list_text").text(function(a){return a}).attr("x",function(b,c){a.lengths.push(this.getComputedTextLength()+15);var d=a.x_offsets[c];return d+a.lengths[c]>a.width?(a.x_offsets[c]=5,a.x_offsets.push(a.lengths[c]+a.x_offsets[c]),a.row_number+=1):a.x_offsets.push(a.lengths[c]+a.x_offsets[c]),a.y_offsets.push(1.5*a.row_number+1),a.x_offsets[c]}).attr("y",function(b,c){return a.y_offsets[c]+"em"}).attr("opacity",1).attr("fill",this.fg_color).style("cursor","pointer").on("click",function(b){a.trigger("TagListView:DidSelect",{val:b})}),this.bg_layer.selectAll(".tag_list_rect").data([]).exit().remove(),this.bg_layer.selectAll(".tag_list_rect").data(this.tags).enter().append("rect").attr("class","tag_list_rect").attr("x",function(b,c){return a.x_offsets[c]-5}).attr("y",function(b,c){return a.y_offsets[c]-1+"em"}).attr("rx",4).attr("ry",4).attr("width",function(b,c){return a.lengths[c]-4}).attr("height","1.2em").attr("opacity",1).attr("fill",this.tag_color),this.fit_height(),this}}),Barista.Views.TickView=Backbone.View.extend({name:"TickView",model:new Barista.Models.TickModel,initialize:function(){this.bg_color=void 0!==this.options.bg_color?this.options.bg_color:"#eeeeee",this.span_class=void 0!==this.options.span_class?this.options.span_class:"#span12",this.template=void 0!==this.options.template?this.options.template:"../templates/d3_target.handlebars",this.listenTo(this.model,"change",this.redraw),this.compile_template_and_draw();var a=this;$(window).resize(function(){a.redraw()})},compile_template_and_draw:function(){this.isCompiling=!0,this.div_string="d3_target"+(new Date).getTime(),this.compiled_template=BaristaTemplates.d3_target,this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class})),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.isCompiling=!1,this.redraw()},redraw:function(){var a=this;this.width=$("#"+this.div_string).width(),$("#"+this.div_string).animate({height:18*_.keys(this.model.get("data_object")).length+50},500),setTimeout(function(){a.height=$("#"+a.div_string).outerHeight(),a.init_view(),a.render()},501)},init_view:function(){var a=this;this.$el.is(":hidden")&&(this.$el.animate({opacity:0},1),this.$el.show()),this.vis.attr("width",this.width),this.vis.attr("height",this.height),this.margin=25,this.well_offset=80,this.x_scale=d3.scale.linear().domain([-1,1]).range([this.well_offset+this.margin,this.width-this.margin]),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color);var b=d3.svg.axis().scale(this.x_scale).orient("bottom");this.vis.selectAll(".axis").data([]).exit().remove(),this.vis.append("g").attr("class","axis").attr("transform","translate(0,"+(this.height-this.margin)+")").call(b),this.vis.select(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.select(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.select(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px");var c=_.pairs(this.model.get("data_object"));c=c.sort(function(a,b){return Barista.arrayAverage(a[1])<Barista.arrayAverage(b[1])?1:Barista.arrayAverage(a[1])>Barista.arrayAverage(b[1])?-1:0});var d=[],e=[];c.forEach(function(a){d.push(a[0]),e.push(a[1])}),this.fg_layer.selectAll(".title_text").data([]).exit().remove(),this.fg_layer.selectAll(".title_text").data([1]).enter().append("text").attr("class","title_text").attr("x",this.width/2).attr("y",17).attr("fill","#56B4E9").attr("font-family","Helvetica Neue").attr("font-size","14pt").attr("text-anchor","middle").text(this.model.get("title")),this.fg_layer.selectAll(".category_well").data([]).exit().remove(),this.fg_layer.selectAll(".category_well").data(d).enter().append("rect").attr("class","category_well").attr("x",this.margin+this.well_offset).attr("y",function(a,b){return 18*b+23}).attr("height",17).attr("width",this.width-2*this.margin-this.well_offset).attr("fill",function(a,b){return b%2==0?"#bdbdbd":"#999999"}),e.forEach(function(b,c){tick_class=d[c]+"tick",a.fg_layer.selectAll("."+tick_class).data([]).exit().remove(),a.fg_layer.selectAll("."+tick_class).data(b).enter().append("rect").attr("class","tick "+tick_class).attr("x",a.x_scale).attr("y",18*c+23).attr("height",17).attr("width",3).attr("fill","#ff0000")}),this.fg_layer.selectAll("."+this.div_string+"png_export").data([]).exit().remove(),this.fg_layer.selectAll("."+this.div_string+"png_export").data([1]).enter().append("text").attr("class",this.div_string+"png_export no_png_export").attr("x",10).attr("y",this.height-10).attr("opacity",.25).style("cursor","pointer").text("png").on("mouseover",function(){d3.select(this).transition().duration(500).attr("opacity",1).attr("fill","#56B4E9")}).on("mouseout",function(){d3.select(this).transition().duration(500).attr("opacity",.25).attr("fill","#000000")}).on("click",function(){a.save_png()})},render:function(){var a=_.pairs(this.model.get("data_object"));a=a.sort(function(a,b){return Barista.arrayAverage(a[1])<Barista.arrayAverage(b[1])?1:Barista.arrayAverage(a[1])>Barista.arrayAverage(b[1])?-1:0});var b=[],c=[];a.forEach(function(a){b.push(a[0]),c.push(a[1])}),this.fg_layer.selectAll(".category_text").data([]).exit().remove(),this.category_text_selection=this.fg_layer.selectAll(".category_text").data(b),this.category_text_selection.enter().append("text").attr("class","category_text").attr("x",this.margin).attr("y",function(a,b){return 18*b+40}).attr("font-family","Helvetica Neue").attr("font-size","14pt").text(function(a){return a}),this.category_text_selection.exit().remove()},hide:function(a){function b(){c.isCompiling||(clearInterval(d),c.width=$("#"+c.div_string).width(),setTimeout(function(){c.$el.hide()},a))}a=void 0!==a?a:1;var c=this;this.$el.animate({opacity:0},a);var d=setInterval(b(),1)},show:function(a){a=void 0!==a?a:1,this.$el.show(),this.$el.animate({opacity:1},a)},save_png:function(){var a=this.vis.attr("width"),b=this.vis.attr("height"),c='<canvas id="tmpCanvas" width="'+a+'px" height="'+b+'px"></canvas>';$("body").append(c);var d=this.vis.selectAll(".no_png_export"),e=d.attr("opacity");d.attr("opacity",0);var f=this.vis.node().parentNode.innerHTML;canvg(document.getElementById("tmpCanvas"),"<svg>"+f+"</svg>",{ignoreMouse:!0,ignoreAnimation:!0});var g=$("#tmpCanvas")[0],h="cmapTickView"+(new Date).getTime()+".png";g.toBlob&&g.toBlob(function(a){saveAs(a,h)}),$("#tmpCanvas").remove(),d.attr("opacity",e)}}),Barista.Views.ViolinPlotView=Barista.Views.BaristaBaseView.extend({model:new Barista.Models.ScatterPlotModel,initialize:function(){this.x_range=void 0!==this.options.x_range?this.options.x_range:void 0,this.y_range=void 0!==this.options.y_range?this.options.y_range:void 0,this.x_log=void 0!==this.options.x_log?this.options.x_log:!1,this.y_log=void 0!==this.options.y_log?this.options.y_log:!1,this.scale_by=void 0!==this.options.scale_by?this.options.scale_by:void 0,this.base_initialize(),this.plot_height=void 0!==this.options.plot_height?this.options.plot_height:void 0,this.span_class=void 0!==this.options.span_class?this.options.span_class:"span12",this.listenTo(this.model,"change",this.update),this.compile_template(),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis=d3.select("#"+this.div_string).append("svg").attr("width",this.width).attr("height",this.height),this.render();var a=this;$(window).resize(function(){a.render()})},compile_template:function(){this.div_string="d3_target"+(new Date).getTime(),this.compiled_template=BaristaTemplates.d3_target,this.$el.append(BaristaTemplates.d3_target({div_string:this.div_string,span_class:this.span_class,height:this.plot_height}))},render:function(){this.base_render(),this.init_plot(),this.update()},init_plot:function(){var a=this;this.margin=50,void 0===this.x_range&&(this.x_range=[_.min(this.model.get("x_data")),_.max(this.model.get("x_data"))]),void 0===this.y_range&&(this.y_range=[_.min(this.model.get("y_data")),_.max(this.model.get("y_data"))]),this.x_scale=this.x_log?d3.scale.log().domain([this.x_range[0],this.x_range[1]]).range([this.margin,this.width-this.margin]):d3.scale.linear().domain([this.x_range[0],this.x_range[1]]).range([this.margin,this.width-this.margin]),this.y_scale=this.y_log?d3.scale.log().domain([this.y_range[1],this.y_range[0]]).range([this.margin,this.height-this.margin]):d3.scale.linear().domain([this.y_range[1],this.y_range[0]]).range([this.margin,this.height-this.margin]),this.vis.selectAll(".bg_layer").data([]).exit().remove(),this.bg_layer=this.vis.append("g").attr("class","bg_layer"),this.vis.selectAll(".fg_layer").data([]).exit().remove(),this.fg_layer=this.vis.append("g").attr("class","fg_layer"),this.width=$("#"+this.div_string).width(),this.height=$("#"+this.div_string).outerHeight(),this.vis.transition().attr("width",this.width),this.vis.transition().attr("height",this.height),this.bg_layer.selectAll(".bg_panel").data([]).exit().remove(),this.bg_layer.selectAll(".bg_panel").data([1]).enter().append("rect").attr("class","bg_panel").attr("height",this.height).attr("width",this.width).attr("fill",this.bg_color);{var b=d3.svg.axis().scale(this.x_scale).orient("bottom");d3.svg.axis().scale(this.y_scale).orient("left")}this.bg_layer.selectAll(".axis").data([]).exit().remove(),this.bg_layer.append("g").attr("class","axis").attr("transform","translate(0,"+(this.height-this.margin)+")").call(b),this.vis.selectAll(".axis").selectAll("path").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("line").style("fill","none").style("stroke","black").style("shape-rendering","crispEdges"),this.vis.selectAll(".axis").selectAll("text").style("font-family","sans-serif").style("font-size","11px"),this.upper_area_generator=d3.svg.area().x(function(b){return a.x_scale(b.x)}).y0(this.y_scale(0)).y1(function(b){return a.y_scale(b.y)}).interpolate("basis"),this.lower_area_generator=d3.svg.area().x(function(b){return a.x_scale(b.x)}).y0(this.y_scale(0)).y1(function(b){return a.y_scale(-1*b.y)}).interpolate("basis"),this.x_data=this.model.get("x_data"),this.y_data=this.model.get("y_data"),this.path_data=[],this.x_data.forEach(function(b,c){a.path_data.push({x:b,y:a.y_data[c]})}),this.path_data.sort(this.path_data_sorter),this.bg_layer.selectAll(".upper_violin").data([]).exit().remove(),this.bg_layer.selectAll(".upper_violin").data([1]).enter().append("path").attr("class","upper_violin").attr("opacity",.5).attr("fill",this.fg_color).attr("d",this.upper_area_generator(this.path_data)),this.bg_layer.selectAll(".lower_violin").data([]).exit().remove(),this.bg_layer.selectAll(".lower_violin").data([1]).enter().append("path").attr("class","lower_violin").attr("opacity",.5).attr("fill",this.fg_color).attr("d",this.lower_area_generator(this.path_data)),this.bg_layer.selectAll(".x_axis_label").data([]).exit().remove(),this.bg_layer.selectAll(".x_axis_label").data([1]).enter().append("text").attr("class","x_axis_label axis_label").attr("x",this.width/2).attr("y",this.height-10).style("text-anchor","middle").text(this.model.get("x_axis_title")),this.bg_layer.selectAll(".title").data([]).exit().remove(),this.bg_layer.selectAll(".title").data([1]).enter().append("text").attr("class","title title").attr("x",this.width/2).attr("y",this.margin/2).style("text-anchor","middle").text(this.model.get("title"))},update:function(){var a=this;this.x_data=this.model.get("x_data"),this.y_data=this.model.get("y_data"),this.path_data=[],this.x_data.forEach(function(b,c){a.path_data.push({x:b,y:a.y_data[c]})}),this.path_data.sort(this.path_data_sorter);var b=this.bg_layer.selectAll(".upper_violin");b.transition().duration(500).attr("d",this.upper_area_generator(this.path_data));var c=this.bg_layer.selectAll(".lower_violin");c.transition().duration(500).attr("d",this.lower_area_generator(this.path_data))},path_data_sorter:function(a,b){return a.x<b.x?-1:1}}),Barista.Views.SequenceView=Barista.Views.BaristaBaseView.extend({name:"SequenceView",model:new Barista.Models.SequenceModel,initialize:function(){this.modificationColors=void 0!==this.options.modificationColors?this.options.modificationColors:void 0,void 0===this.modificationColors&&(this.modificationColors={ac:"#ff9933",ox:"#00ccff"}),this.sequenceUnitSize=void 0!==this.options.sequenceUnitSize?this.options.sequenceUnitSize:5,this.base_initialize();var a=$("#"+this.div_string);a.addClass("barista-sequence-view")},render:function(){return this.base_render(),this.renderSequenceLine(),this.renderModifications(),this.setupZoom(),this},update:function(){return this.render(),this},getRenderLength:function(){return this.sequenceUnitSize*this.model.get("displaySequence").length>this.width-20?this.width-20:this.sequenceUnitSize*this.model.get("displaySequence").length},renderSequenceLine:function(){var a=this.getRenderLength();return this.fg_layer.selectAll(".sequenceLine").data([]).exit().remove(),this.fg_layer.selectAll(".sequenceLine").data([1]).enter().append("rect").attr("class","sequenceLine").attr("height",2).attr("width",a).attr("x",5).attr("y",this.height/2-2).attr("fill","#BFBFBF"),this},renderModifications:function(){var a=this,b=this.getRenderLength();this.fg_layer.selectAll(".sequenceModification").data([]).exit().remove(),this.fg_layer.selectAll(".sequenceModification").data(this.model.get("modifications").models).enter().append("g").each(function(){d3.select(this).append("circle").attr("class","sequenceModification").attr("r",10).attr("fill",function(b){var c=a.modificationColors[b.get("modification")];return void 0===c?"#BDBDBD":c}).attr("cx",function(c){var d=a.model.get("displaySequence").length,e=c.get("index")/d;return e*b+10}).attr("cy",a.height/2),d3.select(this).append("text").attr("class","sequenceModificationText").attr("x",function(c){var d=a.model.get("displaySequence").length,e=c.get("index")/d;switch(a.model.get("displaySequence")[c.get("index")-1]){case"M":return e*b+4;default:return e*b+5}}).attr("y",a.height/2+5).text(function(b){return a.model.get("displaySequence")[b.get("index")-1]}).attr("fill","white").attr("font-family","Open Sans").attr("font-weight","bold")})},renderModificationsText:function(){var a=this,b=this.getRenderLength();this.fg_layer.selectAll(".sequenceModificationText").data([]).exit().remove(),this.fg_layer.selectAll(".sequenceModificationText").data(this.model.get("modifications").models).enter().append("text").attr("class","sequenceModificationText").attr("x",function(c){var d=a.model.get("displaySequence").length,e=c.get("index")/d;switch(a.model.get("displaySequence")[c.get("index")-1]){case"M":return e*b+4;default:return e*b+5}}).attr("y",this.height/2+5).text(function(b){return a.model.get("displaySequence")[b.get("index")-1]}).attr("fill","white").attr("font-family","Open Sans").attr("font-weight","bold")},setupZoom:function(){function a(){b.fg_layer.attr("transform","translate("+d3.event.translate+")scale("+d3.event.scale+")")}var b=this,c=d3.behavior.zoom().scaleExtent([1,3]).on("zoom",a);c(this.vis)}}),Tile.prototype.init=function(){this.build_html(),this.inject(),this.draw_bg(),this.init_state=!0;var a=this;$(window).resize(function(){a.draw_bg()})},Tile.prototype.build_html=function(){"small"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span3" style="height:150px '+this.style+'"></div>'),"medium"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span6" style="height:300px '+this.style+'"></div>'),"wide"==this.tile_type&&(this.html='<div id="'+this.div_id+'" class="span12" style="height:300px '+this.style+'"></div>')},Tile.prototype.inject=function(){$(this.div_target).append(this.html)},Tile.prototype.draw_bg=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height),this.svg.append("g").attr("class","draw_layer"),this.svg.append("g").attr("class","link_layer"),this.link_selection=this.svg.select(".link_layer").selectAll("rect.link_rect").data([1]),this.link_selection.enter().append("a").attr("xlink:href",this.link).append("rect").attr("x",0).attr("y",0).attr("rx",20).attr("ry",20).attr("class","link_rect").attr("height",this.height).attr("width",this.width).attr("fill",this.color).attr("opacity",0)),this.svg.select(".draw_layer").selectAll("rect.bg").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll("rect.bg").data([1]).enter().append("rect").attr("x",0).attr("y",0).attr("rx",20).attr("ry",20).attr("class","bg").attr("height",this.height).attr("width",this.width).attr("fill",this.color)},Tile.prototype.hide=function(a){a=void 0!==a?a:0,$("#"+this.div_id).animate({opacity:0,width:0,height:0},a);var b=this;setTimeout(function(){$("#"+b.div_id).hide()},a)},Tile.prototype.show=function(a){a=void 0!==a?a:0,$("#"+this.div_id).show(),$("#"+this.div_id).animate({opacity:1,width:this.width,height:this.height},a)},ImageTile.prototype=new Tile({display:!1}),ImageTile.prototype.constructor=ImageTile,ImageTile.prototype.draw=function(){this.draw_bg(),this.draw_image()},ImageTile.prototype.draw_image=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height)),this.image_size=this.height-50,this.svg.select(".draw_layer").selectAll("image."+this.div_id).data([]).exit().remove(),this.image_selection=this.svg.select(".draw_layer").selectAll("image."+this.div_id).data([1]).enter().append("image").attr("xlink:href",this.image).attr("class",this.div_id).attr("x",this.width/2-this.image_size/2).attr("y",this.height/2-this.image_size/2).attr("height",this.image_size).attr("width",this.image_size)},AnimatedImageTile.prototype=new ImageTile({display:!1}),AnimatedImageTile.prototype.constructor=AnimatedImageTile,AnimatedImageTile.prototype.draw=function(){this.draw_bg(),this.draw_image()},AnimatedImageTile.prototype.start_animation=function(a,b){a=void 0!==a?a:2e3,b=void 0!==b?b:1e4+1e4*Math.random();var c=this;setInterval(function(){c.image_selection.transition().duration(a/2).attr("y",-c.image_size-10).transition().duration(1).attr("y",c.height+c.image_size+10).transition().duration(a/2).attr("y",c.height/2-c.image_size/2)},b)},ImageTextTile.prototype=new ImageTile({display:!1}),ImageTextTile.prototype.constructor=ImageTextTile,ImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text()},ImageTextTile.prototype.draw_text=function(){if(this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height)),"wide"==this.tile_type||"medium"==this.tile_type){var a,b,c,d,e;"wide"==this.tile_type&&(a=this.width/3*2,b=this.height/10*5,c=this.height/10*5,d=this.width/3-20,e="<h2>"+this.title+"</h2>"),"medium"==this.tile_type&&(a=20,b=this.height/10*8.5,c=this.height/10*1.5,d=this.width-40,e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).append("xhtml:div").style("background-color",this.color).html(e)}},AnimatedImageTextTile.prototype=new ImageTile({display:!1}),AnimatedImageTextTile.prototype.constructor=AnimatedImageTextTile,AnimatedImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text();var a=this;this.link_selection.on("mouseover",function(){a.show_text()}),this.link_selection.on("mouseout",function(){a.hide_text()})},AnimatedImageTextTile.prototype.show_text=function(){this.TextIsAnimating||$("#"+this.div_id+"_tile_text").animate({opacity:1},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingIn=!1},500)},AnimatedImageTextTile.prototype.hide_text=function(){this.TextIsAnimating||$("#"+this.div_id+"_tile_text").animate({opacity:0},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingOut=!1},500)},AnimatedImageTextTile.prototype.draw_text=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height));var a,b,c,d,e;a=0,b=20,c=this.height-40,d=this.width,"wide"==this.tile_type&&(e="<h2>"+this.title+"</h2>"),("medium"==this.tile_type||"small"==this.tile_type)&&(e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).style("pointer-events","none").append("xhtml:div").attr("id",this.div_id+"_tile_text").style("opacity",0).style("background-color","#ffffff").html(e)},FullAnimatedImageTextTile.prototype=new AnimatedImageTile({display:!1}),FullAnimatedImageTextTile.prototype.constructor=FullAnimatedImageTextTile,FullAnimatedImageTextTile.prototype.draw=function(){this.draw_bg(),this.draw_image(),this.draw_text();var a=this;this.link_selection.on("mouseover",function(){a.show_text()}),this.link_selection.on("mouseout",function(){a.hide_text()})},FullAnimatedImageTextTile.prototype.show_text=function(){this.TextIsAnimatingIn||$("#"+this.div_id+"_tile_text").animate({opacity:1},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingIn=!1},500)},FullAnimatedImageTextTile.prototype.hide_text=function(){this.TextIsAnimatingOut||$("#"+this.div_id+"_tile_text").animate({opacity:0},500),this.TextIsAnimating=!0;var a=this;setTimeout(function(){a.TextIsAnimatingOut=!1},500)},FullAnimatedImageTextTile.prototype.draw_text=function(){this.width=$("#"+this.div_id).outerWidth(),this.height="small"==this.tile_type?150:300,this.init_state||(this.svg=d3.select("#"+this.div_id).append("svg").attr("class",this.div_id+"_tile_svg").attr("width",this.width).attr("height",this.height));var a,b,c,d,e;a=0,b=20,c=this.height-40,d=this.width,"wide"==this.tile_type&&(e="<h2>"+this.title+"</h2>"),("medium"==this.tile_type||"small"==this.tile_type)&&(e="<h3>"+this.title+"</h3>"),this.svg.select(".draw_layer").selectAll(".tile_text").data([]).exit().remove(),this.svg.select(".draw_layer").selectAll(".tile_text").data([this.title]).enter().append("foreignObject").attr("class","tile_text").attr("x",a).attr("y",b).attr("height",c).attr("width",d).style("pointer-events","none").append("xhtml:body").attr("id",this.div_id+"_tile_text").attr("height",c).attr("width",d).style("background-color","#ffffff").style("opacity",0).html(e)
},function(){Barista.setUserKey("/public/barista_config.json")||Barista.setUserKey("/barista_config.json");var a=$("div"),b=[];Barista.generatedViews={},a.each(function(){var a=$(this).data();-1!==_.keys(a).indexOf("baristaView")&&b.push(this)}),b.forEach(function(a){var b,c=0,d=$(a).data().baristaView;for(b=$(a).attr("id")?$(a).attr("id"):d;-1!==_.keys(Barista.generatedViews).indexOf(b);)c+=1,b=d+c;var e=_.extend({el:a},$(a).data());Barista.generatedViews[b]=new Barista.Views[d](e);try{Barista.generatedViews[b].model.fetch("")}catch(f){}if(-1!==_.keys($(a).data()).indexOf("bind")){var g=$(a).data().bind;Barista.generatedViews[b].listenTo(Barista.generatedViews[g],"all",function(a,c){Barista.generatedViews[b].model.fetch(c.val)})}})}();Barista.packageBranch = "develop";Barista.packageShortSHA = "72aa5f6";Barista.packageSHA = "72aa5f646d1d7bb36a5529a8aaf5910dbb6b7d47";Barista.packageDate = "Friday, May 8th, 2015, 6:14:05 PM"