<!DOCTYPE html><html lang="en"><head><title>collections/AnalysisHistoryCollection</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="collections/AnalysisHistoryCollection"><meta name="groc-project-path" content="source/collections/AnalysisHistoryCollection.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/collections/AnalysisHistoryCollection.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="analysishistorycollection"><strong>AnalysisHistoryCollection</strong></h1>

<p>A Backbone.Collection that represents a set of analysis history objects.  This collection is suitable for
internal use in GridView.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>optional arguments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{Backbone.Model}  <strong>model</strong>  the model used for the collection objects. defaults to <em>PertModel</em></li>
<li>{String}  <strong>url</strong>  the url from which model data is fetched. defaults  to <em>'http://api.lincscloud.org/a2/pertinfo?callback=?'</em></li>
<li>{String}  <strong>skip</strong>  the skip parameter used in api calls when the collection is updated. defaults to <em>0</em></li>
<li>{Boolean}  <strong>isLoading</strong>  indicates wether or not the collection is in the middle of a fetch operation. defaults to <em>false</em></li>
</ol></div></div><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Collections</span><span class="p">.</span><span class="nx">AnalysisHistoryCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="model">model</h4>

<p>the model used for the collection objects.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">model</span><span class="o">:</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">GenericMongoModel</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="url">url</h4>

<p>the url from which model data is fetched</p></div></div><div class="code"><div class="wrapper">    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://api.lincscloud.org/compute_status?callback=?&#39;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="skip">skip</h4>

<p>the skip parameter used in api calls when the collection is updated.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">skip</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="isloading">isLoading</h4>

<p>indicates wether or not the collection is in the middle of a fetch operation.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="maxcount">maxCount</h3>

<p>the maximum size of the collection. defaults to Infinity</p></div></div><div class="code"><div class="wrapper">    <span class="nx">maxCount</span><span class="o">:</span> <span class="kc">Infinity</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="user-id">user_id</h3>

<p>the user_id to search jobs for. Forcing this to be set prevents us from searching other users jobs</p></div></div><div class="code"><div class="wrapper">    <span class="nx">user</span><span class="o">:</span> <span class="s2">&quot;lincs@broadinstitute.org&quot;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="getdata">getData</h2>

<p><code>AnalysisHistoryCollection.getData(search_string,search_type,limit)</code></p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Gets additional data from the specified url and stores them as models in the collection</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div><div class="code"><div class="wrapper">    <span class="c1">//</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{string}  <strong>search_string</strong>  the string on which a regex search into the api at the collections url will be performed, defaults to <em>""</em></li>
<li>{string}  <strong>search_type</strong>  the type of search that will be performed, defaults to <em>"single"</em></li>
<li>{number}  <strong>limit</strong>  the number of models to be fetched, defaults to <em>30</em></li>
</ol></div></div><div class="code"><div class="wrapper">    <span class="nx">getData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">search_string</span><span class="p">,</span><span class="nx">search_type</span><span class="p">,</span><span class="nx">limit</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set <strong>isLoading</strong> to true so we don't constantly make api calls before the data comes back</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>store the value of <strong>search_string</strong>, <strong>search_type</strong>, and <strong>limit</strong> on the collection object</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">search_string</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_string</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_string</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_type</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_type</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">limit</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">limit</span> <span class="o">:</span> <span class="mi">30</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the query parameter for user_id</p></div></div><div class="code"><div class="wrapper">        <span class="k">switch</span> <span class="p">(</span><span class="nx">search_type</span><span class="p">){</span>
        <span class="k">case</span> <span class="s2">&quot;job_id&quot;</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;job_id&quot;:{&quot;$regex&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;status&quot;</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;status&quot;:{&quot;$regex&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">case</span> <span class="s2">&quot;tool_id&quot;</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;tool_id&quot;:{&quot;$regex&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span><span class="p">;</span>
            <span class="k">break</span><span class="p">;</span>
        <span class="k">default</span><span class="o">:</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;user_id&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">user</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;job_id&quot;:{&quot;$regex&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;, &quot;$options&quot;:&quot;i&quot;}}&#39;</span><span class="p">;</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build a parameter object for the api call</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span><span class="nx">q</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span><span class="p">,</span>
            <span class="nx">l</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">,</span>
            <span class="nx">sk</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">skip</span><span class="p">,</span>
            <span class="nx">s</span><span class="o">:</span> <span class="s1">&#39;{&quot;_id&quot;:-1}&#39;</span><span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make the api call and store the results as individual models in the collection.
we don't remove old models in this case as we want to support continuous building
of the model list from a remote api.  On success, set <strong>isLoading</strong> back to false</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">res</span><span class="p">,{</span><span class="nx">remove</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make a second api call to find the maximum number of items in the collection
and set that as an attribute on it</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">maxCount</span> <span class="o">==</span> <span class="kc">Infinity</span><span class="p">){</span>
            <span class="nx">params</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">omit</span><span class="p">(</span><span class="nx">params</span><span class="p">,[</span><span class="s1">&#39;l&#39;</span><span class="p">,</span><span class="s1">&#39;sk&#39;</span><span class="p">,</span><span class="s1">&#39;s&#39;</span><span class="p">]);</span>
            <span class="nx">params</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">extend</span><span class="p">(</span><span class="nx">params</span><span class="p">,{</span><span class="nx">c</span><span class="o">:</span> <span class="kc">true</span><span class="p">});</span>
            <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span><span class="nx">params</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
                <span class="nx">self</span><span class="p">.</span><span class="nx">maxCount</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">count</span><span class="p">;</span>
            <span class="p">});</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>