<!DOCTYPE html><html lang="en"><head><title>collections/CellCollection</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="collections/CellCollection"><meta name="groc-project-path" content="source/collections/CellCollection.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/collections/CellCollection.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="cellcollection"><strong>CellCollection</strong></h1>

<p>A Backbone.Collection that represents a set of cell types.  This collection is suitable for 
internal use in GridView.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>optional arguments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{Backbone.Model}  <strong>model</strong>  the model used for the collection objects. defaults to <em>PertModel</em></li>
<li>{String}  <strong>url</strong>  the url from which model data is fetched. defaults  to <em>'http://api.lincscloud.org/a2/pertinfo?callback=?'</em></li>
<li>{String}  <strong>skip</strong>  the skip parameter used in api calls when the collection is updated. defaults to <em>0</em></li>
<li>{Boolean}  <strong>isLoading</strong>  indicates wether or not the collection is in the middle of a fetch operation. defaults to <em>false</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p><code>pert_collection = new CellCollection({model: PertModel,
url: 'http://api.lincscloud.org/a2/pertinfo?callback=?',
skip: 0,
isLoading: false});</code></p></div></div><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Collections</span><span class="p">.</span><span class="nx">CellCollection</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="model">model</h4>

<p>the model used for the collection objects. </p></div></div><div class="code"><div class="wrapper">    <span class="nx">model</span><span class="o">:</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">CellModel</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="url">url</h4>

<p>the url from which model data is fetched</p></div></div><div class="code"><div class="wrapper">    <span class="nx">url</span><span class="o">:</span> <span class="s1">&#39;http://api.lincscloud.org/a2/cellinfo?callback=?&#39;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="skip">skip</h4>

<p>the skip parameter used in api calls when the collection is updated. </p></div></div><div class="code"><div class="wrapper">    <span class="nx">skip</span><span class="o">:</span> <span class="mi">0</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h4 id="isloading">isLoading</h4>

<p>indicates wether or not the collection is in the middle of a fetch operation. </p></div></div><div class="code"><div class="wrapper">    <span class="nx">isLoading</span><span class="o">:</span> <span class="kc">false</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h2 id="getdata">getData</h2>

<p><code>PertCollection.getData(search_string,search_type,limit)</code></p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>Gets additional data from the specified url and stores them as models in the collection</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p>

<ol>
<li>{string}  <strong>search_string</strong>  the string on which a regex search into the api at the collections url will be performed, defaults to <em>""</em></li>
<li>{string}  <strong>search_column</strong>  the column to query the search<em>string against, defaults to "cell</em>id"</li>
<li>{string}  <strong>search_type</strong>  the type of search that will be performed, defaults to <em>"single"</em></li>
<li>{number}  <strong>limit</strong>  the number of models to be fetched, defaults to <em>30</em></li>
</ol></div></div><div class="code"><div class="wrapper">    <span class="nx">getData</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">search_string</span><span class="p">,</span><span class="nx">search_column</span><span class="p">,</span><span class="nx">limit</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set <strong>isLoading</strong> to true so we don't constantly make api calls before the data comes back</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

        <span class="k">this</span><span class="p">.</span><span class="nx">search_string</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_string</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_string</span> <span class="o">:</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">search_column</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_column</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_column</span> <span class="o">:</span> <span class="s1">&#39;cell_id&#39;</span><span class="p">;</span>
        <span class="c1">//TODO big hack to adapt to GridView implementation</span>
        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search_column</span> <span class="o">==</span> <span class="s1">&#39;single&#39;</span><span class="p">)</span> <span class="p">{</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">search_column</span> <span class="o">=</span> <span class="s1">&#39;cell_id&#39;</span><span class="p">;</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>this.search<em>type = (search</em>type !== undefined) ? search_type : '';</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">limit</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">limit</span> <span class="o">:</span> <span class="mi">30</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search_column</span> <span class="o">==</span> <span class="s1">&#39;mutations&#39;</span><span class="p">){</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;lincs_status&quot;:{&quot;$in&quot;:[&quot;core_cline&quot;,&quot;core_pline&quot;,&quot;DIVR&quot;]},&quot;mutations&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;}&#39;</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span> <span class="o">=</span> <span class="s1">&#39;{&quot;lincs_status&quot;:{&quot;$in&quot;:[&quot;core_cline&quot;,&quot;core_pline&quot;,&quot;DIVR&quot;]},&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_column</span> <span class="o">+</span> <span class="s1">&#39;&quot;:&#39;</span> <span class="o">+</span> <span class="s1">&#39;{&quot;$regex&quot;:&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_string</span> <span class="o">+</span> <span class="s1">&#39;&quot;,&quot;$options&quot;:&quot;i&quot;}}&#39;</span><span class="p">;</span>
        <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build a parameter object for the api call
TODO-remove: alert(this.q_param);</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span><span class="nx">q</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">q_param</span><span class="p">,</span>
            <span class="nx">l</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>s: this.s_param, // no sorting yet</p></div></div><div class="code"><div class="wrapper">            <span class="nx">sk</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">skip</span><span class="p">};</span>
        
        <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">url</span><span class="p">,</span> <span class="nx">params</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">set</span><span class="p">(</span><span class="nx">res</span><span class="p">,{</span><span class="nx">remove</span><span class="o">:</span> <span class="kc">false</span><span class="p">});</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
            <span class="nx">self</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;fetch&quot;</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>