<!DOCTYPE html><html lang="en"><head><title>views/TagListView</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="views/TagListView"><meta name="groc-project-path" content="source/views/TagListView.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/views/TagListView.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><p><strong>TagListView</strong>
A Backbone.View that displays a list of objects in a collection as tags.  The tags are drawn
as rounded rectangles with text inside.  The text corresponds to the cid attributes in the
collection by defaul, but can be customized to display other fields if required</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>basic use</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>tag_list_view = new TagListView();
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>optional arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{string}  <strong>bg_color</strong>  the hex color code to use as the backgound of the view, defaults to <em>#ffffff</em></li>
<li>{string}  <strong>fg_color</strong>  the hex color code to use as the foreground color of the view, defaults to <em>white</em></li>
<li>{string}  <strong>tag_color</strong>  the hex color code to use as the tag color of the view, defaults to <em>gray</em></li>
<li>{string}  <strong>span_class</strong>  a bootstrap span class to size the width of the view, defaults to <em>"col-lg-12"</em></li>
<li>{Number}  <strong>plot_height</strong>  the height of the plot in pixels, defaults to <em>120</em></li>
<li>{string}  <strong>display_field</strong>  the model attribute to display for each model in the view's colleciton.  defualts to <em>'cid'</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>tag_list_view = new TagListView({el: $("target_selector",
                            bg_color:"#ffffff", 
                            fg_color: "white",
                            tag_color: "gray",
                            span_class: "col-lg-12",
                            plot_height: 120,
                            display_attribute: "cid"});
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">TagListView</span> <span class="o">=</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">BaristaBaseView</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="name">name</h3>

<p>give the view a name to be used throughout the View's functions when it needs to know what its class name is</p></div></div><div class="code"><div class="wrapper">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;TagListView&quot;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="model">model</h3>

<p>set of the default model for the view</p></div></div><div class="code"><div class="wrapper">  <span class="nx">model</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">(),</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="collection">collection</h3>

<p>set up a default collection for the view to work with</p></div></div><div class="code"><div class="wrapper">  <span class="nx">collection</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Collection</span><span class="p">(),</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="initialize">initialize</h3>

<p>overide the default Backbone.View initialize method to handle optional arguments, compile the view
template, bind model changes to view updates, and render the view</p></div></div><div class="code"><div class="wrapper">  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>initialize the base view</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">base_initialize</span><span class="p">();</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a display attribute </p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">display_attribute</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">display_attribute</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">display_attribute</span> <span class="o">:</span> <span class="s1">&#39;cid&#39;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a tag color to use </p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">tag_color</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">tag_color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">tag_color</span> <span class="o">:</span> <span class="s1">&#39;black&#39;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>look for custom listeners</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">listener</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">listener</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">listener</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>clear built in listeners</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">stopListening</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add listeners for the collection and trigger an update when it changes</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listener</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">listener</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s1">&#39;add&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s1">&#39;remove&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s1">&#39;reset&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="render">render</h3>

<p>completely render the view. Updates both static and dynamic content in the view.</p></div></div><div class="code"><div class="wrapper">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>call BaristaBaseView's render function first so we can layer on top of it</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">base_render</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a text element for each unique item in the collection</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">x_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">row_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y_offsets</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lengths</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">display_attribute</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">draw_tags</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="update">update</h3>

<p>update the dynamic potions of the view</p></div></div><div class="code"><div class="wrapper">  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>call BaristaBaseView's render function first so we can layer on top of it</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">base_render</span><span class="p">();</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a text element for each unique item in the collection</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">x_offsets</span> <span class="o">=</span> <span class="p">[</span><span class="mi">5</span><span class="p">];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">row_number</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">y_offsets</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">lengths</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="p">[];</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">model</span><span class="p">){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">tags</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">display_attribute</span><span class="p">));</span>
    <span class="p">});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">tags</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">unique</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">draw_tags</span><span class="p">();</span>
    
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="fit-height">fit_height</h3>

<p>fits the view height to the height taken by the tags displayed</p></div></div><div class="code"><div class="wrapper">  <span class="nx">fit_height</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set the view's height attribute based on the number of rows in the
vis</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">EmSize</span> <span class="o">=</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">getEmSizeInPixels</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">row_number</span> <span class="o">*</span> <span class="mf">1.5</span> <span class="o">+</span> <span class="mf">3.5</span><span class="p">)</span> <span class="o">*</span> <span class="nx">EmSize</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>rescale the height of the vis</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
      <span class="p">.</span><span class="nx">transition</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">);</span>
    
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="draw-tags">draw tags</h3>

<p>utility function to draw tags diven a data set.  </p></div></div><div class="code"><div class="wrapper">  <span class="nx">draw_tags</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the foreground text of all the tags</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">fg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tag_list_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tag_list_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;text&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;tag_list_text&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="k">return</span> <span class="nx">d</span><span class="p">;})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">lengths</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">getComputedTextLength</span><span class="p">()</span> <span class="o">+</span> <span class="mi">15</span><span class="p">);</span>
        <span class="kd">var</span> <span class="nx">current_x_offset</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">current_x_offset</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">lengths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="nx">self</span><span class="p">.</span><span class="nx">width</span><span class="p">){</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">5</span><span class="p">;</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">lengths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">row_number</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">lengths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
        <span class="p">}</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">y_offsets</span><span class="p">.</span><span class="nx">push</span><span class="p">((</span><span class="nx">self</span><span class="p">.</span><span class="nx">row_number</span> <span class="o">*</span> <span class="mf">1.5</span> <span class="o">+</span> <span class="mi">1</span><span class="p">));</span>
        <span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="p">})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">y_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">fg_color</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">,</span><span class="s2">&quot;pointer&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">){</span><span class="nx">self</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;TagListView:DidSelect&quot;</span><span class="p">,{</span><span class="nx">val</span><span class="o">:</span> <span class="nx">d</span><span class="p">});});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the background of all the tags</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">bg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tag_list_rect&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.tag_list_rect&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">tags</span><span class="p">).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;tag_list_rect&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">x_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">5</span><span class="p">;})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">return</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">y_offsets</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;em&#39;</span><span class="p">;})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;rx&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;ry&quot;</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;width&#39;</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">d</span><span class="p">,</span><span class="nx">i</span><span class="p">){</span><span class="k">return</span> <span class="nx">self</span><span class="p">.</span><span class="nx">lengths</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="p">;})</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s1">&#39;height&#39;</span><span class="p">,</span><span class="s1">&#39;1.2em&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">tag_color</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fit_height</span><span class="p">();</span>

    <span class="k">return</span> <span class="k">this</span>
  <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>