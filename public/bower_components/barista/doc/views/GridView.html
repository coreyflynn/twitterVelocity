<!DOCTYPE html><html lang="en"><head><title>views/GridView</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="views/GridView"><meta name="groc-project-path" content="source/views/GridView.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/views/GridView.js</div></div><div id="document"><div class="segment"><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">GridView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="name">name</h3>

<p>give the view a name to be used throughout the View's functions when it needs to know what its class name is</p></div></div><div class="code"><div class="wrapper">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;GridView&quot;</span><span class="p">,</span>

  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>default search value</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">search_val</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span> <span class="o">=</span> <span class="s2">&quot;single&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up grid options</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">:</span> <span class="s2">&quot;col_lg_12&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">legend</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">legend</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">legend</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">no_download</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_download</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_download</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">no_slice</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_slice</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_slice</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">no_legend</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_legend</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">no_legend</span> <span class="o">:</span> <span class="kc">undefined</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">limit</span> <span class="o">:</span> <span class="mi">30</span><span class="p">;</span>

    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up a default collection and column definition for the grid to operate on</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">collection</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">collection</span> <span class="o">:</span> <span class="k">new</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">Collections</span><span class="p">.</span><span class="nx">PertCollection</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">columns</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">columns</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">columns</span> <span class="o">:</span> <span class="p">[{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;pert_iname&quot;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s2">&quot;Reagent Name&quot;</span><span class="p">,</span> <span class="nx">cell</span><span class="o">:</span> <span class="s2">&quot;string&quot;</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
                                            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;pert_type_label&quot;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s2">&quot;Pert Type&quot;</span><span class="p">,</span> <span class="nx">cell</span><span class="o">:</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">HTMLCell</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">false</span><span class="p">},</span>
                                            <span class="p">{</span><span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;num_inst&quot;</span><span class="p">,</span> <span class="nx">label</span><span class="o">:</span> <span class="s2">&quot;Experiments&quot;</span><span class="p">,</span> <span class="nx">cell</span><span class="o">:</span> <span class="s2">&quot;integer&quot;</span><span class="p">,</span> <span class="nx">editable</span><span class="o">:</span> <span class="kc">false</span><span class="p">}];</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build the template</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">compile_template</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build the grid on the template using a clickable row.  If a row is clicked, a grid:RowClick event
is fired with the row's model as the passed data.
build the clickable row</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">ClickableRow</span> <span class="o">=</span> <span class="nx">Backgrid</span><span class="p">.</span><span class="nx">Row</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span>
      <span class="nx">events</span><span class="o">:</span> <span class="p">{</span>
        <span class="s2">&quot;click&quot;</span><span class="o">:</span> <span class="s2">&quot;onClick&quot;</span>
      <span class="p">},</span>
      <span class="nx">onClick</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;grid:RowClick&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;.cmap-active-grid-row&quot;</span><span class="p">).</span><span class="nx">removeClass</span><span class="p">(</span><span class="s2">&quot;cmap-active-grid-row&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;cmap-active-grid-row&quot;</span><span class="p">);</span>
      <span class="p">},</span>
      <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>replicate Backgrid.Row's native render method</p></div></div><div class="code"><div class="wrapper">        <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">empty</span><span class="p">();</span>
        <span class="kd">var</span> <span class="nx">fragment</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createDocumentFragment</span><span class="p">();</span>
        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">cells</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
          <span class="nx">fragment</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">cells</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">render</span><span class="p">().</span><span class="nx">el</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">fragment</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">delegateEvents</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>if the row's model is active, highlight it</p></div></div><div class="code"><div class="wrapper">        <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;active_row&#39;</span><span class="p">)){</span>
          <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">addClass</span><span class="p">(</span><span class="s2">&quot;cmap-active-grid-row&quot;</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build the grid</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">grid</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Backgrid</span><span class="p">.</span><span class="nx">Grid</span><span class="p">({</span>
      <span class="nx">row</span><span class="o">:</span> <span class="nx">ClickableRow</span><span class="p">,</span>
      <span class="nx">columns</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">,</span>
      <span class="nx">collection</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span>
    <span class="p">});</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">grid</span><span class="p">.</span><span class="nx">render</span><span class="p">().</span><span class="nx">$el</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a button to scroll to the top of the grid once it is scroll down</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">add_scroll_to_top_button</span><span class="p">();</span>

    <span class="c1">//bind the table to a function to check for scroll boundaries</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">scroll</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">checkscroll</span><span class="p">();});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind the download text to a function to download the data in the table</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_download&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">download_table</span><span class="p">();});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind the download text to a function to slice the data in the table out of the
Connectivity Map database.</p></div></div><div class="code"><div class="wrapper">    <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;slice&quot;</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">checkscroll</span><span class="o">:</span> <span class="nx">_</span><span class="p">.</span><span class="nx">debounce</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">30</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">show_scroll_to_top_button</span><span class="p">();</span>
    <span class="p">}</span><span class="k">else</span><span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">hide_scroll_to_top_button</span><span class="p">();</span>
    <span class="p">}</span>

    <span class="kd">var</span> <span class="nx">triggerPoint</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pos</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">scrollTop</span><span class="p">()</span> <span class="o">+</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">height</span><span class="p">()</span> <span class="o">+</span> <span class="nx">triggerPoint</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">isLoading</span> <span class="o">&amp;&amp;</span> <span class="nx">pos</span> <span class="o">&gt;</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nx">scrollHeight</span><span class="p">){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">skip</span> <span class="o">+=</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">update_collection</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search_val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">search_type</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">},</span><span class="mi">100</span><span class="p">),</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="add_scroll_to_top_button">add<em>scroll</em>to<em>top</em>button</h3>

<p>adds a UI control to scroll the top of the grid</p></div></div><div class="code"><div class="wrapper">  <span class="nx">add_scroll_to_top_button</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;scroll_button&#39;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;&lt;button id=&quot;&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span> <span class="o">+</span> <span class="s1">&#39;&quot; class=&quot;cmap_grid_to_top_button&quot;&gt;Scroll to Top&lt;/button&gt;&#39;</span><span class="p">);</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">scroll_to_top</span><span class="p">();});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hide_scroll_to_top_button</span><span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="scroll_to_top">scroll<em>to</em>top</h3>

<p>scrolls the grid to the top of its container
argurments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the duration of the scroll animation in ms, defaults to <em>500</em></li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="nx">scroll_to_top</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">500</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">scrollTop</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">hide_scroll_to_top_button</span><span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="show_scroll_to_top_button">show<em>scroll</em>to<em>top</em>button</h3>

<p>shows the scroll to top button
argurments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the duration of the scroll animation in ms, defaults to <em>500</em></li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="nx">show_scroll_to_top_button</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">500</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span><span class="p">).</span><span class="nx">clearQueue</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="hide_scroll_to_top_button">hide<em>scroll</em>to<em>top</em>button</h3>

<p>hides the scroll to top button
argurments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the duration of the scroll animation in ms, defaults to <em>500</em></li>
</ol></div></div><div class="code"><div class="wrapper">  <span class="nx">hide_scroll_to_top_button</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">self</span><span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">500</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span><span class="p">).</span><span class="nx">clearQueue</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">scroll_to_top_button_id</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">replace_collection</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">search_val</span><span class="p">,</span><span class="nx">search_type</span><span class="p">,</span><span class="nx">limit</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">getData_promise</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">search_val</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_val</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_val</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_val</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_type</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_type</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">limit</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">limit</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">skip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">maxCount</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span>
    <span class="nx">getData_promise</span> <span class="o">=</span>  <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search_val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">search_type</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listenToOnce</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;grid:ReplaceCollection&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;grid:Add&quot;</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">resize_div</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>reset the slice all data button and reject the slice
deferred if it is present</p></div></div><div class="code"><div class="wrapper">      <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;slice&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">){</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
      <span class="p">}</span>
    <span class="p">});</span>
    <span class="k">return</span> <span class="nx">getData_promise</span><span class="p">;</span>
  <span class="p">},</span>

  <span class="nx">update_collection</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">search_val</span><span class="p">,</span><span class="nx">search_type</span><span class="p">,</span><span class="nx">limit</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">getData_promise</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">models</span><span class="p">.</span><span class="nx">length</span> <span class="o">&lt;</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">maxCount</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">search_val</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_val</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_val</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_val</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span> <span class="o">=</span> <span class="p">(</span><span class="nx">search_type</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">search_type</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">search_type</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">limit</span> <span class="o">=</span> <span class="p">(</span><span class="nx">limit</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">limit</span> <span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">show</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
      <span class="nx">getData_promise</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">getData</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">search_val</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">search_type</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">limit</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">resize_div</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">listenToOnce</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">,</span><span class="s2">&quot;add&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;grid:UpdateCollection&quot;</span><span class="p">);</span>
        <span class="k">this</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s2">&quot;grid:Add&quot;</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="k">return</span> <span class="nx">getData_promise</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">},</span>

  <span class="nx">clear_collection</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">skip</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
    <span class="nb">window</span><span class="p">.</span><span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">reset</span><span class="p">();</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">maxCount</span> <span class="o">=</span> <span class="kc">Infinity</span><span class="p">;</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">hide</span><span class="p">();</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>reset the slice all data button and reject the slice
deferred if it is present</p></div></div><div class="code"><div class="wrapper">      <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;slice&quot;</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">){</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">.</span><span class="nx">reject</span><span class="p">();</span>
      <span class="p">}</span>

    <span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">resize_div</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">container_height</span> <span class="o">=</span>  <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">height</span><span class="p">();</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="kd">var</span> <span class="nx">data_height</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">length</span> <span class="o">*</span> <span class="mi">30</span> <span class="o">+</span> <span class="mi">40</span><span class="p">;</span>
      <span class="kd">var</span> <span class="nx">target_height</span> <span class="o">=</span> <span class="p">(</span><span class="nx">data_height</span> <span class="o">&gt;</span> <span class="mi">300</span><span class="p">)</span> <span class="o">?</span> <span class="mi">300</span> <span class="o">:</span> <span class="nx">data_height</span><span class="p">;</span>

      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">stop</span><span class="p">();</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">animate</span><span class="p">({</span><span class="nx">height</span><span class="o">:</span><span class="nx">target_height</span><span class="p">},</span><span class="mi">500</span><span class="p">);</span>
    <span class="p">},</span><span class="mi">500</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">compile_template</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">=</span> <span class="s1">&#39;backgrid_target&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">BaristaTemplates</span><span class="p">.</span><span class="nx">CMapBaseGrid</span><span class="p">({</span><span class="nx">div_string</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">,</span>
                             <span class="nx">span_class</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span><span class="p">,</span>
                             <span class="nx">legend</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">legend</span><span class="p">,</span>
                             <span class="nx">no_download</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">no_download</span><span class="p">,</span>
                             <span class="nx">no_slice</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">no_slice</span><span class="p">,</span>
                             <span class="nx">no_legend</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">no_legend</span><span class="p">,</span>
                          <span class="p">}));</span>
  <span class="p">},</span>

  <span class="nx">slice_all_table_data</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>change the button state to progress</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;progress&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>create a Deferred on the object to handle interaction with the slicing
operation.  This allows us to resolve the Deffered later in another
method before the ajax call returns if we need to</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">slice_defer</span> <span class="o">=</span> <span class="nx">$</span><span class="p">.</span><span class="nx">Deferred</span><span class="p">();</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>If the Deferred resolves successfully, leave the button alone and let other the ajax call
below manipulate it.  If it is rejected, set the button back up to its original state.</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">.</span><span class="nx">fail</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;slice&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">);</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>grab the API 'q' query parameter from the grid's collection and send it
to sig<em>slice API.  if the slice job completes, check the return for a 
file</em>url attribute and change the link in the slice button to expose the
link.  If it does not exist, the slice failed and we display a failure
message asking the user to try again</p></div></div><div class="code"><div class="wrapper">    <span class="nx">sig_slice</span> <span class="o">=</span> <span class="s1">&#39;http://prefix:8080/a2/sigslice?callback=?&#39;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">.</span><span class="nx">ajax</span><span class="p">({</span>
      <span class="nx">dataType</span><span class="o">:</span> <span class="s1">&#39;json&#39;</span><span class="p">,</span>
      <span class="nx">url</span><span class="o">:</span> <span class="nx">sig_slice</span><span class="p">,</span>
      <span class="nx">data</span><span class="o">:</span> <span class="p">{</span><span class="nx">q</span><span class="o">:</span> <span class="nx">self</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">q_param</span><span class="p">,</span><span class="nx">l</span><span class="o">:</span> <span class="mi">1000</span><span class="p">},</span>
      <span class="nx">success</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
        <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">file_url</span><span class="p">){</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;link&quot;</span><span class="p">,</span><span class="nx">res</span><span class="p">.</span><span class="nx">file_url</span><span class="p">);</span>
        <span class="p">}</span><span class="k">else</span><span class="p">{</span>
          <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">);</span>
        <span class="p">}</span>
      <span class="p">},</span>
      <span class="nx">error</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">});</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>if 60s pass, we assume that is too long and we 
update the button with an error message and 
resolve the deferred to indicate we finished the 
ajax call normally.  This is a hack to emulate a 404 error in jsonp</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">slice_timeout</span> <span class="o">=</span> <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span>
      <span class="nx">self</span><span class="p">.</span><span class="nx">change_slice_button_state</span><span class="p">(</span><span class="s2">&quot;fail&quot;</span><span class="p">);</span>
    <span class="p">},</span><span class="mi">60000</span><span class="p">);</span>
  <span class="p">},</span>

  <span class="nx">change_slice_button_state</span><span class="o">:</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">state</span><span class="p">,</span><span class="nx">link</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>unbind an handlers on the button</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">unbind</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>handle the re-binding of handlers and update the button text and icon</p></div></div><div class="code"><div class="wrapper">    <span class="k">switch</span> <span class="p">(</span><span class="nx">state</span><span class="p">){</span>
      <span class="k">case</span> <span class="s2">&quot;slice&quot;</span><span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>update the slice button to show an available data slice</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;font color=&quot;#0072B2&quot;&gt;&lt;i class=&quot;icon-cogs&quot;&gt;&lt;/i&gt; slice all data&lt;/font&gt;&#39;</span><span class="p">);</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>rebind the click event and clear a timeout if present</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_all_table_data</span><span class="p">();});</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_timeout</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="s2">&quot;progress&quot;</span><span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>indicate that we are making a data slice</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;font color=&quot;#0072B2&quot;&gt;&lt;i class=&quot;icon-cog icon-spin&quot;&gt;&lt;/i&gt; slicing&lt;/font&gt;&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>unbind all handlers so that we can't click the while while we are slicing</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">unbind</span><span class="p">();</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="s2">&quot;link&quot;</span><span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>construct an html string to expose the link</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">html_string</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;&lt;a href=&quot;&#39;</span><span class="p">,</span>
                   <span class="nx">link</span><span class="p">,</span>
                   <span class="s1">&#39;&quot; class=&quot;cmap-link&quot;&gt;&#39;</span><span class="p">,</span>
                   <span class="s1">&#39;&lt;font color=&quot;#0072B2&quot;&gt;&lt;i class=&quot;icon-download&quot;&gt;&lt;/i&gt; download slice&lt;/font&gt;&lt;/a&gt;&#39;</span><span class="p">].</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">);</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>update the button and resolve the deferred to 
indicate we finished the ajax call normally</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="nx">html_string</span><span class="p">);</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_timeout</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>

      <span class="k">case</span> <span class="s2">&quot;fail&quot;</span><span class="o">:</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>update the button with an error message,
resolve the deferred and clear the Timeout</p></div></div><div class="code"><div class="wrapper">        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;font color=&quot;#D55E00&quot;&gt;&lt;i class=&quot;icon-exclamation&quot;&gt;&lt;/i&gt; slice failed. try again?&lt;/font&gt;&#39;</span><span class="p">);</span>
        <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_slice&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">click</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_all_table_data</span><span class="p">();});</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">slice_defer</span><span class="p">.</span><span class="nx">resolve</span><span class="p">();</span>
        <span class="nx">clearTimeout</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">slice_timeout</span><span class="p">);</span>
        <span class="k">break</span><span class="p">;</span>
    <span class="p">}</span>

  <span class="p">},</span>

  <span class="nx">download_table</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>indicate we are downloading something</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_download&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;font color=&quot;#0072B2&quot;&gt;&lt;i class=&quot;icon-refresh icon-spin&quot;&gt;&lt;/i&gt; exporting&lt;/font&gt;&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up api call parameters</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">url</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">url</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span><span class="nx">q</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">q_param</span><span class="p">,</span>
            <span class="nx">l</span><span class="o">:</span><span class="mi">0</span><span class="p">,</span>
            <span class="nx">s</span><span class="o">:</span><span class="k">this</span><span class="p">.</span><span class="nx">collection</span><span class="p">.</span><span class="nx">s_param</span><span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>grab column header names</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">,</span><span class="s1">&#39;label&#39;</span><span class="p">).</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\t&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>grab column data names</p></div></div><div class="code"><div class="wrapper">        <span class="kd">var</span> <span class="nx">names</span> <span class="o">=</span> <span class="nx">_</span><span class="p">.</span><span class="nx">pluck</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">columns</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make a JSON API call to grab data for the table</p></div></div><div class="code"><div class="wrapper">    <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="nx">url</span><span class="p">,</span><span class="nx">params</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">){</span>
      <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="p">[</span><span class="nx">headers</span><span class="p">];</span>
      <span class="nx">res</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">r</span><span class="p">){</span>
        <span class="kd">var</span> <span class="nx">line_data</span> <span class="o">=</span> <span class="p">[];</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>for each data name in the table, grab the data. translate html
content to plain text where required</p></div></div><div class="code"><div class="wrapper">        <span class="nx">names</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">n</span><span class="p">){</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">n</span> <span class="o">==</span> <span class="s2">&quot;pert_type_label&quot;</span><span class="p">){</span>
            <span class="nx">line_data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">Barista</span><span class="p">.</span><span class="nx">CMapPertTypeAlias</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="s2">&quot;pert_type&quot;</span><span class="p">]).</span><span class="nx">acronym</span><span class="p">);</span>
          <span class="p">}</span><span class="k">else</span><span class="p">{</span>
            <span class="nx">line_data</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nb">String</span><span class="p">(</span><span class="nx">r</span><span class="p">[</span><span class="nx">n</span><span class="p">]));</span>
          <span class="p">}</span>
        <span class="p">});</span>
        <span class="nx">line_string</span> <span class="o">=</span> <span class="nx">line_data</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39;\t&#39;</span><span class="p">);</span>
        <span class="nx">lines</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">line_string</span><span class="p">);</span>
      <span class="p">});</span>
      <span class="kd">var</span> <span class="nx">lines_string</span> <span class="o">=</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
      <span class="kd">var</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">lines_string</span><span class="p">],</span> <span class="p">{</span><span class="nx">type</span><span class="o">:</span> <span class="s2">&quot;text/plain;charset=utf-8&quot;</span><span class="p">});</span>
      <span class="kd">var</span> <span class="nx">timestamp</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();</span>
      <span class="nx">saveAs</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span> <span class="s2">&quot;CMapTable&quot;</span> <span class="o">+</span> <span class="nx">timestamp</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span><span class="p">);</span>
      <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;_download&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">el</span><span class="p">).</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;font color=&quot;#0072B2&quot;&gt;&lt;i class=&quot;icon-share&quot;&gt;&lt;/i&gt; export table&lt;/font&gt;&#39;</span><span class="p">);</span>
    <span class="p">});</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="hide">hide</h3>

<p>hides the view by dimming the opacity and hiding it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the hide animation. defualts to <em>500</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.hide(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hide</span><span class="p">();},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="show">show</h3>

<p>shows the view by brightening the opacity and showing it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the show animation. defualts to <em>500</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.show(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>