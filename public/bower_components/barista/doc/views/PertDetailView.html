<!DOCTYPE html><html lang="en"><head><title>views/PertDetailView</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="views/PertDetailView"><meta name="groc-project-path" content="source/views/PertDetailView.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/views/PertDetailView.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="pertdetailview"><strong>PertDetailView</strong></h1></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>A Backbone.View that shows the name and short description of a single purturbagen.  This view is
frequently paired with a PertDetailModel.</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view = new PertDetailView({el: $("target_selector")});
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>optional arguments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{string}  <strong>bg_color</strong>  the hex color code to use as the backgound of the view, defaults to <em>#ffffff</em></li>
<li>{string}  <strong>span_class</strong>  a bootstrap span class to size the width of the view, defaults to <em>"span12"</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view = new PertDetailView({el: $("target_selector"),
                                        model: PertDetailModel,
                                        bg_color: "#ffffff",
                                        span_class: "span4"});
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">PertDetailView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="name">name</h3>

<p>give the view a name to be used throughout the View's functions when it needs to know what its class name is</p></div></div><div class="code"><div class="wrapper">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;PertDetailView&quot;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="model">model</h3>

<p>set up the view's default model</p></div></div><div class="code"><div class="wrapper">  <span class="nx">model</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Barista</span><span class="p">.</span><span class="nx">Models</span><span class="p">.</span><span class="nx">PertDetailModel</span><span class="p">(),</span>
  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="initialize">initialize</h3>

<p>overide the defualt Backbone.View initialize method to bind the view to model changes, bind
window resize events to view re-draws, compile the template, and render the view</p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.initialize();
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up color options.  default if not specified</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the span class</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">:</span> <span class="s2">&quot;#col-lg-12&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind render to model changes</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>compile the default template for the view</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">compile_template</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>define the location where d3 will build its plot</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">width</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerHeight</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>render the vis</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">redraw</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind window resize events to redraw</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">redraw</span><span class="p">();}</span> <span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="compile-template">compile_template</h3>

<p>use Handlebars to compile the template for the view</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{string}  <strong>template_string</strong>  an html string specifying the template to compile and render. defaults to <code>'&lt;div id="' + this.div_string + '" class="' + this.span_class + '" style="height:180px"&gt;&lt;/div&gt;'</code></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.compile_template(template\_string);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">compile_template</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">template_string</span><span class="p">){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">=</span> <span class="s1">&#39;d3_target&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">BaristaTemplates</span><span class="p">.</span><span class="nx">d3_target</span><span class="p">({</span><span class="nx">div_string</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">,</span>
                        <span class="nx">span_class</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span><span class="p">}));</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="redraw">redraw</h3>

<p>perform a full redraw of the view, including wiping out all d3 drawn components in the view and 
initializing them again from scratch.</p></div></div><div class="code"><div class="wrapper">  </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.redraw();
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">redraw</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">init_view</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="init-view">init_view</h3>

<p>set up the view from scratch.  Draw a background panel and place all dynamic content on that panel
with defualt values</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.init_view();
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">init_view</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>stuff "this" into a variable for use inside of scoped funcitons</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the panel's width and height</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">width</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerHeight</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>rescale the width of the vis</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the background of the panel</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bg_panel&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bg_panel&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">]).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;bg_panel&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">bg_color</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the static index reagent icon</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.index_text_icon&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.index_text_icon&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
              <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;foreignObject&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;index_text_icon&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;xhtml:div&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;id&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">div_id</span> <span class="o">+</span> <span class="s2">&quot;_index_text&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;background-color&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">bg_color</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">html</span><span class="p">(</span><span class="s1">&#39;&lt;p class=&quot;cmap-subhead-text&quot;&gt;&lt;font color=&quot;#56B4E9&quot;&gt;&lt;i class=&quot;icon-map-marker&quot;&gt;&lt;/i&gt;&lt;/font&gt;&lt;p&gt;&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the static index reagent text</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.index_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.index_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
              <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;index_text&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">25</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">17</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#56B4E9&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;14pt&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;INDEX REAGENT&#39;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a png export overlay</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">]).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export no_png_export&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">,</span><span class="s2">&quot;pointer&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#56B4E9&quot;</span><span class="p">);})</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#000000&quot;</span><span class="p">);})</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">save_png</span><span class="p">();});</span>

  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="render">render</h3>

<p>render the dynamic content of the view based on the current state of the view's data model</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.render();
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw a link to the gene's wikipedia article if it is a gene.</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_link&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.gene_wiki_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>check for a link definition for wikipedia.  If there is one, draw a card that
displays a link out to the article and the extract of the article.  If there
is no link provided, just display the short and long name version of the card</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;gene_wiki_link&#39;</span><span class="p">)</span> <span class="o">!==</span> <span class="s2">&quot;&quot;</span><span class="p">){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up wikipedia API query parameters</p></div></div><div class="code"><div class="wrapper">      <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="p">{</span><span class="nx">action</span><span class="o">:</span> <span class="s2">&quot;query&quot;</span><span class="p">,</span>
              <span class="nx">titles</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;short_description&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_(gene)&quot;</span><span class="p">,</span>
              <span class="nx">prop</span><span class="o">:</span> <span class="s2">&quot;extracts&quot;</span><span class="p">,</span>
              <span class="nx">format</span><span class="o">:</span> <span class="s2">&quot;json&quot;</span><span class="p">,</span>
              <span class="nx">exchars</span><span class="o">:</span> <span class="mi">200</span><span class="p">,</span>
              <span class="nx">exlimit</span><span class="o">:</span> <span class="mi">1</span><span class="p">,</span>
              <span class="nx">exintro</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
              <span class="nx">exsectionformat</span><span class="o">:</span> <span class="s2">&quot;wiki&quot;</span><span class="p">,</span>
              <span class="nx">redirects</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span>
              <span class="nx">explaintext</span><span class="o">:</span> <span class="kc">true</span><span class="p">};</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make a query into the wikipedia API to get the article extract.  Once the
extract has come back, draw the short description, long description , 
the wiki link, and article stub</p></div></div><div class="code"><div class="wrapper">      <span class="nx">$</span><span class="p">.</span><span class="nx">getJSON</span><span class="p">(</span><span class="s1">&#39;http://en.wikipedia.org/w/api.php?callback=?&#39;</span><span class="p">,</span><span class="nx">params</span><span class="p">,</span><span class="kd">function</span><span class="p">(</span><span class="nx">res</span><span class="p">)</span> <span class="p">{</span>
        </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the short name of the perturbagen</p></div></div><div class="code"><div class="wrapper">        <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.short_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.short_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;short_description_text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-weight&quot;</span><span class="p">,</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;36pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;short_description&#39;</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the long name of the perturbagen</p></div></div><div class="code"><div class="wrapper">        <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.long_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
        <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.long_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;long_description_text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">85</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;14pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;long_description&#39;</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the wiki link</p></div></div><div class="code"><div class="wrapper">        <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_link&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_link no_png_export&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">40</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">,</span><span class="s2">&quot;pointer&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#56B4E9&quot;</span><span class="p">);})</span>
                  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#000000&quot;</span><span class="p">);})</span>
                  <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span> <span class="kd">function</span><span class="p">(){</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">self</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s2">&quot;gene_wiki_link&quot;</span><span class="p">)})</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s1">&#39;wiki&#39;</span><span class="p">);</span>
      </div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>drill into the wikipedia API response and grab the article extract.
break it into 50 character lines to display and draw each of those lines.
If line breaks fall in the middle of a word, place a dash at the end of
the line.  If the extract does not fit on four lines (200 characters),
add an ellipsis to the end of the line.</p></div></div><div class="code"><div class="wrapper">        <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">p</span> <span class="k">in</span> <span class="nx">res</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pages</span><span class="p">){</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">res</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pages</span><span class="p">.</span><span class="nx">propertyIsEnumerable</span><span class="p">(</span><span class="nx">p</span><span class="p">)){</span>
            <span class="kd">var</span> <span class="nx">extract</span> <span class="o">=</span> <span class="nx">res</span><span class="p">.</span><span class="nx">query</span><span class="p">.</span><span class="nx">pages</span><span class="p">[</span><span class="nx">p</span><span class="p">].</span><span class="nx">extract</span><span class="p">;</span>
            <span class="k">if</span> <span class="p">(</span><span class="nx">extract</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>compute the line splits to display in the wiki summary</p></div></div><div class="code"><div class="wrapper">              <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">];</span>
              <span class="nx">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">50</span><span class="p">);</span>
              <span class="nx">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
              <span class="nx">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="o">&amp;&amp;</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">49</span><span class="p">,</span><span class="mi">50</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span>  <span class="o">+</span> <span class="s1">&#39;-&#39;</span><span class="o">:</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">);</span>
              <span class="nx">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">150</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="o">?</span> <span class="nx">extract</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">150</span><span class="p">,</span><span class="mi">200</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; ...&#39;</span> <span class="o">:</span> <span class="s2">&quot;&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw line 1</p></div></div><div class="code"><div class="wrapper">              <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text1&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text1 gene_wiki_text&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">425</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">12</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;13pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#777777&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw line 2</p></div></div><div class="code"><div class="wrapper">              <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text2 &#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text2 gene_wiki_text&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">425</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">29</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;13pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#777777&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw line 3</p></div></div><div class="code"><div class="wrapper">              <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text3&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text3 gene_wiki_text&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">425</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">46</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;13pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#777777&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw line 4</p></div></div><div class="code"><div class="wrapper">              <span class="nx">self</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.&#39;</span> <span class="o">+</span> <span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text4&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                  <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                  <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s1">&#39;gene_wiki_text4 gene_wiki_text&#39;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="nx">self</span><span class="p">.</span><span class="nx">width</span> <span class="o">-</span> <span class="mi">425</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">64</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;13pt&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#777777&quot;</span><span class="p">)</span>
                  <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="mi">3</span><span class="p">]);</span>
            <span class="p">}</span>
          <span class="p">}</span>
        <span class="p">}</span>
      <span class="p">});</span>

    <span class="p">}</span><span class="k">else</span><span class="p">{</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the short name of the perturbagen</p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.short_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.short_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;short_description_text&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">60</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-weight&quot;</span><span class="p">,</span><span class="s2">&quot;bold&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;36pt&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;short_description&#39;</span><span class="p">));</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>(re)draw the long name of the perturbagen</p></div></div><div class="code"><div class="wrapper">      <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.long_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.long_description_text&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">])</span>
                <span class="p">.</span><span class="nx">enter</span><span class="p">()</span>
                <span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;long_description_text&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="mi">85</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-family&quot;</span><span class="p">,</span><span class="s2">&quot;Helvetica Neue&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;font-size&quot;</span><span class="p">,</span><span class="s2">&quot;14pt&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">.</span><span class="nx">get</span><span class="p">(</span><span class="s1">&#39;long_description&#39;</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="hide">hide</h3>

<p>hides the view by dimming the opacity and hiding it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the hide animation. defualts to <em>1</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.hide(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hide</span><span class="p">();},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="show">show</h3>

<p>shows the view by brightening the opacity and showing it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the show animation. defualts to <em>1</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.show(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="savepng">savePng</h3>

<p>save the current state of the view into a png image</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.save_png();
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">save_png</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build a canvas element to store the image temporarily while we save it</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">html_snippet</span> <span class="o">=</span> <span class="s1">&#39;&lt;canvas id=&quot;tmpCanvas&quot; width=&quot;&#39;</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="s1">&#39;px&quot;&gt;&lt;/canvas&gt;&#39;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html_snippet</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>dim the png label on the image</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">png_selection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.no_png_export&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">png_opacity</span> <span class="o">=</span> <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">);</span>
    <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>grab the content of the target svg and place it in the canvas element</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">svg_snippet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="nx">canvg</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;tmpCanvas&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;svg&gt;&#39;</span> <span class="o">+</span> <span class="nx">svg_snippet</span> <span class="o">+</span> <span class="s1">&#39;&lt;/svg&gt;&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">ignoreMouse</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ignoreAnimation</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>save the contents of the canvas to file and remove the canvas element</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tmpCanvas&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="s2">&quot;cmapPertDetailView&quot;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">){</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">blob</span><span class="p">){</span><span class="nx">saveAs</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span><span class="nx">filename</span><span class="p">);})};</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tmpCanvas&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make the png label on the image visible again</p></div></div><div class="code"><div class="wrapper">    <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="nx">png_opacity</span><span class="p">);</span>
  <span class="p">}</span>

<span class="p">});</span></div></div></div></div></body></html>