<!DOCTYPE html><html lang="en"><head><title>views/BaristaBaseView</title></head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"><meta name="groc-relative-root" content="../"><meta name="groc-document-path" content="views/BaristaBaseView"><meta name="groc-project-path" content="source/views/BaristaBaseView.js"><link rel="stylesheet" type="text/css" media="all" href="../assets/style.css"><script type="text/javascript" src="../assets/behavior.js"></script><body><div id="meta"><div class="file-path">source/views/BaristaBaseView.js</div></div><div id="document"><div class="segment"><div class="comments"><div class="wrapper"><h1 id="baristabaseview"><strong>BaristaBaseView</strong></h1>

<p>A Backbone.View the serves as the base view for other views in the barista library.  BaristaBaseView provides common
functionality for views including standard initialization, redraw, render, template compilation, and png export functions.
This view by itself will construct a single panel with a png export option, but it is meant to be used as the base view
that more complex views extend</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>basic use:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>base_view = new BaristaBaseView();
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>optional arguments:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{string}  <strong>bg_color</strong>  the hex color code to use as the backgound of the view, defaults to <em>#ffffff</em></li>
<li>{string}  <strong>fg_color</strong>  the hex color code to use as the foreground color of the view, defaults to <em>#1b9e77</em></li>
<li>{string}  <strong>span_class</strong>  a bootstrap span class to size the width of the view, defaults to <em>"col-lg-12"</em></li>
<li>{Number}  <strong>plot_height</strong>  the height of the plot in pixels, defaults to <em>120</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>base_view = new BaristaBaseView({el: $("target_selector",
                            bg_color:"#ffffff", 
                            fg_color: "#1b9e77",
                            span_class: "col-lg-12",
                            plot_height: 120});
</code></pre></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>to extend BaristaBaseView, use</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>extended_view = BaristaBaseView.extend({
                                ...
                                });
</code></pre></div></div><div class="code"><div class="wrapper"><span class="nx">Barista</span><span class="p">.</span><span class="nx">Views</span><span class="p">.</span><span class="nx">BaristaBaseView</span> <span class="o">=</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">View</span><span class="p">.</span><span class="nx">extend</span><span class="p">({</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="initialize">initialize</h3>

<p>initialize the view.  Views that extend BaristaBaseView should impliment code overiding this method.
If extended BaristaBaseViews want to use the built in base_initialize method of BaristaBaseView, they should
call it in their redraw method.  As an example:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>initialize: function(){
            this.base_initialize();
            //your code here
            }
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="c1">//</span>

  <span class="nx">initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">base_initialize</span><span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="name">name</h3>

<p>give the view a name to be used throughout the View's functions when it needs to know what its class name is</p></div></div><div class="code"><div class="wrapper">  <span class="nx">name</span><span class="o">:</span> <span class="s2">&quot;BaristaBaseView&quot;</span><span class="p">,</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="model">model</h3>

<p>default model to Backbone.Model.  This default is only provided to make the view
functional as a un-extended standalone.  An appropriate data model should be
supplied for all views that extend BaristaBaseView</p></div></div><div class="code"><div class="wrapper">  <span class="nx">model</span><span class="o">:</span> <span class="k">new</span> <span class="nx">Backbone</span><span class="p">.</span><span class="nx">Model</span><span class="p">(),</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="base-initialize">base_initialize</h3>

<p>overide the default Backbone.View initialize method to handle optional arguments, compile the view
template, bind model changes to view updates, and render the view.  This method is provided so it 
can be used in view that extend BaristaBaseView</p></div></div><div class="code"><div class="wrapper">  <span class="nx">base_initialize</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up color options.  default if not specified</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">bg_color</span> <span class="o">:</span> <span class="s2">&quot;#ffffff&quot;</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fg_color</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">fg_color</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">fg_color</span> <span class="o">:</span> <span class="s2">&quot;#1b9e77&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the default height for the plot</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">plot_height</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_height</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">plot_height</span> <span class="o">:</span> <span class="mi">120</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the span size</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">span_class</span> <span class="o">:</span> <span class="s2">&quot;col-lg-12&quot;</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind render to model changes</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">listenTo</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">model</span><span class="p">,</span><span class="s1">&#39;change&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">update</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>compile the default template for the view</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">compile_template</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>define the location where d3 will build its plot</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerHeight</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span> <span class="o">=</span> <span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;svg&quot;</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>render the vis</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">render</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>bind window resize events to redraw</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="nb">window</span><span class="p">).</span><span class="nx">resize</span><span class="p">(</span><span class="kd">function</span><span class="p">()</span> <span class="p">{</span><span class="nx">self</span><span class="p">.</span><span class="nx">render</span><span class="p">();}</span> <span class="p">);</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="compile-template">compile_template</h3>

<p>use Handlebars to compile the template for the view</p></div></div><div class="code"><div class="wrapper">  <span class="nx">compile_template</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">=</span> <span class="s1">&#39;barista_view&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">();;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">compiled_template</span> <span class="o">=</span> <span class="nx">BaristaTemplates</span><span class="p">.</span><span class="nx">d3_target</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="nx">BaristaTemplates</span><span class="p">.</span><span class="nx">d3_target</span><span class="p">({</span><span class="nx">div_string</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">,</span>
                        <span class="nx">span_class</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">span_class</span><span class="p">,</span>
                        <span class="nx">height</span><span class="o">:</span> <span class="k">this</span><span class="p">.</span><span class="nx">plot_height</span><span class="p">}));</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="render">render</h3>

<p>completely render the view. Updates both static and dynamic content in the view.  Views
that extend BaristaBaseView should impliment draw code overiding this method.  If extended
BaristaBaseViews want to use the built in base_render method of BaristaBaseView, they should
call it in their render method.  As an example:</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>render: function(){
            this.base_render();
            //your code here
            }
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="c1">//</span>

  <span class="nx">render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">base_render</span><span class="p">();</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="base-render">base_render</h3>

<p>completely redraw the view. Updates both static and dynamic content in the view.
This method is provided so it can be used in view that extend BaristaBaseView</p></div></div><div class="code"><div class="wrapper">  <span class="nx">base_render</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>stuff this into a variable for later use</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>check to see if the container is visible, if not, make it visible, but transparent so we draw it with
the proper dimensions</p></div></div><div class="code"><div class="wrapper">    <span class="k">if</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">is</span><span class="p">(</span><span class="s2">&quot;:hidden&quot;</span><span class="p">)){</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="p">}</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up drawing layers</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bg_layer&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bg_layer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;bg_layer&quot;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.fg_layer&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">fg_layer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;fg_layer&quot;</span><span class="p">);</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.controls_layer&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls_layer</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;g&quot;</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="s2">&quot;controls_layer&quot;</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>set up the panel's width and height</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerWidth</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span><span class="p">).</span><span class="nx">outerHeight</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>rescale the width of the vis</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">transition</span><span class="p">().</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>draw the background of the panel</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">bg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bg_panel&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">bg_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s1">&#39;.bg_panel&#39;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">]).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s1">&#39;rect&#39;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span><span class="s2">&quot;bg_panel&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;height&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;width&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">bg_color</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>add a png export overlay</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">controls_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([]).</span><span class="nx">exit</span><span class="p">().</span><span class="nx">remove</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">controls_layer</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.&quot;</span> <span class="o">+</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export&quot;</span><span class="p">).</span><span class="nx">data</span><span class="p">([</span><span class="mi">1</span><span class="p">]).</span><span class="nx">enter</span><span class="p">().</span><span class="nx">append</span><span class="p">(</span><span class="s2">&quot;text&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;class&quot;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">div_string</span> <span class="o">+</span> <span class="s2">&quot;png_export no_png_export&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;x&quot;</span><span class="p">,</span><span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;y&quot;</span><span class="p">,</span><span class="k">this</span><span class="p">.</span><span class="nx">height</span> <span class="o">-</span> <span class="mi">10</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">style</span><span class="p">(</span><span class="s2">&quot;cursor&quot;</span><span class="p">,</span><span class="s2">&quot;pointer&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="s2">&quot;png&quot;</span><span class="p">)</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseover&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#56B4E9&quot;</span><span class="p">);})</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;mouseout&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">d3</span><span class="p">.</span><span class="nx">select</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">transition</span><span class="p">().</span><span class="nx">duration</span><span class="p">(</span><span class="mi">500</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mf">0.25</span><span class="p">).</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span><span class="s2">&quot;#000000&quot;</span><span class="p">);})</span>
      <span class="p">.</span><span class="nx">on</span><span class="p">(</span><span class="s2">&quot;click&quot;</span><span class="p">,</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">save_png</span><span class="p">();});</span>

    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="update">update</h3>

<p>update the dynamic potions of the view</p></div></div><div class="code"><div class="wrapper">  <span class="nx">update</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">;</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="savepng">savePng</h3>

<p>save the current state of the view into a png image</p></div></div><div class="code"><div class="wrapper">  <span class="nx">save_png</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>do any pre save work that the child class may require</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">save_png_pre</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>build a canvas element to store the image temporarily while we save it</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">width</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">width</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">height</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">html_snippet</span> <span class="o">=</span> <span class="s1">&#39;&lt;canvas id=&quot;tmpCanvas&quot; width=&quot;&#39;</span> <span class="o">+</span> <span class="nx">width</span> <span class="o">+</span> <span class="s1">&#39;px&quot; height=&quot;&#39;</span> <span class="o">+</span> <span class="nx">height</span> <span class="o">+</span> <span class="s1">&#39;px&quot;&gt;&lt;/canvas&gt;&#39;</span><span class="p">;</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;body&#39;</span><span class="p">).</span><span class="nx">append</span><span class="p">(</span><span class="nx">html_snippet</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>dim the png label on the image</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">png_selection</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">selectAll</span><span class="p">(</span><span class="s2">&quot;.no_png_export&quot;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">png_opacity</span> <span class="o">=</span> <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">);</span>
    <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>grab the content of the target svg and place it in the canvas element</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">svg_snippet</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">vis</span><span class="p">.</span><span class="nx">node</span><span class="p">().</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
    <span class="nx">canvg</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s1">&#39;tmpCanvas&#39;</span><span class="p">),</span> <span class="s1">&#39;&lt;svg&gt;&#39;</span> <span class="o">+</span> <span class="nx">svg_snippet</span> <span class="o">+</span> <span class="s1">&#39;&lt;/svg&gt;&#39;</span><span class="p">,</span> <span class="p">{</span> <span class="nx">ignoreMouse</span><span class="o">:</span> <span class="kc">true</span><span class="p">,</span> <span class="nx">ignoreAnimation</span><span class="o">:</span> <span class="kc">true</span> <span class="p">});</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>save the contents of the canvas to file and remove the canvas element</p></div></div><div class="code"><div class="wrapper">    <span class="kd">var</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nx">$</span><span class="p">(</span><span class="s2">&quot;#tmpCanvas&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
    <span class="kd">var</span> <span class="nx">filename</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">name</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">().</span><span class="nx">getTime</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot;.png&quot;</span><span class="p">;</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">){</span>
      <span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">(</span><span class="kd">function</span><span class="p">(</span><span class="nx">blob</span><span class="p">){</span>
        <span class="nx">saveAs</span><span class="p">(</span><span class="nx">blob</span><span class="p">,</span><span class="nx">filename</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="p">}</span>
    <span class="nx">$</span><span class="p">(</span><span class="s1">&#39;#tmpCanvas&#39;</span><span class="p">).</span><span class="nx">remove</span><span class="p">();</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>make the png label on the image visible again</p></div></div><div class="code"><div class="wrapper">    <span class="nx">png_selection</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;opacity&quot;</span><span class="p">,</span><span class="nx">png_opacity</span><span class="p">);</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>do any post save work that the child class may require</p></div></div><div class="code"><div class="wrapper">    <span class="k">this</span><span class="p">.</span><span class="nx">save_png_post</span><span class="p">();</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="save_png_pre">save<em>png</em>pre</h3>

<p>dummy method that should be overiden if there is any work to do before
saving the png image of the view.  For example, removing elements that
will not render properly could be done before saving the image.  This
function is called as the first step of <em>save_png</em></p></div></div><div class="code"><div class="wrapper">  <span class="nx">save_png_pre</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="save_png_post">save<em>png</em>post</h3>

<p>dummy method that should be overiden if there is any work to do after
saving the png image of the view.  For example, restoring elements that
were removed before saving could be done after saving the image.  This
function is called as the last step of <em>save_png</em></p></div></div><div class="code"><div class="wrapper">  <span class="nx">save_png_post</span><span class="o">:</span> <span class="kd">function</span><span class="p">(){},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="hide">hide</h3>

<p>hides the view by dimming the opacity and hiding it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the hide animation. defualts to <em>1</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.hide(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">hide</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">self</span> <span class="o">=</span> <span class="k">this</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">0</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
    <span class="nx">setTimeout</span><span class="p">(</span><span class="kd">function</span><span class="p">(){</span><span class="nx">self</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">hide</span><span class="p">()},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">},</span></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><h3 id="show">show</h3>

<p>shows the view by brightening the opacity and showing it in the DOM</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><p>arguments</p></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><ol>
<li>{number}  <strong>duration</strong>  the time in ms for the show animation. defualts to <em>1</em></li>
</ol></div></div></div><div class="segment"><div class="comments"><div class="wrapper"><pre><code>pert_detail_view.show(duration);
</code></pre></div></div><div class="code"><div class="wrapper">  <span class="nx">show</span><span class="o">:</span> <span class="kd">function</span><span class="p">(</span><span class="nx">duration</span><span class="p">){</span>
    <span class="nx">duration</span> <span class="o">=</span> <span class="p">(</span><span class="nx">duration</span> <span class="o">!==</span> <span class="kc">undefined</span><span class="p">)</span> <span class="o">?</span> <span class="nx">duration</span> <span class="o">:</span> <span class="mi">1</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">show</span><span class="p">();</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">$el</span><span class="p">.</span><span class="nx">animate</span><span class="p">({</span><span class="nx">opacity</span><span class="o">:</span><span class="mi">1</span><span class="p">},</span><span class="nx">duration</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">});</span></div></div></div></div></body></html>